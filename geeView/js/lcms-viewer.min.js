let urlParamsObj={};function setUrl(e){const a={Title:"test",Url:e};history.pushState(a,a.Title,a.Url)}function baseUrl(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function eliminateSearchUrl(){setUrl(baseUrl())}function updatePageUrl(){pageUrl=window.location.protocol+"//"+window.location.host+window.location.pathname+constructUrlSearch()}function TweetThis(e="",a="",t=!1,o=!0){updatePageUrl(),$.get("https://tinyurl.com/api-create.php",{url:pageUrl},(function(l){let r=l.split("https://tinyurl.com/")[1],n=pageUrl.split("?")[0]+"?id="+r,i=e+n+a;if(ga("send","event",mode+"-share",pageUrl,n),console.log("shared"),t){window.open(i,"_blank").focus()}else if(o){showMessage("Share link",`<div class="input-group-prepend" id = 'shareLinkMessageBox'>\n                                <button onclick = 'copyText("shareLinkText","copiedMessageBox")'' title = 'Click to copy link to clipboard' class="py-0  fa fa-copy btn input-group-text bg-white"></button>\n                                <input type="text" value="${i}" id="shareLinkText" style = "max-width:70%;" class = "form-control mx-1">\n                               </div>\n                               <div id = 'copiedMessageBox' class = 'pl-4'</div>\n                               `),"geeViz"!==mode&&$("#shareLinkMessageBox").append(staticTemplates.shareButtons)}!1===t&&setUrl(i)}))}function copyText(e,a){var t=$("<input>");$("body").append(t);var o=$("#"+e).text();""===o&&(o=$("#"+e).val()),t.val(o).select(),document.execCommand("copy"),t.remove(),null!=a&&$("#"+a).html("Copied text to clipboard")}function parseUrlSearch(){let e=window.location.search;if(console.log(e),""!==e&&(e=e.split("?")[1].split("&"),e.map((function(e){if(e.indexOf("OBJECT---")>-1){var a=e.split("---");void 0===urlParams[a[1]]&&(urlParams[a[1]]={}),urlParams[a[1]][a[2].split("=")[0]]=a[2].split("=")[1]}else urlParams[e.split("=")[0]]=e.split("=")[1]}))),void 0!==urlParams.id)window.open("https://tinyurl.com/"+urlParams.id,"_self"),"undefined"!=typeof Storage&&localStorage.setItem("cachedID",urlParams.id);else if("undefined"!=typeof Storage){var a=localStorage.getItem("cachedID");null!=a&&"null"!==a&&(setUrl(baseUrl()+"?id="+a),localStorage.setItem("cachedID",null))}}function constructUrlSearch(){var e="?";return Object.keys(urlParams).map((function(a){if("object"==typeof urlParams[a]){var t={};Object.keys(urlParams[a]).map((e=>t["OBJECT---"+a+"---"+e]=urlParams[a][e])),e+=new URLSearchParams(t).toString()+"&"}else e+=a+"="+urlParams[a]+"&"})),e=e.slice(0,e.length-1)}pageUrl=document.URL,tinyURL="",urlParams={};let cachedSettingskey="settings",startYear=1985,endYear=2021,startJulian=153,endJulian=274,layerObj=null,crs="EPSG:5070",transform=null,scale=30,queryObj={},timeLapseObj={},addLCMSTimeLapsesOn;parseUrlSearch();let initialCenter=[37.5334105816903,-105.6787109375],initialZoomLevel=5,studyAreaSpecificPage=!1;const studyAreaDict={"USFS LCMS 1984-2020":{isPilot:!1,name:"USFS LCMS 1984-2020",center:[37.5334105816903,-105.6787109375,5],crs:"EPSG:5070",startYear:1985,endYear:2021,conusSA:"projects/lcms-292214/assets/CONUS-Ancillary-Data/conus",conusLossThresh:.23,conusFastLossThresh:.29,conusSlowLossThresh:.18,conusGainThresh:.29,akSA:"projects/lcms-292214/assets/R10/CoastalAK/TCC_Boundary",akLossThresh:.26,akFastLossThresh:.34,akSlowLossThresh:.17,akGainThresh:.24,lcClassDict:{1:{modelName:"TREES",legendName:"Trees",color:"005e00"},2:{modelName:"TS-TREES",legendName:"Tall Shrubs & Trees Mix",color:"008000"},3:{modelName:"SHRUBS-TRE",legendName:"Shrubs & Trees Mix",color:"00cc00"},4:{modelName:"GRASS-TREE",legendName:"Grass/Forb/Herb & Trees Mix",color:"b3ff1a"},5:{modelName:"BARREN-TRE",legendName:"Barren & Trees Mix",color:"99ff99"},6:{modelName:"TS",legendName:"Tall Shrubs",color:"b30088"},7:{modelName:"SHRUBS",legendName:"Shrubs",color:"e68a00"},8:{modelName:"GRASS-SHRU",legendName:"Grass/Forb/Herb & Shrubs Mix",color:"ffad33"},9:{modelName:"BARREN-SHR",legendName:"Barren & Shrubs Mix",color:"ffe0b3"},10:{modelName:"GRASS",legendName:"Grass/Forb/Herb",color:"ffff00"},11:{modelName:"BARREN-GRA",legendName:"Barren & Grass/Forb/Herb Mix",color:"AA7700"},12:{modelName:"BARREN-IMP",legendName:"Barren or Impervious",color:"d3bf9b"},13:{modelName:"SNOW",legendName:"Snow or Ice",color:"ffffff"},14:{modelName:"WATER",legendName:"Water",color:"4780f3"}},luClassDict:{1:{modelName:"Agriculture",legendName:"Agriculture",color:"efff6b"},2:{modelName:"Developed",legendName:"Developed",color:"ff2ff8"},3:{modelName:"Forest",legendName:"Forest",color:"1b9d0c"},4:{modelName:"Non_Forest_Wetland",legendName:"Non-Forest Wetland",color:"97ffff"},5:{modelName:"Other",legendName:"Other",color:"a1a1a1"},6:{modelName:"Rangeland",legendName:"Rangeland or Pasture",color:"c2b34a"}},final_collections:["USFS/GTAC/LCMS/v2020-6","USFS/GTAC/LCMS/v2021-7"],composite_collections:["projects/lcms-292214/assets/R10/CoastalAK/Composites/Composite-Collection","projects/lcms-tcc-shared/assets/Composites/Composite-Collection-yesL7-1984-2020","projects/lcms-292214/assets/R8/PR_USVI/Composites/Composite-Collection-1984-2020"],lt_collections:["projects/lcms-292214/assets/R10/CoastalAK/Base-Learners/LANDTRENDR-Collection","projects/lcms-tcc-shared/assets/LandTrendr/LandTrendr-Collection-yesL7-1984-2020","projects/lcms-292214/assets/R8/PR_USVI/Base-Learners/LandTrendr-Collection-1984-2020"],ccdc_collections:["projects/lcms-292214/assets/R10/CoastalAK/Base-Learners/CCDC-Collection","projects/lcms-292214/assets/CONUS-LCMS/Base-Learners/CCDC-Collection-1984-2021","projects/lcms-292214/assets/R8/PR_USVI/Base-Learners/CCDC-Landsat-1984-2020"]}};let defaultStudyArea="USFS LCMS 1984-2020",studyAreaName=studyAreaDict[defaultStudyArea].name,longStudyAreaName=defaultStudyArea,cachedStudyAreaName=null,viewBeta="yes",lowerThresholdDecline=studyAreaDict[defaultStudyArea].lossThresh,upperThresholdDecline=1,lowerThresholdRecovery=studyAreaDict[defaultStudyArea].gainThresh,upperThresholdRecovery=1,lowerThresholdSlowLoss=studyAreaDict[defaultStudyArea].lossSlowThresh,upperThresholdSlowLoss=1,lowerThresholdFastLoss=studyAreaDict[defaultStudyArea].lossFastThresh,upperThresholdFastLoss=1;void 0===lowerThresholdSlowLoss&&(lowerThresholdSlowLoss=lowerThresholdDecline),void 0===lowerThresholdFastLoss&&(lowerThresholdFastLoss=lowerThresholdDecline);const clientBoundsDict={All:{geodesic:!1,type:"Polygon",coordinates:[[[-169.215141654273,71.75307977193499],[-169.215141654273,15.643479915898974],[-63.043266654273,15.643479915898974],[-63.043266654273,71.75307977193499]]]},CONUS:{geodesic:!1,type:"Polygon",coordinates:[[[-148.04139715349993,30.214881196707502],[-63.66639715349993,30.214881196707502],[-63.66639715349993,47.18482008797388],[-148.04139715349993,47.18482008797388],[-148.04139715349993,30.214881196707502]]]},Alaska:{geodesic:!1,type:"Polygon",coordinates:[[[-168.91542059099993,71.62680009186087],[-168.91542059099993,52.67867842404269],[-129.54042059099993,52.67867842404269],[-129.54042059099993,71.62680009186087]]]},CONUS_SEAK:{type:"Polygon",coordinates:[[[171.00872335506813,59.78242951494817],[171.00872335506813,26.87020622017523],[-53.99127664493189,26.87020622017523],[-53.99127664493189,59.78242951494817],[171.00872335506813,59.78242951494817]]]},Hawaii:{geodesic:!1,type:"Polygon",coordinates:[[[-162.7925163471209,18.935659110261664],[-152.2511345111834,18.935659110261664],[-152.2511345111834,22.134763696750557],[-162.7925163471209,22.134763696750557],[-162.7925163471209,18.935659110261664]]]},"Puerto-Rico":{geodesic:!1,type:"Polygon",coordinates:[[[-67.98169635150003,17.751237971831113],[-65.34635089251566,17.751237971831113],[-65.34635089251566,18.532938160084615],[-67.98169635150003,18.532938160084615],[-67.98169635150003,17.751237971831113]]]},R4:{geodesic:!1,type:"Polygon",coordinates:[[[-120.14785145677105,35.00187373433839],[-108.8802160007048,35.00187373433839],[-108.8802160007048,45.70613418897154],[-120.14785145677105,45.70613418897154],[-120.14785145677105,35.00187373433839]]]}};let toExport,exportArea,taskCount=0,canAddToMap=!0,canExport=!1,colorRampIndex=1,NEXT_LAYER_ID=1,layerChildID=0,layerCount=0,refreshNumber=0,uri,uriName,csvName,dataTable,chartOptions,infowindow,queryGeoJSON,marker,mtbsSummaryMethod;const selectedFeaturesJSON={},selectionTracker={};let selectionUNID=1,updateViewList=!0,viewList=[],viewIndex=0,outputURL,tableConverter=null,groundOverlayOn=!1,chartIncludeDate=!0,chartCollection,pixelChartCollections={},whichPixelChartCollection,areaChartCollections={},whichAreaChartCollection,queryClassDict={},exportImage,exportVizParams,eeBoundsPoly,shapesMap,mouseLat,mouseLng,area=0,distance=0,areaPolygon,markerList=[],distancePolylineT,clickCoords,distanceUpdater,updateArea,updateDistance,areaPolygonObj={},udpPolygonObj={},udpPolygonNumber=1,mapHammer,chartMTBS,chartMTBSByNLCD,chartMTBSByAspect,walkThroughAdded=!1,distancePolyline;const distancePolylineOptions={strokeColor:"#FF0",icons:[{icon:{path:"M 0,-1 0,1",strokeOpacity:1,scale:4},offset:"0",repeat:"20px"}],strokeOpacity:0,strokeWeight:3,draggable:!0,editable:!0,geodesic:!0};let polyNumber=1,polyOn=!1;const areaPolygonOptions={strokeColor:"#FF0",fillOpacity:.2,strokeOpacity:1,strokeWeight:3,draggable:!0,editable:!0,geodesic:!0,polyNumber:polyNumber};let userDefinedI=1;const udpOptions={strokeColor:"#FF0",fillOpacity:.2,strokeOpacity:1,strokeWeight:3,draggable:!0,editable:!0,geodesic:!0,polyNumber:1},exportAreaPolylineOptions={strokeColor:"#FF0",fillOpacity:.2,strokeOpacity:1,strokeWeight:3,draggable:!0,editable:!0,geodesic:!0,polyNumber:1},exportAreaPolygonOptions={strokeColor:"#FF0",fillOpacity:.2,strokeOpacity:1,strokeWeight:3,draggable:!1,editable:!1,geodesic:!0,polyNumber:1};let exportImageDict={},featureObj={},geeRunID,outstandingGEERequests=0,geeTileLayersDownloading=0,plotDictID=1,exportID=1;const unitMultiplierDict={imperial:{area:[10.7639,247105e-9],distance:[3.28084,621371e-9]},metric:{area:[1,1e-4],distance:[1,.001]}},unitNameDict={imperial:{area:["ft<sup>2</sup>","acres"],distance:["ft","miles"]},metric:{area:["m<sup>2</sup>","hectares"],distance:["m","km"]}};let plotRadius=15,plotScale=30,areaChartFormat="Percentage";const areaChartFormatDict={Percentage:{mult:100,label:"% Area"},Acres:{mult:247105e-9,label:"Acres"},Hectares:{mult:1e-4,label:"Hectares"}};let areaGeoJson,areaChartingCount=0,center,globalChartValues,chartColorI=0;const chartColorsDict={standard:["#050","#0A0","#e6194B","#14d4f4"],advanced:["#050","#0A0","#9A6324","#6f6f6f","#e6194B","#14d4f4"],advancedBeta:["#050","#0A0","#9A6324","#6f6f6f","#e6194B","#14d4f4","#808","#f58231"],coreLossGain:["#050","#0A0","#e6194B","#14d4f4"],allLossGain:["#050","#0A0","#e6194B","#808","#f58231","#14d4f4"],allLossGain2:["#050","#0A0","#0E0","f39268","d54309","00a398"],allLossGain2Area:["f39268","d54309","00a398","ffbe2e"],test:["#9A6324","#6f6f6f","#e6194B","#14d4f4","#880088","#f58231"],testArea:["#e6194B","#14d4f4","#880088","#f58231"],ancillary:["#cc0066","#660033","#9933ff","#330080","#ff3300","#47d147","#00cc99","#ff9966","#b37700"]},chartColors=chartColorsDict.standard,zoomDict={20:"1,128.49",19:"2,256.99",18:"4,513.98",17:"9,027.97",16:"18,055.95",15:"36,111.91",14:"72,223.82",13:"144,447.64",12:"288,895.28",11:"577,790.57",10:"1,155,581.15",9:"2,311,162.30",8:"4,622,324.61",7:"9,244,649.22",6:"18,489,298.45",5:"36,978,596.91",4:"73,957,193.82",3:"147,914,387.60",2:"295,828,775.30",1:"591,657,550.50"};null!=urlParams.geeAuthProxyURL&&null!=urlParams.geeAuthProxyURL||(urlParams.geeAuthProxyURL="https://rcr-ee-proxy-2.herokuapp.com");let authProxyAPIURL=urlParams.geeAuthProxyURL,geeAPIURL="https://earthengine.googleapis.com";if(null!==urlParams.accessToken&&void 0!==urlParams.accessToken&&"null"!==urlParams.accessToken){const e=urlParams.accessToken;authProxyAPIURL=null,geeAPIURL=null,ee.data.setAuthToken("","Bearer",e,3600,[],void 0,!1)}const plotsOn=!1;Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))},String.prototype.replaceAll=function(e,a,t){return this.replace(new RegExp(e.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),t?"gi":"g"),"string"==typeof a?a.replace(/\$/g,"$$$$"):a)},Number.prototype.formatNumber=function(e=2){return this.toFixed(e).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},String.prototype.toTitle=function(){return this.replace(/(^|\s)\S/g,(function(e){return e.toUpperCase()}))},Date.prototype.toStringFormat=function(){const e=this.getFullYear(),a=["January","February","March","April","May","June","July","August","September","October","November","December"][this.getMonth()];return`${this.getDate()} ${a} ${e}`};const zip=(e,a)=>e.map(((e,t)=>[e,a[t]]));function unique(e){let a={},t=[];for(let o=0,l=e.length;o<l;++o)a.hasOwnProperty(e[o])||(t.push(e[o]),a[e[o]]=1);return t}function auto_grow(e){e.style.height="5px",e.style.height=e.scrollHeight+"px"}const titles={"LCMS-pilot":{leftWords:"LCMS",centerWords:"DATA",rightWords:"EXPLORER",title:"LCMS Data Explorer"},LCMS:{leftWords:'<img style = \'width:1.0em;height:0.9em;margin-top:-0.5rem;margin-left:0.1rem;margin-right:0.1rem;\' alt="LCMS icon" src="images/lcms-icon.png">LCMS',centerWords:"DATA",rightWords:"EXPLORER",title:"LCMS Data Explorer"},"lcms-base-learner":{leftWords:"<img style = 'height:0.9em;margin-top:-0.2rem;margin-left:0.4rem' class='image-icon mr-1' alt=\"LCMS icon\" src=\"images/lcms-icon.png\">LCMS",centerWords:"Base-Learner",rightWords:"EXPLORER",title:"LCMS Base Learner Explorer"},Ancillary:{leftWords:"Ancillary",centerWords:"DATA",rightWords:"Viewer",title:"TimeSync Ancillary Data Viewer"},LT:{leftWords:"<img style = 'width:1.0em;height:0.9em;margin-top:-0.2em;margin-left:0.2em' class='image-icon mr-1' alt=\"LCMS icon\" src=\"images/lcms-icon.png\">LandTrendr",centerWords:"DATA",rightWords:"EXPLORER",title:"LandTrendr Data Explorer"},MTBS:{leftWords:"<img style = 'width:1.0em;height:0.9em;margin-top:-0.2em;margin-left:0.2em' class='image-icon mr-1' alt=\"MTBS icon\" src=\"images/mtbs-logo.png\">MTBS",centerWords:"DATA",rightWords:"EXPLORER",title:"MTBS Data Explorer"},TEST:{leftWords:"TEST",centerWords:"DATA",rightWords:"Explorer",title:"TEST Data Viewer"},IDS:{leftWords:"IDS",centerWords:"DATA",rightWords:"EXPLORER",title:"Insect and Disease Detection Survey Data Viewer"},geeViz:{leftWords:"geeViz",centerWords:"DATA",rightWords:"Viewer",title:"geeViz Data Viewer"},STORM:{leftWords:"Storm",centerWords:"Damage",rightWords:"Viewer",title:"Storm Damage Viewer"},LAMDA:{leftWords:"LAMDA",centerWords:"DATA",rightWords:"EXPLORER",title:"LAMDA Data Explorer"}};let specificAuthErrorMessages={LCMS:'<p>Try <a class = \'support-text\' title = "A simple LCMS output viewer" href = "lcms-in-motion.html" target="_blank">this viewer</a> for a simple visualization of LCMS data products.</p>\n                                <p>The <kbd>DOWNLOAD DATA</kbd> menu on the left (of this page) is still available for downloading LCMS data.</p>\n                                <p>For more information on LCMS please visit the <a class = \'support-text\' title = "LCMS Clearinghouse Page" href = "https://data.fs.usda.gov/geodata/rastergateway/LCMS/" target="_blank">LCMS Clearinghouse Page</a>.</p>',MTBS:'<p>Try <a class = \'support-text\' title = "MTBS Interactive Data Viewer" href = "https://www.mtbs.gov/viewer/?region=all" target="_blank">this viewer</a> for a simple MTBS product viewer.</p>'},specificAuthErrorMessage=specificAuthErrorMessages[mode];void 0===specificAuthErrorMessage&&(specificAuthErrorMessage="");let authErrorMessageContact=`<p>Please contact the LCMS help desk<a class = 'support-text' href = "mailto: sm.fs.lcms@usda.gov">(sm.fs.lcms@usda.gov)</a> if you have questions/comments about the ${mode} viewer or have feedback.</p>`;"MTBS"===mode&&(authErrorMessageContact='<p style = "margin-bottom:0px;">If you have any further questions about this, please <a class = \'support-text\' href="https://www.mtbs.gov/contact" target="_blank" > contact us</a>.</p>'),$("head").append(`<title>${titles[mode].title}</title>`),$("head").append('<script type="text/javascript" src="./js/gena-gee-palettes.js"><\/script>');let topBannerParams=titles[mode],studyAreaDropdownLabel="<h5 class = 'teal p-0 caret nav-link dropdown-toggle ' id = 'studyAreaDropdownLabel'>Bridger-Teton National Forest</h5> ";const staticTemplates={map:"<section aria-label=\"Map where all map outputs are displayed\" onclick = \"$('#study-area-list').hide();\" class = 'map' id = 'map'> </section>",mainContainer:"<main aria-label=\"Main container to contain all elements\" class = 'container main-container' id = 'main-container'></main>",sidebarLeftToggler:"<button href=\"#\" class=\"fa fa-bars  p-1 mt-1  sidebar-toggler\"  onclick = 'toggleSidebar()' title = 'Click to toggle sidebar visibility'></buttom>",sidebarLeftContainer:"\n\t\t\t\t\t\t<nav onclick = \"$('#study-area-list').hide();\" class = 'col-sm-7 col-md-4 col-lg-4 col-xl-3 sidebar  p-0 m-0 flexcroll  ' id = 'sidebar-left-container'>\n\n\t\t\t\t\t        <header id = 'sidebar-left-header'>\n                                \n                                </header>\n                            \n\t\t\t\t\t        <div role=\"list\" id = 'sidebar-left'></div>\n\t\t\t\t\t    </nav>",geeSpinner:"<div id='summary-spinner' style='position:absolute;right:40%; bottom:40%;width:8rem;height:8rem;z-index:10000000;display:none;'><img  alt= \"Google Earth Engine logo spinner\" title=\"Background processing is occurring in Google Earth Engine\" class=\"fa fa-spin\" src=\"images/GEE_logo_transparent.png\"  style='width:100%;height:100%'><span id = 'summary-spinner-message'></span></div>",authErrorMessage:`<p>---  Error --- Map Loading Error ---</p>\n                                                              <p>Map data did not load correctly and can not be used at this time. We apologize for this inconvenience and are working to resolve this issue.</p>\n                                                              ${specificAuthErrorMessage} \n                                                              ${authErrorMessageContact}\n    `,exportContainer:"<div class = 'dropdown-divider'></div>\n                    <div class = 'py-2' id = 'export-list-container'>\n                        <h5>Choose which images to export:</h5>\n                        <div class = 'py-2' id=\"export-list\"></div>\n                        <div class = 'dropdown-divider'></div>\n                        <div class = 'pl-3'>\n                            <form class=\"form-inline\" title = 'Provide projection. Web mercator: \"EPSG:4326\", USGS Albers: \"EPSG:5070\", WGS 84 UTM Northern Hemisphere: \"EPSG:326\" + zone number (e.g. zone 17 would be EPSG:32617), NAD 83 UTM Northern Hemisphere: \"EPSG:269\" + zone number (e.g. zone 17 would be EPSG:26917) '>\n                              <label for=\"export-crs\">Projection: </label>\n                              <div class=\"form-group pl-1\">\n                                <input type=\"text\" id=\"export-crs\" oninput = 'cacheCRS()' name=\"rg-from\" value=\"EPSG:4326\" class=\"form-control\">\n                              </div>\n                            </form>\n                            <div class = 'py-2' id = 'export-area-drawing-div'>\n                                <button class = 'btn' onclick = 'selectExportArea()' title = 'Draw polygon by clicking on map. Double-click to complete polygon, press ctrl+z to undo most recent point, press Delete or Backspace to start over.'><i class=\"pr-1 fa fa-pencil\" aria-hidden=\"true\"></i> Draw area to download</button>\n                                <a href=\"#\" onclick = 'undoExportArea()' title = 'Click to undo last drawn point (ctrl z)'><i class=\"btn fa fa-undo\"></i></a>\n                                <a href=\"#\" onclick = 'deleteExportArea()' title = 'Click to clear current drawing'><i class=\"btn fa fa-trash\"></i></a>\n                            </div>\n                            <div class = 'dropdown-divider'></div>  \n                            <div class = 'pt-1 pb-3' >\n                                <div id = 'export-button-div'>\n                                    <button class = 'btn' onclick = 'exportImages()' title = 'Click to export selected images across selected area'><i class=\"pr-1 fa fa-cloud-download\" aria-hidden=\"true\"></i>Export Images</button>\n                                    <button class = 'btn' onclick = 'cancelAllTasks()' title = 'Click to cancel all active exports'></i>Cancel All Exports</button>\n                                </div>\n                                <div class = 'dropdown-divider'></div>\n                                <span style = 'display:none;' class=\"fa-stack fa-2x py-0\" id='export-spinner' title=\"\">\n\t\t\t\t\t\t    \t\t<img alt= \"Google Earth Engine logo spinner\" class=\"fa fa-spin fa-stack-2x\" src=\"images/GEE_logo_transparent.png\" alt=\"\" style='width:2em;height:2em;'>\n\t\t\t\t\t\t   \t\t\t<strong id = 'export-count'  class=\"fa-stack-1x\" style = 'padding-left: 0.2em;padding-top: 0.1em;cursor:pointer;'></strong>\n\t\t\t\t\t\t\t\t</span>\n                                <div id = 'export-count-div'></div>\n                            </div>  \n                        </div>\n                        \n                    </div>",topBanner:`<h1 id = 'title-banner' title="" class = 'white  text-center title-banner' >\n                    <img style = 'height:1em;margin-top:-0.2em'  alt="USDA Forest Service icon" src="images/logos_usda-fs.svg">\n                    <div class="vl"></div>\n                    ${topBannerParams.leftWords} <span class = 'gray' style="font-weight:1000;font-family: 'Roboto Black', sans-serif;">${topBannerParams.centerWords}</span> ${topBannerParams.rightWords}</h1>`,studyAreaDropdown:"<li   id = 'study-area-dropdown' class=\"nav-item dropdown navbar-dark navbar-nav nav-link p-0 col-12  \"  data-toggle=\"dropdown\">\n\t\t                <h5 href = '#' onclick = \"$('#sidebar-left').show('fade');$('#study-area-list').toggle();\" class = 'teal-study-area-label p-0 caret nav-link dropdown-toggle ' id='study-area-label'></h5> \n\t\t                <div class=\"dropdown-menu\" id=\"study-area-list\">  \n\t\t                </div>\n\t\t            </li>",placesSearchDiv:'<section id = \'search-share-div\' class="input-group pr-4 pt-0 pb-2 text-center" style = \'padding-left:3rem;\'>\n\t\t\t            <div role=\'list\' class="input-group-prepend">\n                            <button onclick = \'getLocation()\' title = \'Click to center map at your location\' class=" btn input-group-text bg-white search-box pr-1 pl-2" id="get-location-button"><i class="fa fa-map-marker text-black "></i></button>\n\t    \t\t\t\t\t<button onclick = \'TweetThis()\' title = \'Click to share your current view\' class=" btn input-group-text bg-white search-box pr-1 pl-2" id="share-button"><i class="fa fa-share-alt teal "></i></button>\n                            <buttom class="input-group-text bg-white search-box" id="search-icon"><i class="fa fa-search text-black "></i></buttom>\n\t  \t\t\t\t\t</div>\n\t\t\t            <input id = \'pac-input\' class="form-control bg-white search-box" title = \'Search for places on the map\' type="text" placeholder="Search Places">\n                        <div class="input-group-prepend">\n                            <button onclick = \'backView()\' title = \'Click to go back a view\' class=" btn input-group-text bg-white search-box pr-1 pl-2" id="back-view-button"><i class="fa fa-arrow-left teal "></i></button>\n                            <button onclick = \'forwardView()\' title = \'Click to go forward a view\' style = \'border-radius: 0px 3px 3px 0px\' class=" btn input-group-text bg-white search-box pr-1 pl-2" id="forward-view-button"><i class="fa fa-arrow-right teal "></i></button>\n                        </div>\n                    </section>\n                    <p class = \'mt-0 mb-1\' style = \'display:none;font-size:0.8em;font-weight:bold\' id = \'time-lapse-year-label\'></p>',introModal:{LCMS:'<div class="modal fade modal-full-screen-styling"  id="introModal" tabindex="-1" role="dialog" >\n                <div class="modal-dialog modal-md" role="document">\n                    <div class="modal-content text-dark modal-content-full-screen-styling" >\n                       \n                        <div class="modal-body" id = \'introModal-body\'>\n                            <span>\n                                <img class = \'logo\' src="./images/lcms-icon.png"   alt="LCMS logo image">\n                                <h1 id = \'intro-modal-title-banner\' title="" class = \'  splash-title\' style="font-weight:100;font-family: \'Roboto\';">LCMS<span  style="font-weight:1000;font-family: \'Roboto Black\', sans-serif;"> DATA </span>EXPLORER</h1>\n                            </span>\n                         \n                        <p>\n                            <span  style="font-weight:bold">Welcome to the Landscape Change Monitoring System (LCMS) Data Explorer!</span>\n                            <br>\n                            LCMS is a landscape change detection program developed by the USDA Forest Service. This application is designed to provide an interactive visualization of the Landscape Change products, related geospatial data, and provide a portal to download the data.\n                        </p>\n                            <div >\n                                <div style =\'float:left;\'>\n                                    <img class = \'logo\' alt="USDA Forest Service icon" src="images/logos_usda-fs_bn-dk-01.svg">\n                                    \n                                </div>\n                                <div style =\'float:left;\'>\n                                    <ul class="intro-list">\n                                      <li title = \'The Geospatial Technology and Applications Center (GTAC) provides leadership in geospatial science implementation in the USDA Forest Service by delivering vital services, data products, tools, training, and innovation to solve today’s land and resource management challenges. All operational LCMS production and support takes place at GTAC.\'><a class="intro-modal-links" href="https://www.fs.usda.gov/about-agency/gtac" target="_blank">GTAC</a> Geospatial Technology and Applications Center\n                                      </li>\n                                      <li title = \'RedCastle Resources Inc. is the on-site contractor that has provided the technical expertise for LCMS\' operational production, documentation, and delivery at GTAC.\'><a class="intro-modal-links" href="https://www.redcastleresources.com/" target="_blank">RCR</a> RedCastle Resources Inc.\n                                      </li>\n                                      <li title = \'The Rocky Mountain Research Station provides the scientific foundation LCMS is built upon. They have been instrumental in developing and publishing the original LCMS methodology and continue to provide ongoing research and development to further improve LCMS methods.\'><a class="intro-modal-links" href="https://www.fs.usda.gov/rmrs/tools/landscape-change-monitoring-system-lcms" target="_blank">RMRS</a> Rocky Mountain Research Station\n                                      </li>\n                                    </ul>\n                                </div>\n                            \n                            </div>\n                    \n                                \n                            <br>\n                            <div style=\'display:inline-block;padding-bottom:0.75rem;padding-top:0.75rem;\'>\n                        \t   <a  class = \'intro-modal-links\' onclick = \'downloadTutorial()\' title="Click to launch tutorial that explains how to utilize the Data Explorer">TUTORIAL</a>\n                                <a class="intro-modal-links" onclick="downloadMethods(\'v2021-7\')" title="Open in-depth LCMS v2021.7 methods documentation">LCMS METHODS</a>\n                                <a class = "intro-modal-links" title = "Send us an E-mail" href = "mailto: sm.fs.lcms@usda.gov" >LCMS HELPDESK/FEEDBACK</a> \n                            </div>\n                            <br>\n                            <p>Other LCMS EXPLORERS:\n                                <a class = \'intro-modal-links\' title = "Visualize and explore time series datasets used to create the LCMS map outputs" href = "lcms-base-learner.html" target="_blank">LCMS Base Learner Explorer</a>\n                                <a class = \'intro-modal-links\' title = "Visualize pre-made gifs illustrating patterns of change across USFS Forests and Districts" href = "lcms-in-motion.html" target="_blank">LCMS-in-Motion</a>\n                                \n                            </p>\n\n                             <div class = \' ml-0\' id = \'intro-modal-loading-div\'>\n                                <p>\n                                  <img style="width:1.8em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                                    Creating map services within Google Earth Engine. \n                                 </p>\n                            </div>\n                           \n                            <div class="form-check  px-0">\n                                <input role="option" type="checkbox" class="form-check-input" id="dontShowAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                <label class=" text-uppercase form-check-label " for="dontShowAgainCheckbox" >Don\'t show again</label>\n                            </div>\n                        </div>\n                        \n                           \n                        \n                    </div>\n                </div>\n            </div>',"lcms-base-learner":'<div class="modal fade" id="introModal" tabindex="-1" role="dialog" >\n                <div class="modal-dialog modal-md " role="document">\n                    <div class="modal-content text-dark" style = \'background-color:rgba(230,230,230,0.95);\'>\n                        <button type="button" class="close p-2 ml-auto text-dark" data-dismiss="modal">&times;</button>\n                        <div class = \'modal-header\'>\n                            <h3 class="mb-0 ">Welcome to the Landscape Change Monitoring System (LCMS) Base-Learner Explorer!</h3>\n                        </div>\n                        <div class="modal-body" id = \'introModal-body\'>\n                            <p>LCMS is a landscape change detection program developed by the USDA Forest Service. This application is designed to provide a visualization of the change detection algorithm outputs that are used to produce LCMS products.</p>\n                            <hr>\n                            <p>In addition to the map layers, LandTrendr and CCDC outputs can be compared through charting under the <kbd>Tools</kbd> -> <kbd>Pixel Tools</kbd> and <kbd>Area Tools</kbd>\n                            </p>\n                            <hr>\n                            <p>Please review this <a class = \'support-text\' onclick = \'downloadMethods("v2021-7")\' title = \'Open in-depth LCMS v2021.7 methods documentation\'>methods document</a> for more information about how these datasets are used to create LCMS products.   \n                            </p>\n                            <hr>\n                            <p>Please contact the LCMS help desk\n                                <a class = \'support-text\' href = "mailto: sm.fs.lcms@usda.gov">(sm.fs.lcms@usda.gov)</a> if you have questions/comments about LCMS or have feedback on the LCMS Base-Learner Explorer.</p>\n                        </div>\n                        <div class = \'modal-footer\' id = \'introModal-footer\'>\n                        <div class = \' ml-0\' id = \'intro-modal-loading-div\'>\n                            <p>\n                              <img style="width:1.8em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                                Creating map services within Google Earth Engine. \n                             </p>\n                        </div>\n                        <hr>\n                        <div class="form-check  mr-0">\n                                <input role="option" type="checkbox" class="form-check-input" id="dontShowAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                <label class=" text-uppercase form-check-label " for="dontShowAgainCheckbox" >Don\'t show again</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>',IDS:'<div class="modal fade "  id="introModal" tabindex="-1" role="dialog" >\n                <div class="modal-dialog modal-md " role="document">\n                    <div class="modal-content text-dark" style = \'background-color:rgba(230,230,230,0.95);\'>\n                        <button type="button" class="close p-2 ml-auto text-dark" data-dismiss="modal">&times;</button>\n                        <div class = \'modal-header\'>\n                            <h3 class="mb-0 ">Welcome to the Landscape Change Monitoring System (LCMS) Insect and Disease Detection Survey (IDS) Explorer!</h3>\n                        </div>\n                        <div class="modal-body" id = \'introModal-body\'>\n                            <p>LCMS is a landscape change detection program developed by the USDA Forest Service. This application is designed to provide a visualization of the LCMS outputs alongside outputs from the USFS Forest Health Protection\'s <a class = \'support-text\' href=\'https://www.fs.fed.us/foresthealth/applied-sciences/mapping-reporting/detection-surveys.shtml\' title = \'IDS homepage\' target="_blank">Insect and Disease Detection Survey (IDS)</a> outputs.</p>\n                            <hr>\n                            <p>LCMS Change and IDS polygon data can be viewed simultaneously for each coincident year. These data can also be compared through charting under the <kbd>Tools</kbd> -> <kbd>Pixel Tools</kbd> and <kbd>Area Tools</kbd>\n                            </p>\n                            <hr>\n                            <p>Please review this <a class = \'support-text\' onclick = \'downloadMethods("v2021-7")\' title = \'Open in-depth LCMS v2021.7 methods documentation\'>methods document</a> for more information about how LCMS products are created.   \n                            </p>\n                            <hr>\n                            <p>Please contact the LCMS help desk\n                                <a class = \'support-text\' href = "mailto: sm.fs.lcms@usda.gov">(sm.fs.lcms@usda.gov)</a> if you have questions/comments about LCMS or have feedback on the LCMS IDS Explorer.</p>\n                        </div>\n                        <div class = \'modal-footer\' id = \'introModal-footer\'>\n                        <div class = \' ml-0\' id = \'intro-modal-loading-div\'>\n                            <p>\n                              <img style="width:1.8em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                                Creating map services within Google Earth Engine. \n                             </p>\n                        </div>\n                        <hr>\n                        <div class="form-check  mr-0">\n                                <input role="option" type="checkbox" class="form-check-input" id="dontShowAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                <label class=" text-uppercase form-check-label " for="dontShowAgainCheckbox" >Don\'t show again</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>',Ancillary:'<div class="modal fade "  id="introModal" tabindex="-1" role="dialog" >\n                <div class="modal-dialog modal-md " role="document">\n                    <div class="modal-content text-dark" style = \'background-color:rgba(230,230,230,0.95);\'>\n                        <button type="button" class="close p-2 ml-auto text-dark" data-dismiss="modal">&times;</button>\n                        <div class = \'modal-header\'>\n                            <h3 class="mb-0 ">Welcome to the TimeSync Ancillary Data Viewer!</h3>\n                        </div>\n                        <div class="modal-body" id = \'introModal-body\'>\n                            <p class="pb-2 ">This viewer is intended to provide an efficient way of looking at ancillary data to help with responses for the TimeSync tool.</p>\n                        </div>\n                        <div class = \'modal-footer\' id = \'introModal-footer\'>\n                        <div class = \' ml-0\' id = \'intro-modal-loading-div\'>\n                            <p>\n                              <img style="width:1.8em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                                Creating map services within Google Earth Engine. \n                             </p>\n                        </div>\n\t\t\t\t\t\t<div class="form-check  mr-0">\n                                <input role="option" type="checkbox" class="form-check-input" id="dontShowAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                <label class=" text-uppercase form-check-label " for="dontShowAgainCheckbox" >Don\'t show again</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>',LT:'<div class="modal fade "  id="introModal" tabindex="-1" role="dialog" >\n                <div class="modal-dialog modal-md " role="document">\n                    <div class="modal-content text-dark" style = \'background-color:rgba(230,230,230,0.95);\'>\n                        <button type="button" class="close p-2 ml-auto text-dark" data-dismiss="modal">&times;</button>\n                        <div class = \'modal-header\'>\n                            <h3 class="mb-0 ">Welcome to the LandTrendr Data Explorer!</h3>\n                        </div>\n                        <div class="modal-body" id = \'introModal-body\' >\n                            <li>\n                                <p class="pb-2 ">This tool allows for quick exploration of significant changes visible in the Landsat time series using the <a href="https://emapr.github.io/LT-GEE/" target="_blank">LandTrendr temporal segmentation algorithm</a>. While this tool can run across any area on earth, the quality of the output will be related to the availability of cloud-free Landsat observations.</p>\n                            </li>\n                            <li>\n                                <p class="pb-2 ">LandTrendr will run across the entire extent of the map when it is loaded. If you would like to map a different area, move to the view extent you would like to map, and then press the <kbd>Submit</kbd> button at the bottom of the <kbd>PARAMETERS</kbd> collapse menu.</p>\n                            </li>\n                             <li>\n                                <p class="pb-2 ">All Landsat image processing and LandTrendr algorithm application is being performed on-the-fly. This can take some time to run. If you try to run this tool across a very large extent (zoom level < 9), it may not run.</p>\n                            </li> \n                        </div>\n                        <div class = \'modal-footer\' id = \'introModal-footer\'>\n                        <div class = \' ml-0\' id = \'intro-modal-loading-div\'>\n                            <p>\n                              <img style="width:1.8em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                                Creating map services within Google Earth Engine. \n                             </p>\n                        </div>\n                        <div class="form-check  mr-0">\n                                <input role="option" type="checkbox" class="form-check-input" id="dontShowAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                <label class=" text-uppercase form-check-label " for="dontShowAgainCheckbox" >Don\'t show again</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>',MTBS:'<div class="modal fade "  id="introModal" tabindex="-1" role="dialog" >\n                <div class="modal-dialog modal-md " role="document">\n                    <div class="modal-content text-dark" style = \'background-color:rgba(230,230,230,0.95);\'>\n                        <button type="button" class="close p-2 ml-auto text-dark" data-dismiss="modal">&times;</button>\n                        <div class = \'modal-header\'>\n                            <h3 class="mb-0 ">Welcome to the MTBS Data Explorer!</h3>\n                        </div>\n                        <div class="modal-body" id = \'introModal-body\'>\n                            <p class="pb-2 ">This tool is intended to allow for interactive exploration of the Monitoring Trends in Burn Severity (MTBS) data record.</p>\n                        </div>\n                        <div class = \'modal-footer\' id = \'introModal-footer\'>\n                        <div class = \' ml-0\' id = \'intro-modal-loading-div\'>\n                            <p>\n                              <img style="width:1.8em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                                Creating map services within Google Earth Engine. \n                             </p>\n                        </div>\n                        <div class="form-check  mr-0">\n                                <input role="option" type="checkbox" class="form-check-input" id="dontShowAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                <label class=" text-uppercase form-check-label " for="dontShowAgainCheckbox" >Don\'t show again</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>',LAMDA:'<div class="modal fade "  id="introModal" tabindex="-1" role="dialog" >\n                <div class="modal-dialog modal-md " role="document">\n                    <div class="modal-content text-dark" style = \'background-color:rgba(230,230,230,0.95);\'>\n                        <button type="button" class="close p-2 ml-auto text-dark" data-dismiss="modal">&times;</button>\n                        <div class = \'modal-header\'>\n                            <h3 class="mb-0 ">Welcome to the Landscape Automated Monitoring and Detection Algorithm (LAMDA) Data Explorer!</h3>\n                        </div>\n                        <div class="modal-body" id = \'introModal-body\'>\n                            <p>LAMDA is a near real-time landscape-scale change detection program developed by the USDA Forest Service to serve as a \'hot spot\' indicator for areas where finer resolution data may be used for further investigation and to serve as an indicator of severe changes over forested regions. This application is designed to provide a visualization of LAMDA outputs.</p>\n                        </div>\n                        <div class = \'modal-footer\' id = \'introModal-footer\'>\n                        <div class = \' ml-0\' id = \'intro-modal-loading-div\'>\n                            <p>\n                              <img style="width:1.8em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                                Creating map services within Google Earth Engine. \n                             </p>\n                        </div>\n                        <hr>\n                        <div class="form-check  mr-0">\n                                <input role="option" type="checkbox" class="form-check-input" id="dontShowAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                <label class=" text-uppercase form-check-label " for="dontShowAgainCheckbox" >Don\'t show again</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>'},loadingModal:'<p>\n                  <img style="width:2.1em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                    Creating map services within Google Earth Engine. \n                  <br>\n                   <img style="width:2.1em;" class="image-icon fa-spin mr-1" alt= "Google Earth Engine logo spinner" src="images/GEE_logo_transparent.png">\n                    This can take some time. Thank you for your patience!\n                   <div id = \'loading-number-box\'></div>\n                 </p>\n                  ',bottomBar:'<footer class = \'bottombar\'  id = \'bottombar\' >\n        \t\t\t<span class = \'px-2\'  id=\'current-tool-selection\' title="Any tool that is currently active is shown here."></span>\n        \t\t\t<span class = \'px-2\' title="All map layers are dynamically requested from Google Earth Engine.  The number of outstanding requests is shown here.">Queue length for maps from GEE: <span id=\'outstanding-gee-requests\'>0</span></span>\n                    <span class = \'px-2\' title="The number of outstanding map layers currently loading tiles.">Number of map layers loading tiles: <span id=\'number-gee-tiles-downloading\'>0</span></span>\n                    <span title="Current location and elevation of mouse pointer and map zoom level and respective map scale" class = \'px-2\'  id=\'current-mouse-position\'  ></span>\n                    <span id = \'contributor-logos\' > \n                        <a href="https://earthengine.google.com/" target="_blank">\n                            <img src="images/GEE.png"   class = \'image-icon-bar\' alt="Powered by Google Earth Engine"  href="#" title="Click to learn more about Google Earth Engine">\n                        </a>\n                        <a href="http://www.fs.fed.us//" target="_blank">\n                            <img src="images/usfslogo.png" class = \'image-icon-bar\'  href="#"  alt= "USDA Forest Service logo" title="Click to learn more about the US Forest Service">\n                        </a>\n                        <a href="http://www.usda.gov" target="_blank">\n                            <img src="images/usdalogo.png" class = \'image-icon-bar\'  href="#"   alt= "USDA logo" title="Click to learn more about the USDA">\n                        </a>\n                    </span>\n                </footer>',walkThroughPopup:"<div class = 'walk-through-popup'>\n                            <div id = 'walk-through-popup-content' class = 'walk-through-popup-content'></div>\n\t                       \t\t<div class = 'dropdown-divider'></div>\n\t\t                        <div class=\"icon-bar py-1 \">\n\t\t\t\t\t\t\t\t  <a onclick = 'previousWalkThrough()' title = 'Previous tutorial slide'><i class=\"fa fa-chevron-left text-black\"></i></a>\n\t\t\t\t\t\t\t\t  <a onclick = 'nextWalkThrough()'  title = 'Next tutorial slide'><i class=\"fa fa-chevron-right text-black\"></i></a>\n\t\t\t\t\t\t\t\t  <a id = 'walk-through-popup-progress'></a>\n                                  <a onclick = 'removeWalkThroughCollapse()' style = 'float:right;'  title = 'Turn off Walk-Through'><i class=\"fa fa-stop text-black\" aria-hidden=\"true\"></i></a>\n                                </div>\n\t\t\t\t\t\t</div>",studyAreaDropdownButtonEnabledTooltip:"Choose your study area",studyAreaDropdownButtonDisabledTooltip:"Still waiting on previous map layer requests. Can change study area once the previous requests are finished.",reRunButtonEnabledTooltip:"Once finished changing parameters, press this button to refresh map layers",reRunButtonDisabledTooltip:"Still waiting on previous map layer requests. Can re-submit once the previous requests are finished.",reRunButton:"<button id = 'reRun-button' onclick = 'reRun()' class = 'mb-1 ml-1 btn ' title=\"\">Submit</button>",addTimelapsesButton:"<button id = 'addTimelapses-button' onclick = 'addLCMSTimeLapses()' class = 'mb-1 ml-1 btn ' title=\"Add interactive time lapse of LCMS Change and Land Cover products. This will slow down the map loading\">Add LCMS Time Lapses To Map</button>",downloadDiv:"<div class = 'py-2'>\n                        <a id = 'product-descriptions' target = '_blank'>Detailed Product Description</a>\n        \t\t\t\t<div class = 'dropdown-divider'></div>\n                        <label  title = 'Choose from dropdown below to download LCMS products. There can be a small delay before a download will begin, especially over slower networks.' for=\"downloadDropdown\">Select product to download:</label>\n    \t\t\t\t\t<select class=\"form-control\" id = \"downloadDropdown\" onchange = \"downloadSelectedArea()\"\"></select>\n    \t\t\t\t </div>",lcmsProductionDownloadDiv:'<ul id="downloadTree" class = \'pl-0 mb-0\' title = \'Click through available LCMS products. Select which outputs to download, and then click the download button. Hold ctrl key to select multiples or shift to select blocks.\'>\n                                          <li class = \'pl-0\'><span class="caret caret-down">Conterminous United States (v2021.7)</span>\n                                            <ul class="nested active">\n                                              <li><span class="caret">Change</span>\n                                                <ul class="nested">\n                                                  <li><span class="caret" title = \'Single layer summaries of what year change was mapped by LCMS serve as the foundational LCMS product that is easiest to work with in your local GIS. These are the same as the Slow Loss, Fast Loss, and Gain Year layers in the viewer.\'>Summary</span>\n                                                    <ul class="nested" id = \'CONUS-change-summary-downloads\'></ul>\n                                                  </li>\n                                                  <li><span class="caret" title = \'Annual change layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the change time lapse.\'>Annual</span>\n                                                    <ul class="nested" id = \'CONUS-change-annual-downloads\'></ul>\n                                                  </li>\n                                                </ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual land cover layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the land cover time lapse.\'>Land Cover</span>\n                                                <ul class="nested" id = \'CONUS-land_cover-annual-downloads\'></ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual land use layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the land use time lapse.\'>Land Use</span>\n                                                <ul class="nested" id = \'CONUS-land_use-annual-downloads\'></ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual QA-bits depict ancillary information about the origin of the data used to produce LCMS products.\'>QA Bits</span>\n                                                <ul class="nested" id = \'CONUS-qa_bits-annual-downloads\'></ul>\n                                              </li>\n                                            </ul>\n                                          </li>\n                                          <li><span class="caret caret-down">Southeastern Alaska (v2021.7)</span>\n                                            <ul class="nested active">\n                                              <li><span class="caret">Change</span>\n                                                <ul class="nested">\n                                                  <li><span class="caret" title = \'Single layer summaries of what year change was mapped by LCMS serve as the foundational LCMS product that is easiest to work with in your local GIS. These are the same as the Slow Loss, Fast Loss, and Gain Year layers in the viewer.\'>Summary</span>\n                                                    <ul class="nested" id = \'SEAK-change-summary-downloads\'></ul>\n                                                  </li>\n                                                  <li><span class="caret" title = \'Annual change layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the change time lapse.\'>Annual</span>\n                                                    <ul class="nested" id = \'SEAK-change-annual-downloads\'></ul>\n                                                  </li>\n                                                </ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual land cover layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the land cover time lapse.\'>Land Cover</span>\n                                                <ul class="nested" id = \'SEAK-land_cover-annual-downloads\'></ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual land use layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the land use time lapse.\'>Land Use</span>\n                                                <ul class="nested" id = \'SEAK-land_use-annual-downloads\'></ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual QA-bits depict ancillary information about the origin of the data used to produce LCMS products.\'>QA Bits</span>\n                                                <ul class="nested" id = \'SEAK-qa_bits-annual-downloads\'></ul>\n                                              </li>\n                                            </ul>\n                                          </li>\n                                          <li><span class="caret caret-down">Puerto Rico - US Virgin Islands (v2020.6)</span>\n                                            <ul class="nested active">\n                                              <li><span class="caret">Change</span>\n                                                <ul class="nested">\n                                                  <li><span class="caret" title = \'Single layer summaries of what year change was mapped by LCMS serve as the foundational LCMS product that is easiest to work with in your local GIS. These are the same as the Fast Loss, and Gain Year layers in the viewer.\'>Summary</span>\n                                                    <ul class="nested" id = \'PRUSVI-change-summary-downloads\'></ul>\n                                                  </li>\n                                                  <li><span class="caret" title = \'Annual change layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the change time lapse.\'>Annual</span>\n                                                    <ul class="nested" id = \'PRUSVI-change-annual-downloads\'></ul>\n                                                  </li>\n                                                </ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual land cover layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the land cover time lapse.\'>Land Cover</span>\n                                                <ul class="nested" id = \'PRUSVI-land_cover-annual-downloads\'></ul>\n                                              </li>\n                                              <li><span class="caret" title = \'Annual land use layers provide a more flexible product that can suite more customized data analysis. These are the same as the layers shown in the land use time lapse.\'>Land Use</span>\n                                                <ul class="nested" id = \'PRUSVI-land_use-annual-downloads\'></ul>\n                                              </li>\n                                            </ul>\n                                          </li>\n                                        </ul>',supportDiv:`<div  class = 'py-2 pl-3 pr-1'>\n                        <header class = 'row ' title = 'Open LCMS Data Explorer tutorial'>\n                            <h3 class = ' text-capitalize'>Tutorial</h3>\n                        </header>\n                        <div class = 'row ' title = 'Open LCMS Data Explorer tutorial'>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <img class = 'support-icons' alt = 'Information icon' src = './images/information--v2.png'></a> \n                            </div>\n                            <div class = 'col-lg-10'>\n                                <a class = 'support-text' onclick = 'downloadTutorial()'>\n                                Click to launch a tutorial that explains how to utilize the Data Explorer</a>\n                            </div>\n                        </div>\n                        <hr>\n                         <header class = 'row ' title = 'Open in-depth LCMS methods documentation'>\n                            <h3 class = ' text-capitalize'>LCMS Methods</h3>\n                        </header>\n                        <div class = 'row ' title = 'Open in-depth LCMS methods documentation'>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <img class = 'support-icons' alt = 'Methods icon' src = './images/methods-icon.png'></a> \n                            </div>\n                            <div class = 'col-lg-10'>\n                                Click to open in-depth methods document:\n                                <li>\n                                    <a class = 'support-text' onclick = 'downloadMethods("v2021-7")' title = 'Open in-depth LCMS v2021.7 methods documentation'>Version 2021.7 (CONUS and SEAK)</a>\n                                </li>\n                                <li>\n                                    <a class = 'support-text' onclick = 'downloadMethods("v2020-6")' title = 'Open in-depth LCMS v2020.6 methods documentation'>Version 2020.6 (PRUSVI)</a>\n                                </li>   \n                            </div>\n                        </div>\n                        <hr>\n                        <header class = 'row'>\n                            <h3 class = ' text-capitalize' title = "In addition to this viewer, there are viewers to help visualize and explore other aspects of the LCMS data flow">Other LCMS Viewers</h3>\n                        </header>\n                        <section class = 'row'>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <a title = "In addition to this viewer, there are viewers to help visualize and explore other aspects of the LCMS data flow" ><img class = 'support-icons' alt = 'Email icon' src = './images/lcms-icon.png'></a> \n                            </div>\n                            <div class = 'col-lg-10'>\n                                <a class = 'support-text' title = "Visualize and explore time series datasets used to create the LCMS map outputs" href = "lcms-base-learner.html" target="_blank">LCMS Base Learner Explorer</a>\n                                <hr>\n                                <a class = 'support-text' title = "Visualize pre-made gifs illustrating patterns of change across USFS Forests and Districts" href = "lcms-in-motion.html" target="_blank">LCMS-in-Motion</a>\n                            </div>\n                        </section>\n                        <hr>\n                        <header class = 'row'>\n                            <h3 class = ' text-capitalize'>Acknowledgements</h3>\n                        </header>\n                        <section class = 'row'>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <a href="https://www.fs.fed.us/gstc/" target="_blank">\n                                <img src="./images/GTAC_Logo.png" class = 'support-icons' alt="GTAC Logo"  href="#" alt = "Geospatial Technology and Applications Center logo" title="Click to learn more about the Geospatial Technology and Applications Center (GTAC)">\n                                </a>\n                            </div>\n                            <div class = 'col-lg-10'>\n                                <a href="https://www.fs.fed.us/gstc/" target="_blank">\n                                    <p class = 'support-text'>The Geospatial Technology and Applications Center (GTAC) provides leadership in geospatial science implementation in the USDA Forest Service by delivering vital services, data products, tools, training, and innovation to solve today’s land and resource management challenges. All operational LCMS production and support takes place at GTAC.</p>\n                                </a>\n                            </div>\n                        </section>\n                        <hr>\n                        <section class = 'row '>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <a href="https://www.redcastleresources.com/" target="_blank">\n                                    <img src="images/RCR-logo.jpg"  class = 'support-icons' alt="RedCastle Inc. Logo"  href="#"   title="Click to learn more about RedCastle Resources Inc."> \n                                </a>\n                            </div>\n                            <div class = 'col-lg-10'>\n                                <a href="https://www.redcastleresources.com/" target="_blank">\n                                    <p class = 'support-text'>RedCastle Resources Inc. is the on-site contractor that has provided the technical expertise for LCMS' operational production, documentation, and delivery at GTAC.</p>\n                                </a>\n                            </div>\n                        </section>\n                        <hr>\n                        <section class = 'row '>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <a href="https://www.fs.usda.gov/rmrs/tools/landscape-change-monitoring-system-lcms" target="_blank">\n                                <img src="./images/usfslogo.png" class = 'support-icons' alt="USFS Logo"  href="#"  title="Click to learn more about the Rocky Mountain Research Station (RMRS)">\n                                </a>\n                            </div>\n                            <div class = 'col-lg-10'>\n                                <a href="https://www.fs.usda.gov/rmrs/tools/landscape-change-monitoring-system-lcms" target="_blank">\n                                    <p class = 'support-text'>The Rocky Mountain Research Station provides the scientific foundation LCMS is built upon. They have been instrumental in developing and publishing the original LCMS methodology and continue to provide ongoing research and development to further improve LCMS methods.</p>\n                                </a>\n                            </div>\n                        </section>\n                        \n                        <hr>\n                        <section class = 'row'>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <a href="https://earthengine.google.com/" target="_blank">\n                                    <img src="images/GEE_logo_transparent.png"  class = 'support-icons' alt="Google Earth Engine Logo"  href="#"   title="Click to learn more about Google Earth Engine">\n                                    \n                                </a>\n                            </div>\n                            <div class = 'col-lg-10'>\n                                <a href="https://earthengine.google.com/" target="_blank">\n                                    <p class = 'support-text'>LCMS utilizes Google Earth Engine for most of its data acqusition, processing, and visualization, through an enterprise agreement between the USDA Forest Service and Google. In its current form, LCMS would not be possible without Google Earth Engine.</p>\n                                </a>\n                            </div>\n                        </section>\n                        <hr>\n                        <section class = 'row'>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <h2>"..."</h2>\n                            </div>\n                            <div class = 'col-lg-10  support-text'>\n                                    Suggested citation: \n                                    <p class = 'support-text' onclick = 'copyText("suggested-citation-text","copiedCitationMessageBox")' id = 'suggested-citation-text'>Forest Service, U.S. Department of Agriculture (2022). Landscape Change Monitoring System Data Explorer [Online]. Available at: https://apps.fs.usda.gov/lcms-viewer (Accessed: ${(new Date).toStringFormat()}).\n                                    </p>\n                                    <span>\n                                        <button onclick = 'copyText("suggested-citation-text","copiedCitationMessageBox")'' title = 'Click to copy suggested citation to clipboard' class="py-0 pr-1 fa fa-copy btn input-group-text bg-white" >\n                                        </button>\n                                        <p id = 'copiedCitationMessageBox'></p>\n                                    </span>\n                            </div>\n                        </section>\n                        <hr>\n                        <header class ='row'>\n                            <h3 class ='text-capitalize'>Contact</h3>\n                        </header>\n                        <section class = 'row '>\n                            <div class = 'col-lg-2 p-0 m-0'>\n                                <a title = "Send us an E-mail" href = "mailto: sm.fs.lcms@usda.gov"><img class = 'support-icons' alt = 'Email icon' src = './images/email.png'></a> \n                            </div>\n                            <div class = 'col-lg-10'>\n                                <a class = 'support-text' title = "Send us an E-mail" href = "mailto: sm.fs.lcms@usda.gov">\n                                Please contact the LCMS help desk <span href = "mailto: sm.fs.lcms@usda.gov">(sm.fs.lcms@usda.gov)</span> if you have questions/comments about LCMS or have feedback on the LCMS Data Explorer.</a>\n                            </div>\n                        </section>\n        \t\t\t</div>`,tooltipToggle:" <label class = 'mt-2'>If you turned off tool tips, but want them back:</label>\n                        <button  class = 'btn  bg-black' onclick = 'showToolTipsAgain()'>Show tooltips</button>",walkThroughButton:`<div >\n                            <label class = 'mt-2'>Run a walk-through of the ${mode} Data Explorer's features</label>\n                            <button  class = 'btn  bg-black' onclick = 'toggleWalkThroughCollapse()' title = 'Run interactive walk-through of the features of the ${mode} Data Explorer'>Run Walk-Through</button>\n                          </div>`,distanceDiv:"Click on map to measure distance",distanceTip:"Click on map to measure distance. Press <kbd>ctrl+z</kbd> to undo most recent point. Double-click, press <kbd>Delete</kbd>, or press <kbd>Backspace</kbd> to clear measurment and start over.",areaDiv:"Click on map to measure area<variable-radio onclick1 = 'updateArea()' onclick2 = 'updateArea()' var='metricOrImperialArea' title2='' name2='Metric' name1='Imperial' value2='metric' value1='imperial' type='string' title='Toggle between imperial or metric units'></variable-radio>\n       ",areaTip:"Click on map to measure area. Double-click to complete polygon, press <kbd>ctrl+z</kbd> to undo most recent point, press <kbd>Delete</kbd> or <kbd>Backspace</kbd> to start over. Any number of polygons can be defined by repeating this process.",queryDiv:"<div>Double-click on map to query values of displayed layers at that location</div>",queryTip:"Double-click on map to query the values of the visible layers.  Only layers that are turned on will be queried.",pixelChartDiv:`<div>Double-click on map to query ${mode} data time series<br></div>`,pixelChartTip:"Double-click on map to look at the full time series of "+mode+" outputs for a pixel.",userDefinedAreaChartDiv:"<div  id=\"user-defined\" >\n                                            <label>Provide name for area selected for charting (optional):</label>\n                                            <input title = 'Provide a name for your chart. A default one will be provided if left blank.'  type=\"user-defined-area-name\" class=\"form-control my-1\" id=\"user-defined-area-name\" placeholder=\"Name your charting area!\" style='width:80%;'>\n                                            <div class = 'dropdown-divider'></div>\n                                            <div>Total area selected: <i id = \"user-defined-area-spinner\" style = 'display:none;' class=\"fa fa-spinner fa-spin text-dark pl-1\"></i></div>\n                                            <div id = 'user-defined-features-area' class = 'select-layer-name'>0 hectares / 0 acres</div>\n                                            <div id = 'user-defined-edit-toolbar'></div>\n                                            <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'chartUserDefinedArea()' title = 'Click to summarize across drawn polygons'>Chart Selected Areas</button>\n        \t\t            \t\t\t</div>\n                                \t</div>",showChartButton:"<div class = 'py-2'>\n                                <button onclick = \"$('#chart-modal').modal()\" class = 'btn bg-black' title = \"If you turned off the chart, but want to show it again\" >Turn on Chart</button>\n                                </div>",userDefinedAreaChartTip:"Click on map to select an area to summarize "+mode+" products across. Press <kbd>ctrl+z</kbd> to undo most recent point.  Press <kbd>Delete</kbd>, or press <kbd>Backspace</kbd> to start over. Double-click to finish polygon. Any number of polygons can be defined by repeating this process. Once finished defining areas, click on the <kbd>Chart Selected Areas</kbd> button to create chart.",uploadAreaChartDiv:"<div class = 'dropdown-divider'></div>\n                                <label title = 'Powered by: https://ogre.adc4gis.com/'>Choose a zipped shapefile, kml, kmz, or geoJSON file to summarize across. Then hit \"Chart across chosen file\" button below to produce chart.</label>\n                                <input class = 'file-input my-1' type=\"file\" id=\"areaUpload\" name=\"upload\" accept=\".zip,.geojson,.json,.kmz,.kml\" style=\"display: inline-block;\">\n                                <div class = 'dropdown-divider'></div>\n                                <div id = 'upload-reduction-factor-container'></div>\n                                <div class = 'dropdown-divider'></div>\n                                <div>Uploaded areas:</div>\n                                <div id=\"area-charting-shp-layer-list\"></div>\n                                <div class = 'dropdown-divider'></div>\n                                <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'runShpDefinedCharting()' title = 'Click to summarize across chosen .zip shapefile, .kmz, .kml, or .geojson.'>Chart across chosen file</button>",uploadAreaChartTip:"Select zipped shapefile (zip into .zip all files related to the shapefile) or a single .kmz, .kml (If the .kmz or .kml has embedded pngs or any other non vector data, the conversion will likely fail.), or .geojson file to summarize products across.",selectAreaDropdownChartDiv:"<i title=\"Selecting pre-defined summary areas for chosen study area\" id = \"select-area-spinner\" class=\"text-dark px-2 fa fa-spin fa-spinner\"></i>\n                            <select class = 'form-control' style = 'width:100%;'  id='forestBoundaries' onchange='chartChosenArea()'></select>\n                            <div class = 'dropdown-divider'></div>",selectAreaDropdownChartTip:"Select from pre-defined areas to summarize products across.",selectAreaInteractiveChartDiv:"<div>Choose from layers below and click on map to select areas to include in chart</div>\n                                        <div class = 'dropdown-divider'></div>\n                                        <label>Provide name for area selected for charting (optional):</label>\n                                        <input title = 'Provide a name for your chart. A default one will be provided if left blank.'  type=\"user-selected-area-name\" class=\"form-control\" id=\"user-selected-area-name\" placeholder=\"Name your charting area!\" style='width:80%;'>\n                                        <div class = 'dropdown-divider'></div>\n                                        <div id = 'simplify-error-range-container'></div>\n                                        <div class = 'dropdown-divider'></div>\n                                        <div id=\"area-charting-select-layer-list\"></div>\n                                        <div class = 'dropdown-divider'></div>\n                                        <div>Selected areas:</div>\n                                        <i id = \"select-features-list-spinner\" style = 'display:none;' class=\"fa fa-spinner fa-spin text-dark\"></i>\n                                        <li class = 'selected-features-list' id = 'selected-features-list'></li>\n                                        <div id=\"area-charting-selected-layer-list\"></div>\n                                        <div class = 'dropdown-divider'></div>\n                                        <div>Total area selected: <i id = \"select-features-area-spinner\" style = 'display:none;' class=\"fa fa-spinner fa-spin text-dark pl-1\"></i></div>\n                                        <div id = 'selected-features-area' class = 'select-layer-name'>0 hectares / 0 acres</div>\n                                        <div id = 'select-features-edit-toolbar'></div>\n                                        <button class = 'btn' onclick = 'chartSelectedAreas()'>Chart Selected Areas</button>\n                                        <div class = 'dropdown-divider'></div>",selectAreaInteractiveChartTip:"Select from pre-defined areas on map to summarize products across.",shareButtons:'\x3c!-- Email --\x3e\n                        <a title = \'Share via E-mail\' onclick = \'TweetThis("mailto:?Subject=USDA Forest Service Landscape Change Monitoring System&amp;Body=I%20saw%20this%20and%20thought%20you%20might%20be%20interested.%20 ","",true)\'>\n                            <img class = \'image-icon-bar\' src="./images/email.png" alt="Email" />\n                        </a>\n                        <a title = \'Share on Reddit\' onclick = \'TweetThis("http://reddit.com/submit?url=","&amp;title=USDA Forest Service Landscape Change Monitoring System",true)\' >\n                            <img class = \'image-icon-bar\' src="./images/reddit.png" alt="Reddit" />\n                        </a>\n                        <a title = \'Share on Twitter\' onclick = \'TweetThis("https://twitter.com/share?url=","&amp;text=USDA Forest Service Landscape Change Monitoring System&amp;hashtags=USFSLCMS",true)\' >\n                            <img class = \'image-icon-bar\' src="./images/twitter.png" alt="Twitter" />\n                        </a>\n                        <a  title = \'Share on Facebook\' onclick = \'TweetThis("http://www.facebook.com/sharer.php?u=","",true)\' >\n                            <img class = \'image-icon-bar\' src="./images/facebook.png" alt="Facebook" />\n                        </a>'};function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,showLocationError):(showMessage("Cannot acquire location","Geolocation is not supported by this browser."),ga("send","event",mode+"-getLocation","failure","failure"))}function showPosition(e){const a={lng:e.coords.longitude,lat:e.coords.latitude};ga("send","event",mode+"-getLocation","success",JSON.stringify(a));new google.maps.Marker({map:map,position:a,icon:{path:google.maps.SymbolPath.CIRCLE,scale:5,strokeColor:"#FF0",map:map}});map.setCenter(a),map.setZoom(10),showMessage("Acquired location","Latitude: "+e.coords.latitude+"<br>Longitude: "+e.coords.longitude)}function showLocationError(e){switch(e.code){case e.PERMISSION_DENIED:showMessage("Cannot acquire location","User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:showMessage("Cannot acquire location","Location information is unavailable.");break;case e.TIMEOUT:showMessage("Cannot acquire location","The request to get user location timed out.");break;case e.UNKNOWN_ERROR:showMessage("Cannot acquire location","An unknown error occurred.")}}function addDropdown(containerID,dropdownID,dropdownLabel,variable,tooltip){null==tooltip&&(tooltip=""),$("#"+containerID).append(`<div id="${dropdownID}-container" class="form-group" title="${tooltip}">\n\t\t\t\t\t\t\t\t  <label for="${dropdownID}">${dropdownLabel}:</label>\n\t\t\t\t\t\t\t\t  <select class="form-control" id="${dropdownID}"></select>\n\t\t\t\t\t\t\t\t</div>`),$("select#"+dropdownID).on("change",(function(value){eval(`window.${variable} = $(this).val()`)}))}function addDropdownItem(e,a,t,o){null==o&&(o=""),$("#"+e).append(`<option title = '${o}' value = "${t}">${a}</option>`)}function addShapeEditToolbar(e,a,t,o,l,r){null==l&&(l="Click to undo last drawn point (ctrl z)"),null==r&&(r="Click to clear current drawing and start a new one (Delete, or Backspace)"),$("#"+e).append(`<div class = 'dropdown-divider'></div>\n\t\t\t\t\t\t\t\t    <div id = '${a}' class="icon-bar ">\n\t\t\t\t\t\t\t\t    \t<a href="#" onclick = '${t}' title = '${l}''><i class="btn fa fa-undo"></i></a>\n\t\t\t\t\t\t\t\t\t  \t<a href="#" onclick = '${o}' title = '${r}'><i class="btn fa fa-trash"></i></a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class = 'dropdown-divider'></div>`)}Object.keys(staticTemplates).filter((e=>e.indexOf("Tip")>-1)).map((function(e){let a=staticTemplates[e].replaceAll("<kbd>","");a=a.replaceAll("</kbd>",""),staticTemplates[e+"Hover"]=a}));const setRadioValue=function(e,a){console.log(a),window[e]=a};function getRadio(e,a,t,o,l,r,n){return`<div class = 'container'>\n                <div id = '${e}-row' class = 'row'>\n            \t\t<label class="col-sm-4">${a}</label>\n            \t\t<div class = 'col-sm-8'>\n                \t\t<div  id = '${e}' class="toggle_radio">\n                            <input type="radio" checked class="toggle_option first_toggle" id="first_toggle${e}" name="toggle_option" onclick="setRadioValue('${l}','${r}')"  >\n                \t       <input type="radio"  class="toggle_option second_toggle" id="second_toggle${e}" name="toggle_option" onclick="setRadioValue('${l}','${n}')">\n                \t       <label for="first_toggle${e}"><p>${t}</p></label>\n                \t       <label for="second_toggle${e}"><p>${o}</p></label>\n                \t       <div class="toggle_option_slider"></div>\n            \t        </div>\n            \t   </div>\n        \t   </div>\n        \t</div>`}function getDiv(containerID,divID,label,variable,value){eval(`var ${variable} = ${value}`),console.log(eval(variable));var div=`<div id = "${divID}">${label}</div>`;$("#"+containerID).append(div),$("#"+divID).click((function(){eval(`${variable}++`),console.log(eval(variable)),$("#"+divID).append(eval(variable))}))}function getToggle(containerID,toggleID,onLabel,offLabel,onValue,offValue,variable,checked){null==checked||"true"===checked||"checked"===checked?checked=!0:"false"!==checked&&""!==checked||(checked=!1);var valueDict={true:onValue,false:offValue};eval(`window.${variable} = valueDict[checked]`);var toggle=`<input role="option" id = "${toggleID}" class = 'p-0 m-0' type="checkbox"  data-toggle="toggle" data-on="${onLabel}" data-off="${offLabel}" data-onstyle="toggle-on" data-offstyle="toggle-off"><br>`;$("#"+containerID).append(toggle),checked&&$("#"+toggleID).bootstrapToggle("on"),$("#"+containerID).click((function(){var value=$("#"+toggleID).prop("checked");console.log(value),eval(`window.${variable} = valueDict[${value}]`)}))}function updateDistanceColor(e){distancePolylineOptions.strokeColor="#"+e,void 0!==distancePolyline&&distancePolyline.setOptions(distancePolylineOptions)}function updateUDPColor(e){udpOptions.strokeColor="#"+e,Object.keys(udpPolygonObj).map((function(e){udpPolygonObj[e].setOptions(udpOptions)}))}function updateAreaColor(e){areaPolygonOptions.strokeColor="#"+e,Object.keys(areaPolygonObj).map((function(e){areaPolygonObj[e].setOptions(areaPolygonOptions),console.log(areaPolygonObj[e])}))}function addColorPicker(e,a,t,o){null==o&&(o="FFFF00"),$("#"+e).append(`<button id = '${a}' data-toggle="tooltip" title="If needed, change the color of shape you are drawing"\n\t\t\t\t\t\t\t    class=" fa fa-paint-brush text-dark color-button jscolor {valueElement:null,value:'${o}',onFineChange:'${t}(this)'} "\n\t\t\t\t\t\t\t    ></button>`)}function addModal(e,a,t){null==t&&(t=!1),null==e&&(e="main-container"),null==a&&(a="modal-id"),$("#"+a).remove(),t?$("#"+e).append(`<div id = "${a}" class="modal fade " role="dialog">\n            \t<div class="modal-dialog modal-md ">\n            \t\t<div class="modal-content modal-content-not-full-screen-styling">\n\t            \t\t<div style = ' border-bottom: 0 none;'class="modal-header pb-0" id ="${a}-header">\n\t            \t\t\t<button style = 'float:right;' id = 'close-modal-button' type="button" class="close text-dark" data-dismiss="modal">&times;</button>\n\t            \t\t</div>\n\t      \t\t\t\t<div id ="${a}-body" class="modal-body " ></div>\n        \t\t\t</div>\n        \t\t</div> \n        \t</div>`):$("#"+e).append(`\n            <div id = "${a}" class="modal fade " role="dialog">\n            \t<div class="modal-dialog modal-lg ">\n            \t\t<div class="modal-content bg-black">\n            \t\t<button type="button" class="close p-2 ml-auto" data-dismiss="modal">&times;</button>\n\t            \t\t<div class="modal-header py-0" id ="${a}-header"></div>\n\t      \t\t\t\t<div id ="${a}-body" class="modal-body " style = 'background:#DDD;' ></div>\n\t\t\t          \t<div class="modal-footer" id ="${a}-footer"></div>\n        \t\t\t</div>\n        \t\t</div> \n        \t</div>`)}function addModalTitle(e,a){null==e&&(e="modal-id"),$("#"+e+" .modal-header").prepend(`<h4 class="modal-title" id = '${e}-title'>${a}</h4>`)}function clearModal(e){null==e&&(e="modal-id"),$("#"+e+"-title .modal-title").html(""),$("#"+e+"-header").html(""),$("#"+e+"-body").html(""),$("#"+e+"-footer").html(""),$(".modal").modal("hide"),$(".modal-backdrop").remove()}function showMessage(e,a,t,o){null==e&&(e=""),null==a&&(a=""),null==o&&(o=!0),null==t&&(t="error-modal"),clearModal(t),addModal("main-container",t,!0),addModalTitle(t,e),$("#"+t+"-body").append(a),o&&$("#"+t).modal()}function showTip(e,a){showMessage("",'<span class = "font-weight-bold text-uppercase" >'+e+" </span><span>"+a+"</span>","tip-modal",!1),$("#tip-modal-body").append('<form class="form-inline pt-3 pb-0">\n\t\t\t\t\t\t\t\t  <div class="form-check  mr-0">\n                                \t<input role="option" type="checkbox" class="form-check-input" id="dontShowTipAgainCheckbox"   name = \'dontShowAgain\' value = \'true\'>\n                                \t<label class=" text-uppercase form-check-label " for="dontShowTipAgainCheckbox" >Turn off tips</label>\n                            \t\t</div>\n\t\t\t\t\t\t\t\t</form>'),null!=localStorage.showToolTipModal&&"undefined"!=localStorage.showToolTipModal||(localStorage.showToolTipModal="true"),"true"===localStorage.showToolTipModal&&0==walkThroughAdded&&$("#tip-modal").modal().show(),$("#dontShowTipAgainCheckbox").change((function(){console.log(this.checked),localStorage.showToolTipModal=!this.checked,"false"===localStorage.showToolTipModal?$("#tooltip-radio-second_toggle_label").click():"true"===localStorage.showToolTipModal&&$("#tooltip-radio-first_toggle_label").click()}))}function addStudyAreaToDropdown(e,a){var t=e.replaceAll(" ","-");$("#study-area-list").append(`<a id = '${t}' name = '${e}' class="dropdown-item "   data-toggle="tooltip" title="${a}">${e}</a>`),$("#"+t).on("click",(function(){$("#study-area-list").hide(),longStudyAreaName=this.name,dropdownUpdateStudyArea(this.name)}))}function addToggle(containerDivID,toggleID,title,onLabel,offLabel,on,variable,valueOn,valueOff,onChangeFunction,tooltip){var valueDict={true:valueOn,false:valueOff},checked;null==tooltip&&(tooltip=""),null==on||"checked"===on||"true"===on?(on=!0,checked="checked"):(on=!1,checked=""),eval(`window.${variable} = valueDict[on];`),$("#"+containerDivID).append(`<div title="${tooltip}" >${title}<input  id = "${toggleID}" data-onstyle="dark" data-offstyle="light" data-style="border" role="option" type="checkbox" data-on="${onLabel}" data-off="${offLabel}"  ${checked} data-toggle="toggle" data-width="100" data-onstyle="dark" data-offstyle="light" data-style="border" data-size="small" ></div>`),$("#"+toggleID).change((function(){var value=valueDict[$("#"+toggleID).prop("checked")];eval(`window.${variable} = value;`),eval(`${onChangeFunction}`)}))}function addRadio(containerDivID,radioID,title,onLabel,offLabel,variable,valueOn,valueOff,onFunction,offFunction,tooltip){eval(`window.${variable} = '${valueOn}';`),$("#"+containerDivID).append(`<row class = 'row' id = '${radioID}-container' title="${tooltip}">\n\t\t<h3 class="col-12 pb-0 h3">${title} </h3>\n\t\t<div class = 'col-12 pt-0'>\n    \t\t<div  id = '#${radioID}'  class="toggle_radio p-0">\n                <input type="radio" class = "first_toggle" checked class="toggle_option" id="${radioID}-first_toggle" name="${radioID}-toggle_option"  value="1" >\n    \t       <input type="radio" class="toggle_option second_toggle" id="${radioID}-second_toggle" name="${radioID}-toggle_option"  value="2" >\n    \t       <label for="${radioID}-first_toggle" id = '${radioID}-first_toggle_label'><p>${onLabel}</p></label>\n    \t       <label for="${radioID}-second_toggle"  id = '${radioID}-second_toggle_label'><p>${offLabel}</p></label>\n    \t       <div class="toggle_option_slider">\n    \t    </div>\n\t    </div>\n\t</div>\n\t</row>`),$("#"+radioID+"-first_toggle").change((function(){eval(`window.${variable} = '${valueOn}';`),eval(`${onFunction}`)})),$("#"+radioID+"-second_toggle").change((function(){eval(`window.${variable} = '${valueOff}';`),eval(`${offFunction}`)}))}function addCheckboxes(containerID,checkboxID,title,variable,optionList){$("#"+containerID).append(`<form  id = '${checkboxID}'>${title}<br></form>`),eval(`if(window.${variable} === undefined){window.${variable} = []}`),Object.keys(optionList).map((function(k){const checkboxCheckboxID=variable+k+"-checkbox",checkboxLabelID=variable+checkboxCheckboxID+"-label";"true"===optionList[k]?optionList[k]=!0:"false"===optionList[k]&&(optionList[k]=!1);let checked=optionList[k];optionList[k]=checked,checked=checked?"checked":"",eval(`window.${variable} = optionList`),$("#"+checkboxID).append(`<input  role="option" id="${checkboxCheckboxID}" type="checkbox" ${checked} value = '${k}' />\n                                 <label  id="${checkboxLabelID}" style = 'margin-bottom:0px;'  for="${checkboxCheckboxID}" >${k}</label>`),$("#"+checkboxCheckboxID).change((function(){optionList[$(this).val()]=$(this)[0].checked,eval(`window.${variable} = optionList`),console.log("Checkbox change"),console.log(optionList)}))}))}function addMultiRadio(containerID,radioID,title,variable,optionList){$("#"+containerID).append(`<form  class = 'py-2' id = '${radioID}'>${title}<br></form>`),eval(`if(window.${variable} === undefined){window.${variable} = ''};`),Object.keys(optionList).map((function(k){var radioCheckboxID=k+"-checkbox",radioLabelID=radioCheckboxID+"-label",checked=optionList[k];checked?(checked="checked",eval(`window.${variable} = "${k}"`)):checked="",$("#"+radioID).append(`<div class="form-check form-check-inline">\n                              <input role="option" class="form-check-input" type="radio" name="inlineRadioOptions" id="${radioCheckboxID}" ${checked} value="${k}">\n                              <label class="form-check-label" for="${radioCheckboxID}">${k}</label>\n                            </div>`),$("#"+radioCheckboxID).change((function(){var v=$(this).val();eval(`window.${variable} = "${v}"`)}))}))}function zeroPad(e,a){var t=a-e.toString().length+1;return Array(+(t>0&&t)).join("0")+e}function formatDT(e){var a=e.getFullYear();return zeroPad(e.getMonth()+1,2)+"/"+zeroPad(e.getDate(),2)+"/"+a.toString().slice(2,4)}function formatDTJulian(e){return zeroPad(e.getMonth()+1,2)+"/"+zeroPad(e.getDate(),2)}function setUpDualRangeSlider(var1,var2,min,max,defaultMin,defaultMax,step,sliderID,updateID,mode){if(null==mode&&(mode="date"),null==defaultMin&&(defaultMin=min),null==defaultMax&&(defaultMax=max),"date"===mode?(min=new Date(min),max=new Date(max),step=24*step*60*60,defaultMin=new Date(defaultMin),defaultMax=new Date(defaultMax),$("#"+updateID).html(formatDT(defaultMin)+" - "+formatDT(defaultMax))):"julian"===mode?(min=Date.fromDayofYear(min),max=Date.fromDayofYear(max),step=24*step*60*60,defaultMin=Date.fromDayofYear(defaultMin),defaultMax=Date.fromDayofYear(defaultMax),$("#"+updateID).html(formatDTJulian(defaultMin)+" - "+formatDTJulian(defaultMax))):$("#"+updateID).html(defaultMin.toString()+" - "+defaultMax.toString()),"date"===mode||"julian"===mode)var minVal=Date.parse(min)/1e3,maxVal=Date.parse(max)/1e3,minDefault=Date.parse(defaultMin)/1e3,maxDefault=Date.parse(defaultMax)/1e3;else var minVal=min,maxVal=max,minDefault=defaultMin,maxDefault=defaultMax;$("#"+sliderID).slider({range:!0,min:minVal,max:maxVal,step:step,values:[minDefault,maxDefault],slide:function(e,ui){if("date"===mode){var value1=1e3*ui.values[0],value2=1e3*ui.values[1],value1Show=formatDT(new Date(value1)),value2Show=formatDT(new Date(value2));$("#"+updateID).html(value1Show.toString()+" - "+value2Show.toString()),eval(var1+"= new Date("+value1.toString()+")"),eval(var2+"= new Date("+value2.toString()+")")}else if("julian"===mode){var value1=new Date(1e3*ui.values[0]),value2=new Date(1e3*ui.values[1]),value1Show=formatDTJulian(value1),value2Show=formatDTJulian(value2);value1=value1.dayofYear(),value2=value2.dayofYear(),$("#"+updateID).html(value1Show.toString()+" - "+value2Show.toString()),eval(var1+"= "+value1.toString()),eval(var2+"= "+value2.toString())}else{var value1=ui.values[0],value2=ui.values[1],value1Show=value1,value2Show=value2;$("#"+updateID).html(value1Show.toString()+" - "+value2Show.toString()),eval(var1+"= "+value1.toString()),eval(var2+"= "+value2.toString())}}})}function addDualRangeSlider(e,a,t,o,l,r,n,i,s,d,c,p){null==p&&(p=""),$("#"+e).append(`<div  id="${d}-container"class='dual-range-slider-container px-1' title="${p}">\n\t\t\t\t\t\t\t        <div class='dual-range-slider-name pt-2 pb-3'>${a}</div>\n\t\t\t\t\t\t\t        <div id="${d}" class='dual-range-slider-slider' href = '#'></div>\n\t\t\t\t\t\t\t        <div id='${d}-update' class='dual-range-slider-value p-2'></div>\n\t\t\t\t\t\t\t    </div>`),setUpDualRangeSlider(t,o,l,r,n,i,s,d,d+"-update",c)}function setUpRangeSlider(variable,min,max,defaultValue,step,sliderID,mode){eval(`window.${variable} = ${defaultValue};`),$("#"+sliderID+"-update").html(defaultValue),$("#"+sliderID).slider({min:min,max:max,step:step,value:defaultValue,slide:function(e,ui){eval(`window.${variable} = ${ui.value};`),$("#"+sliderID+"-update").empty(),$("#"+sliderID+"-update").html(ui.value)}})}function addRangeSlider(e,a,t,o,l,r,n,i,s,d){$("#"+e).append(`<div  class='dual-range-slider-container px-1' title="${d}">\n                                    <div class='dual-range-slider-name pt-2 pb-3'>${a}</div>\n                                    <div id="${i}" class='dual-range-slider-slider' href = '#'></div>\n                                    <div id='${i}-update' class='dual-range-slider-value p-2'></div>\n                                </div>`),setUpRangeSlider(t,o,l,r,n,i,s)}function addTab(e,a,t,o,l,r,n,i,s){var d;i||(i=""),d=s||"true"===s?"active show":"",$("#"+a).append(`<li class="nav-item"><a onclick = '${r}' class="nav-link text-left text-dark tab-nav-link ${d}" id="'+tabID+'" data-toggle="tab" href="#${l}" role="tab" aria-controls="${l}" aria-selected="false" title="${i}">${e}</a></li>`),$("#"+t).append($(`<div class="tab-pane fade ${d}" id="${l}" role="tabpanel" aria-labelledby="${o}" title="${i}"></div>`).append(n))}function addTabContainer(e,a,t){$("#"+e).append(`<ul class="pb-1 nav nav-tabs flex-column nav-justified md-tabs" id="${a}" role="tablist">  \n    </ul>\n    <div class = 'tab-content card' id = '${t}'>\n    </div>`)}function addCollapse(e,a,t,o,l,r,n,i){var s;null==i&&(i=""),!0===r||"true"===r||"show"===r?(r="show",s=""):(r="",s="collapsed");var d=`<header title="${i}" class="panel-heading px-3 py-2 " role="tab" id="${a}" onclick = '${n}'>\n\t<h2 class="p-0 m-0 panel-title  ${s}" data-toggle="collapse"  href="#${t}" id="${a}-label" aria-expanded="${r}" aria-controls="${t}"> <a class = 'collapse-title' role='img'>\n\t${l} ${o} </a></h2><span id="${a}-message"</span></header>`,c=`<section id="${t}" class="panel-collapse collapse panel-body ${r} px-5 py-0" role="tabpanel" aria-labelledby="${a}"></section>`;$("#"+e).append(`<div role="listitem" id="${a}-${t}"></div>`),$(`#${a}-${t}`).append(d),$(`#${a}-${t}`).append(c)}function addSubCollapse(e,a,t,o,l,r,n){var i;!0===r||"true"===r||"show"===r?(r="show",i=""):(r="",i="collapsed");var s=`<div >\n                                <div   class="panel-heading px-0 py-2 " role="tab" id="${a}" onclick = '${n}'>\n\t                           <h5 class="sub-panel-title ${i}" data-toggle="collapse"  href="#${t}" aria-expanded="false" aria-controls="${t}" > <a class = 'collapse-title' >${l} ${o} </a></h5>\n                                </div>\n                            </div`,d=`<div id="${t}" class="panel-collapse collapse panel-body ${r} px-1 py-0" role="tabpanel" aria-labelledby="${a}"></div>`;$("#"+e).append(s),$("#"+e).append(d)}function addAccordianContainer(e,a){$("#"+e).append(`<div class="accordion" id="${a}"></div>`)}Date.fromDayofYear=function(e,a){a||(a=(new Date).getFullYear());var t=new Date(a,0,1);return new Date(t.setMonth(0,e))},Date.prototype.dayofYear=function(){var e=new Date(this.getFullYear(),0,0);return Math.floor((this-e)/864e5)};var panelCollapseI=1;function addAccordianCard(e,a,t,o,l,r,n,i){var s;null==i&&(i=""),!0===r||"true"===r||"show"===r?(r="show",s=""):(r="",s="collapsed"),$("#"+e).append(`\n    <div>\n      <div class=" px-0 py-2 sub-panel-title ${s}" id="${a}" data-toggle="collapse" data-target="#${t}"\n        aria-expanded="false" aria-controls="${t}" onclick = '${n}'>\n      <a class = 'collapse-title' title="${i}"  >\n        ${o} </a>\n      </div>\n      <div id="${t}" class="panel-collapse-${panelCollapseI} super-panel-collapse panel-collapse collapse panel-body pl-3 py-0  ${r} bg-black" aria-labelledby="${a}"\n        data-parent="#${e}">\n        <div title="${i}">${l}</div>\n      </div>\n    </div>`),panelCollapseI++}function addSubAccordianCard(e,a,t,o,l,r,n,i){var s;null==i&&(i=""),!0===r||"true"===r||"show"===r?(r="show",s=""):(r="",s="collapsed"),$("#"+e).append(`\n    <div>\n      <div class=" px-0 py-2 sub-sub-panel-title ${s}" id="${a}" data-toggle="collapse" data-target="#${t}"\n        aria-expanded="false" aria-controls="${t}" onclick = '${n}'>\n      <a class = 'collapse-title' title="${i}"  >\n        ${o} </a>\n      </div>\n      <div id="${t}" class="panel-collapse-${panelCollapseI} toggle-collapse panel-collapse collapse panel-body pl-3 py-0  ${r} bg-black" aria-labelledby="${a}"\n        data-parent="#${e}">\n        <div title="${i}">${l}</div>\n      </div>\n    </div>`),panelCollapseI++}function getWalkThroughCollapseContainerID(){return $(window).width()<576?"sidebar-left":"legendDiv"}function moveCollapse(e){var a=getWalkThroughCollapseContainerID();$("#"+e+"-label").detach().appendTo("#"+a),$("#"+e+"-div").detach().appendTo("#"+a)}function addLegendCollapse(){addCollapse(getWalkThroughCollapseContainerID(),"legend-collapse-label","legend-collapse-div","LEGEND",'<i class="fa fa-location-arrow fa-rotate-45 mx-1" aria-hidden="true"></i>',!0,"","LEGEND of the layers displayed on the map"),$("#legend-collapse-div").append('<div role="list" id="legend-layer-list"></div>'),$("#legend-collapse-div").append('<div role="list" id="legend-reference-layer-list"></div>'),$("#legend-collapse-div").append('<div role="list" id="legend-fhp-div"></div>'),$("#legend-collapse-div").append('<div role="list" id="time-lapse-legend-list"></div>'),$("#legend-collapse-div").append('<div role="list" id="legend-area-charting-select-layer-list"></div>')}function addLegendContainer(e,a,t,o){null==a&&(a="legend-collapse-div"),null==t&&(t=!0),t=t?"block":"none",$("#"+a).prepend(`<div class = 'py-2 row' title= '${o}' style = 'display:${t};' id = '${e}'>\n\t\t\t\t\t\t\t\t</div>`)}function addClassLegendContainer(e,a,t){$("#"+a).append(`<div class='my-legend'>\n\t\t\t\t\t\t\t\t\t\t<div class = 'legend-title'>${t}</div>\n\t\t\t\t\t\t\t\t\t\t<div class='legend-scale'>\n\t\t\t\t\t\t\t\t\t  \t\t<ul class='legend-labels' id = '${e}'></ul>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>`)}function addClassLegendEntry(e,a){$("#"+e).append(`<li><span style='border: ${a.classStrokeWeight}px solid #${a.classStrokeColor};background:#${a.classColor};'></span>${a.className}</li>`)}function addColorRampLegendEntry(e,a){$("#"+e).append(`<li class = 'legend-colorRamp' title= '${a.helpBoxMessage}'>\n\t\t\t\t\t\t\t            <div class = 'legend-title'>${a.name}</div>\n\t\t\t\t\t\t\t            <div class = 'colorRamp'style='${a.colorRamp};'></div>\n\t\t\t\t\t\t\t            <div>\n\t\t\t\t\t\t\t                <span class = 'leftLabel'>${a.min}</span>\n\t\t\t\t\t\t\t                <span class = 'rightLabel'>${a.max}</span>\n\t\t\t\t\t\t\t            </div>\n\t\t\t\t\t\t\t            \n\t\t\t\t\t\t\t        </li> `)}function regulateReRunButton(){outstandingGEERequests>0?($("#reRun-button").prop("disabled",!0),$("#reRun-button").prop("title",staticTemplates.reRunButtonDisabledTooltip)):($("#reRun-button").prop("disabled",!1),$("#reRun-button").prop("title",staticTemplates.reRunButtonEnabledTooltip))}function updateOutstandingGEERequests(){$("#outstanding-gee-requests").html(outstandingGEERequests),regulateReRunButton()}function updateGEETileLayersLoading(){$("#number-gee-tiles-downloading").html(geeTileLayersDownloading)}function incrementOutstandingGEERequests(){outstandingGEERequests++,updateOutstandingGEERequests()}function decrementOutstandingGEERequests(){outstandingGEERequests--,updateOutstandingGEERequests()}function incrementGEETileLayersLoading(){geeTileLayersDownloading++,updateGEETileLayersLoading()}function decrementGEETileLayersLoading(){geeTileLayersDownloading--,updateGEETileLayersLoading()}function updateGEETileLayersDownloading(){geeTileLayersDownloading=Object.values(layerObj).filter((function(e){return e.loading})).length,updateGEETileLayersLoading()}function addLayer(e){e.loadError=!1;var a=e.legendDivID;e.id=a;var t=a+"-"+e.ID,o=a+"-container-"+e.ID,l=a+"-opacity-"+e.ID,r=a+"-visible-"+e.ID,n=a+"-span-"+e.ID,i=r+"-label-"+e.ID,s=a+"-spinner-"+e.ID,d=(e.ID,"");function c(){$("#"+l).css("background-color","rgba(55, 46, 44,"+e.rangeOpacity+")")}function p(){var a=e.percent;100!==a||"geeImage"!==e.layerType&&"geeVectorImage"!==e.layerType&&"geeImageCollection"!==e.layerType||jitterZoom(),$("#"+o).css("background",`-webkit-linear-gradient(left, #FFF, #FFF ${a}%, transparent ${a}%, transparent 100%)`)}function u(){"geeVector"===e.layerType?centerObject(e.item):"geoJSONVector"===e.layerType||(void 0!==e.item.args&&null!==e.item.args.value&&void 0!==e.item.args.value?synchronousCenterObject(e.item.args.value):void 0!==e.item.args&&void 0!==e.item.args.featureCollection&&void 0!==e.item.args.featureCollection.args&&void 0!==e.item.args.featureCollection.args.value&&void 0!==e.item.args.featureCollection.args.value&&synchronousCenterObject(e.item.args.featureCollection.args.value))}function m(a){e.loadError=!0,console.log("GEE Tile Service request failed for "+e.name),console.log(o),$("#"+o).css("background","red"),$("#"+o).attr("title",'Layer failed to load. Error message: "'+a+'"')}function g(){c(),layerObj[a].visible=e.visible,layerObj[a].opacity=e.opacity}function h(){e.loadError||(e.visible?(ga("send","event","layer-off",e.layerType,e.name),"dynamicMapService"===e.layerType?(e.layer.setMap(null),e.visible=!1,e.percent=0,e.rangeOpacity=0,c(),p(),$("#"+e.legendDivID).hide()):"geeVector"!==e.layerType&&"geoJSONVector"!==e.layerType?(e.visible=!1,e.map.overlayMapTypes.setAt(e.layerId,null),e.percent=0,p(),$("#"+e.legendDivID).hide(),e.rangeOpacity=0,"tileMapService"!==e.layerType&&"dynamicMapService"!==e.layerType&&e.canQuery&&(queryObj[t].visible=e.visible)):(e.visible=!1,e.percent=0,p(),$("#"+e.legendDivID).hide(),e.layer.setMap(null),e.rangeOpacity=0,$("#"+s+"2").hide(),"geeVector"===e.layerType&&e.canQuery&&(queryObj[t].visible=e.visible)),e.loading=!1,updateGEETileLayersDownloading(),$("#"+s+"2").hide(),$("#"+s+"3").hide(),g()):(ga("send","event","layer-on",e.layerType,e.name),e.viz.isTimeLapse||turnOffTimeLapseCheckboxes(),"dynamicMapService"===e.layerType?(e.layer.setMap(map),e.visible=!0,e.percent=100,e.rangeOpacity=e.opacity,c(),p(),$("#"+e.legendDivID).show()):"geeVector"!==e.layerType&&"geoJSONVector"!==e.layerType?(e.visible=!0,e.map.overlayMapTypes.setAt(e.layerId,e.layer),$("#"+e.legendDivID).show(),e.rangeOpacity=e.opacity,e.isTileMapService&&(e.percent=100,p()),e.layer.setOpacity(e.opacity),"tileMapService"!==e.layerType&&"dynamicMapService"!==e.layerType&&e.canQuery&&(queryObj[t].visible=e.visible)):(e.visible=!0,e.percent=100,p(),$("#"+e.legendDivID).show(),e.layer.setMap(e.map),e.rangeOpacity=e.opacity,"geeVector"===e.layerType&&e.canQuery&&(queryObj[t].visible=e.visible)),g()))}function y(){e.visible&&$("#"+r).click()}function f(){e.visible||$("#"+r).click()}layerObj[a]=e,e.wasJittered=!1,e.loading=!1,e.refreshNumber=refreshNumber,e.visible&&(d="checked"),e.viz.isTimeLapse&&(timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.push(a),timeLapseObj[e.viz.timeLapseID].sliders.push(l),timeLapseObj[e.viz.timeLapseID].layerVisibleIDs.push(r)),$("#"+e.whichLayerList).prepend(`<li id = '${o}' aria-label="Map layer controls container for ${e.name}" class = 'layer-container'  title= '${e.helpBoxMessage}'>\n\t\t\t\t\t\t\t\t           <div id="${l}" aria-labelledby="${o}" Opacity range slider for ${e.name}" class = 'simple-layer-opacity-range'></div>\n\t\t\t\t\t\t\t\t           <input  role="option" id="${r}" aria-label="Layer visibility toggle checkbox for ${e.name}" type="checkbox" ${d}  />\n\t\t\t\t\t\t\t\t            <label class = 'layer-checkbox' id="${i}" aria-label="Layer visibility toggle checkbox for ${e.name}" style = 'margin-bottom:0px;display:none;'  for="${r}"></label>\n\t\t\t\t\t\t\t\t            <i id = "${s}" class="fa fa-spinner fa-spin layer-spinner" title='Waiting for layer service from Google Earth Engine'></i>\n\t\t\t\t\t\t\t\t            <i id = "${s}2" style = 'display:none;' class="fa fa-cog fa-spin layer-spinner" title='Waiting for map tiles from Google Earth Engine'></i>\n\t\t\t\t\t\t\t\t            <i id = "${s}3" style = 'display:none;' class="fa fa-cog fa-spin layer-spinner" title='Waiting for map tiles from Google Earth Engine'></i>\n                                            \n\t\t\t\t\t\t\t\t            <span id = '${n}' aria-labelledby="${o}" class = 'layer-span'>${e.name}</span>\n\t\t\t\t\t\t\t\t       </li>`),$("#"+l).slider({min:0,max:100,step:1,value:100*e.opacity,slide:function(t,o){if(e.opacity=o.value/100,"geeVector"!==e.layerType&&"geoJSONVector"!==e.layerType)e.layer.setOpacity(e.opacity);else{var l=e.layer.getStyle();l.strokeOpacity=e.opacity,l.fillOpacity=e.opacity/e.viz.opacityRatio,e.layer.setStyle(l),e.visible&&e.range}e.visible&&(e.rangeOpacity=e.opacity),layerObj[a].visible=e.visible,layerObj[a].opacity=e.opacity,c()}}),$("#"+l).val(100*e.opacity);var v=!1;if($("#"+n).click((function(){setTimeout((function(){v||$("#"+r).click()}),200)})),$("#"+s+"2").click((function(){$("#"+r).click()})),$("#"+n).dblclick((function(){u(),v=!0,u(),e.visible||$("#"+r).click(),setTimeout((function(){v=!1}),200)})),$("#"+r).change((function(){h()})),layerObj[a].visible=e.visible,layerObj[a].opacity=e.opacity,e.viz.isTimeLapse||$(".layer-checkbox").on("turnOffAll",(function(){y()})),"geeVector"!==e.layerType&&"geeVectorImage"!==e.layerType&&"geoJSONVector"!==e.layerType||($("#"+i).addClass("vector-layer-checkbox"),$(".vector-layer-checkbox").on("turnOffAll",(function(){y()})),$(".vector-layer-checkbox").on("turnOnAll",(function(){f()})),$(".vector-layer-checkbox").on("turnOffAllVectors",(function(){y()})),$(".vector-layer-checkbox").on("turnOnAllVectors",(function(){f()})),e.viz.isUploadedLayer&&($("#"+i).addClass("uploaded-layer-checkbox"),selectionTracker.uploadedLayerIndices.push(e.layerId),$(".vector-layer-checkbox").on("turnOffAllUploadedLayers",(function(){y()})),$(".vector-layer-checkbox").on("turnOnAllUploadedLayers",(function(){f()})))),"geeImage"===e.layerType||"geeVectorImage"===e.layerType||"geeImageCollection"===e.layerType){if("geeImageCollection"===e.layerType){e.imageCollection=e.item,null!==e.viz.reducer&&void 0!==e.viz.reducer||(e.viz.reducer=ee.Reducer.lastNonNull());var b=ee.Image(e.item.first()).bandNames();e.item=ee.ImageCollection(e.item).reduce(e.viz.reducer).rename(b).copyProperties(e.imageCollection.first())}else if("geeVectorImage"===e.layerType||"geeVector"===e.layerType){var w;if(e.viz.isSelectLayer&&(selectedFeaturesJSON[e.name]={layerName:e.name,filterList:[],geoJSON:new google.maps.Data,id:e.id,rawGeoJSON:{},selection:ee.FeatureCollection([])},$("#"+i).addClass("select-layer-checkbox"),$(".vector-layer-checkbox").on("turnOffAllSelectLayers",(function(){y()})),$(".vector-layer-checkbox").on("turnOnAllSelectLayers",(function(){f()})),$(".vector-layer-checkbox").on("turnOffAll",(function(){y()})),$(".vector-layer-checkbox").on("turnOnAll",(function(){f()}))),e.queryItem=e.item,"geeVectorImage"===e.layerType&&(e.item=ee.Image().paint(e.item,null,e.viz.strokeWeight),e.viz.palette=e.viz.strokeColor),e.viz.isSelectLayer)e.queryItem.first().propertyNames().evaluate((function(a,t){void 0!==t?showMessage("Error",t):(a.map((function(e){-1!==e.toLowerCase().indexOf("name")&&(w=e)})),void 0===w&&(w="system:index")),selectedFeaturesJSON[e.name].fieldName=w,selectedFeaturesJSON[e.name].eeObject=e.queryItem.select([w],["name"])}));e.viz.isSelectedLayer&&($("#"+i).addClass("selected-layer-checkbox"),$(".vector-layer-checkbox").on("turnOffAllSelectLayers",(function(){y()})),$(".vector-layer-checkbox").on("turnOnAllSelectLayers",(function(){f()})),$(".vector-layer-checkbox").on("turnOffAllSelectedLayers",(function(){y()})),$(".vector-layer-checkbox").on("turnOnAllSelectedLayers",(function(){f()})),selectionTracker.seletedFeatureLayerIndices.push(e.layerId))}function S(){var a=Object.values(layerObj).filter((function(a){return a.loading&&a.viz.isTimeLapse&&a.whichLayerList===e.whichLayerList})).length,t=(Object.values(layerObj).filter((function(a){return!a.loading&&a.viz.isTimeLapse&&a.whichLayerList===e.whichLayerList})).length,100*(1-a/timeLapseObj[e.viz.timeLapseID].nFrames));$("#"+e.viz.timeLapseID+"-collapse-label").css("background",`-webkit-linear-gradient(0deg, #FFF, #FFF ${t}%, transparent ${t}%, transparent 100%)`),t<100?$("#"+e.viz.timeLapseID+"-loading-gear").show():$("#"+e.viz.timeLapseID+"-loading-gear").hide()}e.canQuery&&(queryObj[t]={visible:e.visible,queryItem:e.queryItem,queryDict:e.viz.queryDict,type:e.layerType,name:e.name,queryDateFormat:e.viz.queryDateFormat}),incrementOutstandingGEERequests(),e.mapServiceTryNumber=0,function o(){var l=Object.keys(e.viz),r=!1;["bands","min","max","gain","bias","gamma","palette"].map((function(e){l.indexOf(e)>-1&&(r=!0)})),e.usedViz=0==r?{}:e.viz,ee.Image(e.item).getMap(e.usedViz,(function(l,r){void 0===l&&e.mapServiceTryNumber<=1?(queryObj[t].queryItem=e.item,e.item=e.item.visualize(),o()):function(t,o){if(decrementOutstandingGEERequests(),$("#"+s).hide(),e.viz.isTimeLapse){timeLapseObj[e.viz.timeLapseID].loadingLayerIDs=timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.filter((e=>e!==a));var l=parseInt(100*(1-timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.length/timeLapseObj[e.viz.timeLapseID].nFrames));$("#"+e.viz.timeLapseID+"-collapse-label").css("background",`-webkit-linear-gradient(left, #FFF, #FFF ${l}%, transparent ${l}%, transparent 100%)`),0===timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.length&&($("#"+e.viz.timeLapseID+"-loading-spinner").hide(),$("#"+e.viz.timeLapseID+"-year-label").hide(),$("#"+e.viz.timeLapseID+"-collapse-label").css("background","-webkit-linear-gradient(left, #FFF, #FFF 0%, transparent 0%, transparent 100%)"),$("#"+e.viz.timeLapseID+"-toggle-checkbox-label").show(),timeLapseObj[e.viz.timeLapseID].isReady=!0)}if($("#"+i).show(),e.currentGEERunID===geeRunID)if(void 0===t||void 0!==o)m(o);else{const a=t.urlFormat;e.layer=new google.maps.ImageMapType({getTileUrl:function(t,o){let l=a.replace("{x}",t.x).replace("{y}",t.y).replace("{z}",o);return e.loading||(e.loading=!0,e.percent=10,$("#"+s+"2").show(),updateGEETileLayersDownloading(),p(),e.viz.isTimeLapse&&S()),l}}),e.layer.addListener("tilesloaded",(function(){e.percent=100,e.loading=!1,$("#"+s+"2").hide(),updateGEETileLayersDownloading(),p(),e.viz.isTimeLapse&&S()})),e.visible?(e.map.overlayMapTypes.setAt(e.layerId,e.layer),e.rangeOpacity=e.opacity,e.layer.setOpacity(e.opacity),$("#"+e.legendDivID).show()):e.rangeOpacity=0,$("#"+s).hide(),$("#"+i).show(),c()}}(l,r)})),e.mapServiceTryNumber++}()}else if("geeVector"===e.layerType||"geoJSONVector"===e.layerType){function C(a){$("#"+s).hide(),$("#"+i).show(),e.currentGEERunID===geeRunID&&(void 0===a&&m(),e.layer=new google.maps.Data,e.layer.setStyle(e.viz),e.layer.addGeoJson(a),e.viz.clickQuery&&(map.addListener("click",(function(){infowindow.setMap(null)})),e.layer.addListener("click",(function(e){console.log(e),infowindow.setPosition(e.latLng);var a='<table class="table table-hover bg-white">\n                            <tbody>',t=e.feature.h;Object.keys(t).map((function(e){var o=t[e];a+=`<tr><th>${e}</th><td>${o}</td></tr>`})),a+="</tbody></table>",infowindow.setContent(a),infowindow.open(map)}))),featureObj[e.name]=e.layer,e.visible?(e.layer.setMap(e.map),e.rangeOpacity=e.viz.strokeOpacity,e.percent=100,p(),$("#"+e.legendDivID).show()):(e.rangeOpacity=0,e.percent=0,$("#"+e.legendDivID).hide()),c())}e.canQuery&&(queryObj[t]={visible:e.visible,queryItem:e.queryItem,queryDict:e.viz.queryDict,type:e.layerType,name:e.name}),incrementOutstandingGEERequests(),"geeVector"===e.layerType?(decrementOutstandingGEERequests(),e.item.evaluate((function(e){C(e)}))):(decrementOutstandingGEERequests(),C(e.item))}else if("tileMapService"===e.layerType)e.layer=new google.maps.ImageMapType({getTileUrl:e.item,tileSize:new google.maps.Size(256,256),maxZoom:15}),e.visible?(e.map.overlayMapTypes.setAt(e.layerId,e.layer),e.rangeOpacity=e.opacity,e.layer.setOpacity(e.opacity)):e.rangeOpacity=0,$("#"+s).hide(),$("#"+i).show(),c();else if("dynamicMapService"===e.layerType){function D(){null!==e.layer&&void 0!==e.layer&&e.layer.setMap(null),e.layer=map.getZoom()>e.item[1].minZoom?getGroundOverlay(e.item[1].baseURL,e.item[1].minZoom,e.item[1].ending):getGroundOverlay(e.item[0].baseURL,e.item[0].minZoom,e.item[0].ending),e.visible?(e.layer.setMap(map),e.percent=100,p(),groundOverlayOn=!0,$("#"+e.legendDivID).show(),e.layer.setOpacity(e.opacity),e.rangeOpacity=e.opacity):e.rangeOpacity=0,c()}D(),google.maps.event.addListener(map,"zoom_changed",(function(){D()})),google.maps.event.addListener(map,"dragend",(function(){D()})),$("#"+s).hide(),$("#"+i).show(),c()}}function toggleAdvancedOn(){$("#threshold-container").slideDown(),$("#advanced-radio-container").slideDown()}function toggleAdvancedOff(){$("#threshold-container").slideUp(),$("#advanced-radio-container").slideUp()}if($("body").append(staticTemplates.map),$("body").append(staticTemplates.mainContainer),$("body").append(staticTemplates.sidebarLeftContainer),$("body").append(staticTemplates.geeSpinner),$("body").append(staticTemplates.bottomBar),$("#main-container").append(staticTemplates.sidebarLeftToggler),$("#sidebar-left-header").append(staticTemplates.topBanner),null==localStorage["showIntroModal-"+mode]&&(localStorage["showIntroModal-"+mode]="true"),"LCMS-pilot"===mode&&($("#title-banner").append(staticTemplates.studyAreaDropdown),studyAreaSpecificPage?$("#study-area-label").removeClass("dropdown-toggle"):Object.keys(studyAreaDict).map((function(e){addStudyAreaToDropdown(e,studyAreaDict[e].popOver)}))),$("#sidebar-left-header").append(staticTemplates.placesSearchDiv),"LCMS-pilot"===mode||"LCMS"===mode){var minYear=startYear,maxYear=endYear;null!=urlParams.startYear&&null!=urlParams.startYear||(urlParams.startYear=startYear),null!=urlParams.endYear&&null!=urlParams.endYear||(urlParams.endYear=endYear),null!=urlParams.addLCMSTimeLapsesOn&&null!=urlParams.addLCMSTimeLapsesOn||(urlParams.addLCMSTimeLapsesOn="no"),addCollapse("sidebar-left","parameters-collapse-label","parameters-collapse-div","PARAMETERS",'<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>',!1,null,"Adjust parameters used to filter and sort LCMS products"),addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div","LCMS DATA","<img style = 'width:1.2em;height:1.1em;margin-top:-0.2em;margin-left:-0.1em' class='image-icon mr-1' alt=\"LCMS icon\" src=\"images/lcms-icon.png\">",!0,null,"LCMS DATA layers to view on map"),addCollapse("sidebar-left","reference-layer-list-collapse-label","reference-layer-list-collapse-div","REFERENCE DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!1,null,"Additional relevant layers to view on map intended to provide context for LCMS DATA"),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map"),addCollapse("sidebar-left","download-collapse-label","download-collapse-div","DOWNLOAD DATA",'<i role="img" class="fa fa-cloud-download mr-1" aria-hidden="true"></i>',!1,"","Download LCMS products for further analysis"),addCollapse("sidebar-left","support-collapse-label","support-collapse-div","SUPPORT",'<i role="img" class="fa fa-question-circle mr-1" aria-hidden="true"></i>',!1,"","If you need any help"),-1===["standard","advanced"].indexOf(urlParams.analysisMode)&&(urlParams.analysisMode="standard"),-1===["year","prob"].indexOf(urlParams.summaryMethod)&&(urlParams.summaryMethod="year");var tAnalysisMode=urlParams.analysisMode,tAddLCMSTimeLapsesOn=urlParams.addLCMSTimeLapsesOn;"LCMS"===mode&&(addRadio("parameters-collapse-div","addTimeLapses-radio","Add LCMS Time Lapses:","No","Yes","urlParams.addLCMSTimeLapsesOn","no","yes","","","Add interactive time lapse of LCMS Change, Land Cover, and Land Use products. This will slow down the map loading"),$("#parameters-collapse-div").append('<div class="dropdown-divider" ></div>'),"yes"===tAddLCMSTimeLapsesOn&&$("#addTimeLapses-radio-second_toggle_label").click()),addRadio("parameters-collapse-div","analysis-mode-radio","Choose which mode:","Standard","Advanced","urlParams.analysisMode","standard","advanced","toggleAdvancedOff()","toggleAdvancedOn()","Standard mode provides the core LCMS products based on carefully selected parameters. Advanced mode provides additional LCMS products and parameter options"),urlParams.analysisMode=tAnalysisMode,$("#parameters-collapse-div").append('<div class="dropdown-divider" ></div>'),addDualRangeSlider("parameters-collapse-div","Choose analysis year range:","urlParams.startYear","urlParams.endYear",minYear,maxYear,urlParams.startYear,urlParams.endYear,1,"analysis-year-slider","null","Years of LCMS data to include for land cover, land use, loss, and gain"),$("#parameters-collapse-div").append('<div class="dropdown-divider"></div>\n                                          <div id=\'threshold-container\' style="display:none;width:100%"></div>\n                                          <div id=\'advanced-radio-container\' style="display: none;"></div>'),"LCMS-pilot"===mode&&(addRangeSlider("threshold-container","Choose loss threshold:","lowerThresholdDecline",0,1,lowerThresholdDecline,.05,"decline-threshold-slider","null","Threshold window for detecting loss.  Any loss probability greater than or equal to this value will be flagged as loss "),$("#threshold-container").append('<div class="dropdown-divider" ></div>'),addRangeSlider("threshold-container","Choose gain threshold:","lowerThresholdRecovery",0,1,lowerThresholdRecovery,.05,"recovery-threshold-slider","null","Threshold window for detecting gain.  Any gain probability greater than or equal to this value will be flagged as gain "),$("#advanced-radio-container").append('<div class="dropdown-divider" ></div>'),$("#advanced-radio-container").append("<div id = 'fast-slow-threshold-container' ></div>"),addRangeSlider("fast-slow-threshold-container","Choose slow loss threshold:","lowerThresholdSlowLoss",0,1,lowerThresholdSlowLoss,.05,"slow-loss-threshold-slider","null","Threshold window for detecting loss.  Any loss probability greater than or equal to this value will be flagged as loss "),$("#fast-slow-threshold-container").append('<div class="dropdown-divider" ></div>'),addRangeSlider("fast-slow-threshold-container","Choose fast loss threshold:","lowerThresholdFastLoss",0,1,lowerThresholdFastLoss,.05,"fast-loss-threshold-slider","null","Threshold window for detecting loss.  Any loss probability greater than or equal to this value will be flagged as loss "),$("#advanced-radio-container").append('<div class="dropdown-divider" ></div>'),addRadio("advanced-radio-container","treemask-radio","Constrain analysis to areas with trees:","Yes","No","applyTreeMask","yes","no","","","Whether to constrain LCMS products to only treed areas. Any area LCMS classified as tree cover 2 or more years will be considered tree. Will reduce commission errors typical in agricultural and water areas, but may also reduce changes of interest in these areas."),$("#advanced-radio-container").append('<div class="dropdown-divider" ></div>'));var tSummaryMethod=urlParams.summaryMethod;if(addRadio("advanced-radio-container","summaryMethod-radio","Summary method:","Most recent year","Highest prob","urlParams.summaryMethod","year","prob","","","How to choose which value for disturbance and growth to display.  Choose the value with the highest model confidence or from the most recent year above the threshold."),urlParams.summaryMethod=tSummaryMethod,$("#advanced-radio-container").append('<div class="dropdown-divider" ></div>'),$("#parameters-collapse-div").append(staticTemplates.reRunButton),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),$("#reference-layer-list-collapse-div").append('<ul id="reference-layer-list" class = "layer-list"></ul>'),"LCMS"===mode){function populateLCMSDownloads(){var e,a=document.getElementsByClassName("caret");for(e=0;e<a.length;e++)a[e].addEventListener("click",(function(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}))}$("#download-collapse-div").append(staticTemplates.lcmsProductionDownloadDiv)}else $("#download-collapse-div").append(staticTemplates.downloadDiv);$("#support-collapse-div").append(staticTemplates.supportDiv),"advanced"===tAnalysisMode&&$("#analysis-mode-radio-second_toggle_label").click(),"prob"===tSummaryMethod&&$("#summaryMethod-radio-second_toggle_label").click()}else if("lcms-base-learner"===mode){canExport=!1,startYear=1984,endYear=2021;var minYear=startYear,maxYear=endYear;null!=urlParams.startYear&&null!=urlParams.startYear||(urlParams.startYear=startYear),null!=urlParams.endYear&&null!=urlParams.endYear||(urlParams.endYear=endYear),null!=urlParams.lossMagThresh&&null!=urlParams.lossMagThresh||(urlParams.lossMagThresh=-.15),null!=urlParams.gainMagThresh&&null!=urlParams.gainMagThresh||(urlParams.gainMagThresh=.1),null!=urlParams.whichIndices2&&null!=urlParams.whichIndices2||(urlParams.whichIndices2={nir:!1,swir1:!1,swir2:!1,NBR:!0,NDVI:!1}),addCollapse("sidebar-left","parameters-collapse-label","parameters-collapse-div","PARAMETERS",'<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>',!1,null,"Adjust parameters used to filter and sort LCMS products"),addDualRangeSlider("parameters-collapse-div","Choose analysis year range:","urlParams.startYear","urlParams.endYear",minYear,maxYear,urlParams.startYear,urlParams.endYear,1,"analysis-year-slider","null","Years of LCMS data to include for land cover, land use, loss, and gain"),addCheckboxes("parameters-collapse-div","index-choice-checkboxes","Choose which indices to analyze","whichIndices2",urlParams.whichIndices2),addSubCollapse("parameters-collapse-div","lt-params-label","lt-params-div","LANDTRENDR Params","",!1,""),addRangeSlider("lt-params-div","Loss Magnitude Threshold","urlParams.lossMagThresh",-.8,-.05,urlParams.lossMagThresh,.05,"loss-mag-thresh-slider","","The threshold to detect loss for each LANDTRENDR segment.  Any difference for a given segement less than this threshold will be flagged as loss"),addRangeSlider("lt-params-div","Gain Magnitude Threshold","urlParams.gainMagThresh",.05,.8,urlParams.gainMagThresh,.05,"gain-mag-thresh-slider","","The threshold to detect gain for each LANDTRENDR segment.  Any difference for a given segement greater than this threshold will be flagged as gain"),$("#parameters-collapse-div").append('<div class="dropdown-divider" ></div>'),$("#parameters-collapse-div").append(staticTemplates.reRunButton),addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div","LCMS BASE LEARNER DATA","<img style = 'width:1.2em;height:1.1em;margin-top:-0.2em;margin-left:-0.1em' class='image-icon mr-1' alt=\"LCMS icon\" src=\"images/lcms-icon.png\">",!0,null,"LCMS DATA layers to view on map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map"),canExport&&addCollapse("sidebar-left","download-collapse-label","download-collapse-div","DOWNLOAD DATA",'<i role="img" class="fa fa-cloud-download mr-1" aria-hidden="true"></i>',!1,"","Download "+mode+" products for further analysis")}else if("LT"===mode){canExport=!0,startYear=1984,endYear=(new Date).getYear()+1900,startJulian=152,endJulian=273,initialZoomLevel=9,initialCenter=[37.64109979850402,-107.6917775643849];var minYear=startYear,maxYear=endYear;null!=urlParams.startYear&&null!=urlParams.startYear||(urlParams.startYear=startYear),null!=urlParams.endYear&&null!=urlParams.endYear||(urlParams.endYear=endYear),null!=urlParams.startJulian&&null!=urlParams.startJulian||(urlParams.startJulian=startJulian),null!=urlParams.endJulian&&null!=urlParams.endJulian||(urlParams.endJulian=endJulian),addCollapse("sidebar-left","parameters-collapse-label","parameters-collapse-div","PARAMETERS",'<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>',!1,null,"Adjust parameters used to filter and sort "+mode+" products"),addSubCollapse("parameters-collapse-div","comp-params-label","comp-params-div","Landsat Composite Params","",!1,""),$("#comp-params-div").append('<div class="dropdown-divider" ></div>'),addDualRangeSlider("comp-params-div","Choose analysis year range:","urlParams.startYear","urlParams.endYear",minYear,maxYear,urlParams.startYear,urlParams.endYear,1,"analysis-year-slider2","null","Years of "+mode+" data to include."),addDualRangeSlider("comp-params-div","Choose analysis date range:","urlParams.startJulian","urlParams.endJulian",1,365,urlParams.startJulian,urlParams.endJulian,1,"julian-day-slider","julian","Days of year of "+mode+" data to include for land cover, land use, loss, and gain"),$("#comp-params-div").append('<div class="dropdown-divider" ></div>'),null!==urlParams.whichPlatforms&&void 0!==urlParams.whichPlatforms||(urlParams.whichPlatforms={L5:!0,"L7-SLC-On":!0,"L7-SLC-Off":!1,L8:!0}),addCheckboxes("comp-params-div","which-sensor-method-radio","Choose which Landsat platforms to include","whichPlatforms",urlParams.whichPlatforms),$("#comp-params-div").append('<div class="dropdown-divider" ></div>'),null!==urlParams.yearBuffer&&void 0!==urlParams.yearBuffer||(urlParams.yearBuffer=0),addRangeSlider("comp-params-div","Composite Year Buffer","urlParams.yearBuffer",0,2,urlParams.yearBuffer,1,"year-buffer-slider","","The number of adjacent years to include in a given year composite. (E.g. a value of 1 would mean the 2015 composite would have imagery from 2015 +- 1 year - 2014 to 2016)"),$("#comp-params-div").append('<div class="dropdown-divider" ></div>'),null!==urlParams.minObs&&void 0!==urlParams.minObs||(urlParams.minObs=3),addRangeSlider("comp-params-div","Minimum Number of Observations","urlParams.minObs",1,5,urlParams.minObs,1,"min-obs-slider","","Minimum number of observations needed for a pixel to be included. This helps reduce noise in composites. Any number less than 3 can result in poor composite quality"),$("#comp-params-div").append('<div class="dropdown-divider" ></div>');var compMethodDict={Median:!1,Medoid:!0};null!==urlParams.compMethod&&void 0!==urlParams.compMethod&&(Object.keys(compMethodDict).map((e=>compMethodDict[e]=!1)),compMethodDict[urlParams.compMethod]=!0),addMultiRadio("comp-params-div","comp-method-radio","Compositing method","urlParams.compMethod",compMethodDict),$("#comp-params-div").append('<div class="dropdown-divider" ></div>'),null!==urlParams.whichCloudMasks&&void 0!==urlParams.whichCloudMasks||(urlParams.whichCloudMasks={"fMask-Snow":!0,cloudScore:!1,"fMask-Cloud":!0,TDOM:!1,"fMask-Cloud-Shadow":!0}),addCheckboxes("comp-params-div","cloud-masking-checkboxes","Choose which cloud masking methods to use","whichCloudMasks",urlParams.whichCloudMasks),$("#comp-params-div").append('<div class="dropdown-divider" ></div>');var maskWaterDict={No:!1,Yes:!0};null!==urlParams.maskWater&&void 0!==urlParams.maskWater&&(Object.keys(maskWaterDict).map((e=>maskWaterDict[e]=!1)),maskWaterDict[urlParams.maskWater]=!0),addMultiRadio("comp-params-div","water-mask-radio","Mask out water","urlParams.maskWater",maskWaterDict),addSubCollapse("parameters-collapse-div","lt-params-label","lt-params-div","LANDTRENDR Params","",!1,""),null!==urlParams.whichIndices&&void 0!==urlParams.whichIndices||(urlParams.whichIndices={NBR:!0,NDVI:!1,NDMI:!1,NDSI:!1,brightness:!1,greenness:!1,wetness:!1,tcAngleBG:!1}),addCheckboxes("lt-params-div","index-choice-checkboxes","Choose which indices to analyze","whichIndices",urlParams.whichIndices),$("#lt-params-div").append('<div class="dropdown-divider" ></div>');var LTSortByDict={largest:!0,steepest:!1,newest:!1,oldest:!1,shortest:!1,longest:!1};null!==urlParams.LTSortBy&&void 0!==urlParams.LTSortBy&&(Object.keys(LTSortByDict).map((e=>LTSortByDict[e]=!1)),LTSortByDict[urlParams.LTSortBy]=!0),addMultiRadio("lt-params-div","lt-sort-radio","Choose method to summarize LANDTRENDR change","urlParams.LTSortBy",LTSortByDict),null!==urlParams.lossMagThresh&&void 0!==urlParams.lossMagThresh||(urlParams.lossMagThresh=-.15),addRangeSlider("lt-params-div","Loss Magnitude Threshold","urlParams.lossMagThresh",-.8,0,urlParams.lossMagThresh,.01,"loss-mag-thresh-slider","","The threshold to detect loss for each LANDTRENDR segment.  Any difference between start and end values for a given segement less than this threshold will be flagged as loss"),null!==urlParams.lossSlopeThresh&&void 0!==urlParams.lossSlopeThresh||(urlParams.lossSlopeThresh=-.1),addRangeSlider("lt-params-div","Loss Slope Threshold","urlParams.lossSlopeThresh",-.8,0,urlParams.lossSlopeThresh,.01,"loss-slope-thresh-slider","","The threshold to detect loss for each LANDTRENDR segment.  Any slope of a given segement less than this threshold will be flagged as loss"),null!==urlParams.gainMagThresh&&void 0!==urlParams.gainMagThresh||(urlParams.gainMagThresh=.1),addRangeSlider("lt-params-div","Gain Magnitude Threshold","urlParams.gainMagThresh",.01,.8,urlParams.gainMagThresh,.01,"gain-mag-thresh-slider","","The threshold to detect gain for each LANDTRENDR segment.  Any difference between start and end values for a given segement greater than this threshold will be flagged as gain"),null!==urlParams.gainSlopeThresh&&void 0!==urlParams.gainSlopeThresh||(urlParams.gainSlopeThresh=.1),addRangeSlider("lt-params-div","Gain Slope Threshold","urlParams.gainSlopeThresh",.01,.8,urlParams.gainSlopeThresh,.01,"gain-slope-thresh-slider","","The threshold to detect gain for each LANDTRENDR segment.  Any slope of a given segement greater than this threshold will be flagged as gain"),null!==urlParams.howManyToPull&&void 0!==urlParams.howManyToPull||(urlParams.howManyToPull=1),addRangeSlider("lt-params-div","How Many","urlParams.howManyToPull",1,3,urlParams.howManyToPull,1,"how-many-slider","","The number of gains and losses to show. Typically an area only experiences a single loss/gain event, but in the cases where there are multiple above the specified thresholds, they can be shown."),null!==urlParams.maxSegments&&void 0!==urlParams.maxSegments||(urlParams.maxSegments=6),addRangeSlider("lt-params-div","Max LANDTRENDR Segments","urlParams.maxSegments",1,8,urlParams.maxSegments,1,"max-segments-slider","","The max number of segments LANDTRENDR can break time series into.  Generally 3-6 works well. Use a smaller number of characterizing long-term trends is the primary focus and a larger number if characterizing every little change is the primary focus."),$("#parameters-collapse-div").append('<div class="dropdown-divider" ></div>'),$("#parameters-collapse-div").append(staticTemplates.reRunButton),addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div","MAP DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layer icon\" src=\"images/layer_icon.png\">",!0,null,mode+" DATA layers to view on map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map"),addCollapse("sidebar-left","download-collapse-label","download-collapse-div","DOWNLOAD DATA",'<i role="img" class="fa fa-cloud-download mr-1" aria-hidden="true"></i>',!1,"","Download "+mode+" products for further analysis")}else if("MTBS"===mode){startYear=1984,endYear=2020,null!=urlParams.startYear&&null!=urlParams.startYear||(urlParams.startYear=startYear),null!=urlParams.endYear&&null!=urlParams.endYear||(urlParams.endYear=endYear),addCollapse("sidebar-left","support-collapse-label","support-collapse-div","SUPPORT & FEEDBACK",'<i role="img" class="fa fa-question-circle mr-1" aria-hidden="true"></i>',!0,"",""),$("#support-collapse-div").append(staticTemplates.walkThroughButton),$("#support-collapse-div").append('<div class="dropdown-divider"</div>'),$("#support-collapse-div").append('<p>MTBS burned area boundaries and severity within the Data Explorer and MTBS web map services are updated regularly, but alignment of their update schedule may vary. Please visit the <a href="https://mtbs.gov/direct-download?tab=map-services&target=mtbs-data-explorer" target="_blank" > map services</a> section at MTBS.gov to verify the publication dates when making comparisons between the MTBS data available within these products/services.</p>'),$("#support-collapse-div").append('<div class="dropdown-divider"</div>'),$("#support-collapse-div").append('<p style = "margin-bottom:0px;">If you have any issues with this tool or have suggestions on how it could be improved, please <a href="https://www.mtbs.gov/contact" target="_blank" > contact us</a></p>'),addCollapse("sidebar-left","parameters-collapse-label","parameters-collapse-div","PARAMETERS",'<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>',!1,null,"Adjust parameters used to filter and sort MTBS products");var mtbsZoomToDict={All:!0,CONUS:!1,Alaska:!1,Hawaii:!1,"Puerto-Rico":!1};addMultiRadio("parameters-collapse-div","mtbs-zoom-to-radio","Zoom to MTBS Mapping Area","mtbsMappingArea",mtbsZoomToDict),$("#mtbs-zoom-to-radio").prop("title","Zoom to MTBS region"),$("#mtbs-zoom-to-radio").change((function(){console.log(mtbsMappingArea),synchronousCenterObject(clientBoundsDict[mtbsMappingArea])})),$("#parameters-collapse-div").append('<div class="dropdown-divider" ></div>'),addDualRangeSlider("parameters-collapse-div","Choose analysis year range:","urlParams.startYear","urlParams.endYear",startYear,endYear,urlParams.startYear,urlParams.endYear,1,"analysis-year-slider","null","Years of MTBS data to include"),addMultiRadio("parameters-collapse-div","mtbs-summary-method-radio","How to summarize MTBS data","mtbsSummaryMethod",{"Highest-Severity":!0,"Most-Recent":!1,Oldest:!1}),$("#mtbs-summary-method-radio").prop("title",'Select how to summarize MTBS raster data in areas with multiple fires.  Each summary method is applied on a pixel basis. "Highest-Severity" will show the severity and fire year corresponding to the highest severity. "Most-Recent" will show the severity and fire year corresponding to the most recently mapped fire. "Oldest" will show the severity and fire year corresponding to the oldest mapped fire.'),$("#parameters-collapse-div").append('<div class="dropdown-divider" ></div>'),$("#parameters-collapse-div").append(staticTemplates.reRunButton),addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div",mode+" DATA","<img style = 'width:1.2em;height:1.1em;margin-top:-0.2em;margin-left:-0.1em' class='image-icon mr-1' alt=\"MTBS logo\" src=\"images/mtbs-logo.png\">",!0,null,mode+" DATA layers to view on map"),addCollapse("sidebar-left","reference-layer-list-collapse-label","reference-layer-list-collapse-div","REFERENCE DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!1,null,"Additional relevant layers to view on map intended to provide context for "+mode+" DATA"),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),$("#reference-layer-list-collapse-div").append('<ul id="reference-layer-list" class = "layer-list"></ul>'),$("#introModal-body").append(staticTemplates.walkThroughButton)}else if("TEST"===mode||"IDS"===mode)addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div",mode+" DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!0,null,mode+" DATA layers to view on map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map");else if("LAMDA"===mode)addCollapse("sidebar-left","parameters-collapse-label","parameters-collapse-div","PARAMETERS",'<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>',!1,null,"Adjust parameters used to filter and sort LAMDA products"),startYear=2021,endYear=(new Date).getYear()+1900,null!=urlParams.year&&null!=urlParams.year||(urlParams.year=endYear),addRangeSlider("parameters-collapse-div","Year","urlParams.year",startYear,endYear,urlParams.year,1,"year-slider","","Year of LAMDA products to show"),$("#parameters-collapse-div").append(staticTemplates.reRunButton),addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div",mode+" DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!0,null,mode+" DATA layers to view on map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map");else if("geeViz"===mode)addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div",mode+" DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!0,null,mode+" DATA layers to view on map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map");else if("STORM"===mode){function refineFeatures(e,a){var t=e.slice(0,e.length-1),o=e.slice(1,e.length),l=[t[0]];return t.forEach((function(e,t){var r=o[t],n=e.geometry.coordinates,i=r.geometry.coordinates,s=JSON.parse(JSON.stringify(e));s.geometry.coordinates=[(n[0]+i[0])/2,(n[1]+i[1])/2],a.map((function(a){var t=e.properties[a],o=(r.properties[a]+t)/2;s.properties[a]=o})),l.push([s,r])})),l=l.flat()}function ingestStormTrack(){if($("#summary-spinner").show(),jQuery("#stormTrackUpload")[0].files.length>0){var e=new FileReader;e.onload=function(){var a=e.result.split("\n");a=(a=a.filter((e=>e.split("\t").length>5))).map((function(e){e=e.split("\t");var a={type:"Feature",geometry:{}};return a.geometry.type="Point",a.geometry.coordinates=[parseFloat(e[3]),parseFloat(e[2])],a.properties={},a.properties.lat=parseFloat(e[2]),a.properties.lon=parseFloat(e[3]),a.properties.wspd=parseFloat(e[4]),a.properties.pres=parseFloat(e[5]),a.properties.category=e[6],a.properties.date=new Date(e[0]+" "+e[1]).getTime(),a.properties.year=new Date(e[0]+" "+e[1]).getFullYear(),a}));for(var t=refinementIterations;t>0&&2*a.length<1500;)console.log("Refining"),console.log(refinementIterations),a=refineFeatures(a,["lat","lon","wspd","pres","date","year"]),console.log(a.length),t--;showMessage("Refinement finished","Refined "+(refinementIterations-t).toString()+"/"+refinementIterations.toString()+" iterations.\nTotal number of refined track points is: "+a.length.toString());var o=a.slice(0,a.length-1),l=a.slice(1),r=ee.List.sequence(0,o.length-1).getInfo().map((function(e){var a={type:"Feature"};return a.geometry=o[e].geometry,a.properties={},a.properties.current=o[e].properties,a.properties.future=l[e].properties,a}));$("#summary-spinner").slideUp(),createHurricaneDamageWrapper(ee.FeatureCollection(r))},e.readAsText(jQuery("#stormTrackUpload")[0].files[0])}else $("#summary-spinner").hide(),showMessage("No storm track provided",'Please download storm track from <a href="https://www.wunderground.com/hurricane" target="_blank">here</a> . Copy and paste the storm track coordinates into a text editor. Save the table. Then upload that table above.')}canExport=!0,addCollapse("sidebar-left","parameters-collapse-label","parameters-collapse-div","PARAMETERS",'<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>',!0,null,"Adjust parameters used to prepare storm outputs"),$("#parameters-collapse-div").append('\n    <label>Download storm track from <a href="https://www.wunderground.com/hurricane" target="_blank">here</a>. Copy and paste the storm track coordinates into a text editor. Save the table. Then upload that table below. <a href="./geojson/michael.txt" download="michael.txt" >Download test data here.</a></label>\n    <input class = \'file-input my-1\' type="file" id="stormTrackUpload" name="upload"  style="display: inline-block;" title = "Download storm track from https://www.wunderground.com/hurricane">\n    <hr>\n    <label>Provide name for storm (optional):</label>\n    <input title = \'Provide a name for the storm. The name of the provided storm track file will be used if left blank.\'  type="user-selected-area-name" class="form-control" id="storm-name"  placeholder="Name your storm!" style=\'width:80%;\'><hr>'),addRangeSlider("parameters-collapse-div","Refinement iterations","refinementIterations",0,10,5,1,"refinement-factor-slider","null","Specify number of iterations to perform a linear interpolation of provided track. A higher number is needed for tracks with fewer real observations"),addRangeSlider("parameters-collapse-div","Max distance (km)","maxDistance",50,500,200,50,"max-distance-slider","null","Specify max distance in km from storm track to include in output"),addRangeSlider("parameters-collapse-div","Min wind (mph)","minWind",0,75,30,5,"min-wind-slider","null","Specify min wind speed in mph to include in output"),$("#parameters-collapse-div").append('\n        <hr>\n        <label style = \'width:90%\'>The MOD of Rupture is intended to indicate how much force it takes to snap a tree. A single value can be provided by providing a constant image (e.g. ee.Image(1)) and a simple lookup to convert that image to a desired MOD of Rupture (e.g. {1:8500}). If different MOD of Rupture values are needed for different tree types, you can provide an EE image that may have tree classes or land cover classes that can then be cross-walked to a MOD of Rupture image with different values for different tree/land cover classes (e.g. ee.Image( "USGS/NLCD_RELEASES/2016_REL/2016" ).select([ 0 ]) with a lookup of {41:8500,42:2000,43:5000,90:4000}</label>\n        <hr>\n        <label>MOD of Rupture Image</label>\n        <textarea   title = \'Provide an image with relevant land cover/tree classes. Provide a constant raster (ee.Image(1)) if you would like to use a constant\'   class="form-control" id="mod-image"   oninput="auto_grow(this)" style=\'width:90%;\'>ee.Image("USGS/NLCD_RELEASES/2016_REL/2016").select([0])</textarea>\n        <hr>\n        <label>MOD of Rupture Lookup</label>\n        <textarea   title = \'Provide a lookup table to remap each class of the image provided above with a MOD of Rupture value.\'  type="user-selected-area-name" class="form-control" id="mod-lookup" oninput="auto_grow(this)" style=\'width:90%;\'>{41:8500, 42:2000, 43:5000, 90:4000}</textarea>\n       '),$("#parameters-collapse-div").append("<div class=\"dropdown-divider\" ></div>\n      <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'ingestStormTrack()' title = 'Click to ingest storm track and map damage'>Ingest Storm Track</button>\n      <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'reRun()' title = 'Click to remove existing layers and exports'>Clear All Layers/Exports</button><br>"),addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div",mode+" DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!0,null,mode+" DATA layers to view on map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map"),addCollapse("sidebar-left","download-collapse-label","download-collapse-div","DOWNLOAD DATA",'<i role="img" class="fa fa-cloud-download mr-1" aria-hidden="true"></i>',!1,"","Download "+mode+" products for further analysis")}else addCollapse("sidebar-left","layer-list-collapse-label","layer-list-collapse-div","ANCILLARY DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!0,null,mode+" DATA layers to view on map"),addCollapse("sidebar-left","reference-layer-list-collapse-label","reference-layer-list-collapse-div","PLOT DATA","<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">",!1,null,"Additional relevant layers to view on map intended to provide context for "+mode+" DATA"),addCollapse("sidebar-left","tools-collapse-label","tools-collapse-div","TOOLS",'<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>',!1,"","Tools to measure and chart data provided on the map"),$("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'),$("#reference-layer-list-collapse-div").append('<ul id="reference-layer-list" class = "layer-list"></ul>'),plotsOn=!0;if($("body").append("<div class = 'legendDiv flexcroll col-sm-5 col-md-3 col-lg-3 col-xl-2 p-0 m-0' id = 'legendDiv'></div>"),$(".legendDiv").css("bottom",$(".bottombar").height()),$(".sidebar").css("max-height",$("body").height()-$(".bottombar").height()),addLegendCollapse(),addAccordianContainer("tools-collapse-div","tools-accordian"),$("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.0em solid black;'>Measuring Tools</h5>"),addSubAccordianCard("tools-accordian","measure-distance-label","measure-distance-div","Distance Measuring",staticTemplates.distanceDiv,!1,"toggleTool(toolFunctions.measuring.distance)",staticTemplates.distanceTipHover),addSubAccordianCard("tools-accordian","measure-area-label","measure-area-div","Area Measuring",staticTemplates.areaDiv,!1,"toggleTool(toolFunctions.measuring.area)",staticTemplates.areaTipHover),addRadio("measure-distance-div","metricOrImperialDistance-radio","","Imperial","Metric","metricOrImperialDistance","imperial","metric","updateDistance()","updateDistance()","Toggle between imperial or metric units"),addRadio("measure-area-div","metricOrImperialArea-radio","","Imperial","Metric","metricOrImperialArea","imperial","metric","updateArea()","updateArea()","Toggle between imperial or metric units"),addShapeEditToolbar("measure-distance-div","measure-distance-div-icon-bar","undoDistanceMeasuring()","resetPolyline()"),addColorPicker("measure-distance-div-icon-bar","distance-color-picker","updateDistanceColor",distancePolylineOptions.strokeColor),addShapeEditToolbar("measure-area-div","measure-area-div-icon-bar","undoAreaMeasuring()","resetPolys()"),addColorPicker("measure-area-div-icon-bar","area-color-picker","updateAreaColor",areaPolygonOptions.strokeColor),$("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.1em solid black;'>Pixel Tools</h5>"),addSubAccordianCard("tools-accordian","query-label","query-div","Query Visible Map Layers",staticTemplates.queryDiv,!1,"toggleTool(toolFunctions.pixel.query)",staticTemplates.queryTipHover),addSubAccordianCard("tools-accordian","pixel-chart-label","pixel-chart-div","Query "+mode+" Time Series",staticTemplates.pixelChartDiv,!1,"toggleTool(toolFunctions.pixel.chart)",staticTemplates.pixelChartTipHover),addDropdown("pixel-chart-div","pixel-collection-dropdown","Choose which "+mode+" time series to chart","whichPixelChartCollection","Choose which "+mode+" time series to chart."),"geeViz"===mode){$("#pixel-chart-label").remove(),$("#share-button").remove(),$("#tools-accordian").append('<div class="dropdown-divider" ></div>');var tShowToolTipModal=!0;null!==localStorage.showToolTipModal&&void 0!==localStorage.showToolTipModal&&(tShowToolTipModal=localStorage.showToolTipModal),addRadio("tools-accordian","tooltip-radio","Show tool tips","Yes","No","localStorage.showToolTipModal","true","false","","","Whether to show tool tips to help explain how to use the tools."),"false"===tShowToolTipModal&&$("#tooltip-radio-second_toggle_label").click()}if("LAMDA"===mode&&$("#pixel-chart-label").remove(),"LCMS"===mode&&$("#search-share-div").addClass("pt-2"),"LCMS-pilot"===mode||"MTBS"===mode||"lcms-base-learner"===mode||"IDS"===mode||"LCMS"===mode){$("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.1em solid black;'>Area Tools</h5>"),addSubCollapse("tools-accordian","area-chart-params-label","area-chart-params-div","Area Tools Parameters","",!1,""),$("#area-chart-params-label").prop("title","Click here to select which LCMS products to chart, and change which area units are used. "),addDropdown("area-chart-params-div","area-collection-dropdown","Choose which "+mode+" product to summarize","whichAreaChartCollection","Choose which "+mode+" time series to summarize."),$("#parameters-collapse-div").append('<div class="dropdown-divider" ></div>'),addMultiRadio("area-chart-params-div","area-summary-format","Area Units","areaChartFormat",{Percentage:!0,Acres:!1,Hectares:!1}),$("#area-summary-format").prop("title","Choose how to summarize area- as a percentage of the area, acres, or hectares."),addSubAccordianCard("tools-accordian","user-defined-area-chart-label","user-defined-area-chart-div","User-Defined Area",staticTemplates.userDefinedAreaChartDiv,!1,"toggleTool(toolFunctions.area.userDefined)",staticTemplates.userDefinedAreaChartTipHover),addSubAccordianCard("tools-accordian","upload-area-chart-label","upload-area-chart-div","Upload an Area",staticTemplates.uploadAreaChartDiv,!1,"toggleTool(toolFunctions.area.shpDefined)",staticTemplates.uploadAreaChartTipHover),addSubAccordianCard("tools-accordian","select-area-interactive-chart-label","select-area-interactive-chart-div","Select an Area on Map",staticTemplates.selectAreaInteractiveChartDiv,!1,"toggleTool(toolFunctions.area.selectInteractive)",staticTemplates.selectAreaInteractiveChartTipHover),addRangeSlider("upload-reduction-factor-container","Vertex Reduction Factor","uploadReductionFactor",1,5,1,1,"upload-reduction-factor-slider","null","Every n vertex in uploaded file will be kept for polygons > 100 vertices (E.g. if 3 is chosen, every third vertex remains). This is intended to help enable use of uploaded areas that may have failed due to its size."),addRangeSlider("simplify-error-range-container","Simplify Area - Max Error","simplifyMaxError",0,500,0,50,"simplify-error-slider","null","If the selected area is very large and/or has a lot of vertices, it may not compute. In this instance, clear out any existing selections (trash can button below), and increase this value. The selected polygon will be simplified using a max error in meters equal to this value upon selection. Generally between 50 and 150 will get most areas to work."),addShapeEditToolbar("user-defined-edit-toolbar","user-defined-area-icon-bar","undoUserDefinedAreaCharting()","restartUserDefinedAreaCarting()"),addColorPicker("user-defined-area-icon-bar","user-defined-color-picker","updateUDPColor",udpOptions.strokeColor),addShapeEditToolbar("select-features-edit-toolbar","select-area-interactive-chart-icon-bar","removeLastSelectArea()","clearSelectedAreas()","Click to unselect most recently selected polyogn","Click to clear all selected polygons"),$("#tools-accordian").append('<div class="dropdown-divider" ></div>');var tShowToolTipModal=!0;null!==localStorage.showToolTipModal&&void 0!==localStorage.showToolTipModal&&(tShowToolTipModal=localStorage.showToolTipModal),addRadio("tools-accordian","tooltip-radio","Show tool tips","Yes","No","localStorage.showToolTipModal","true","false","","","Whether to show tool tips to help explain how to use the tools."),"false"===tShowToolTipModal&&$("#tooltip-radio-second_toggle_label").click()}if("MTBS"!==mode&&"Ancillary"!==mode||($("#contributor-logos").prepend('<a href="https://www.usgs.gov/" target="_blank" >\n                                    <img src="images/usgslogo.png" class = \'image-icon-bar\' alt="USGS logo" title="Click to learn more about the US Geological Survey">\n                                  </a>'),$("#contributor-logos").prepend('<a href="https://www.mtbs.gov/" target="_blank" >\n                                    <img src="images/mtbs-logo-large.png" class = \'image-icon-bar\' alt="MTBS logo" title="Click to learn more about MTBS">\n                                  </a>')),canExport){function cacheCRS(){localStorage.export_crs=$("#export-crs").val()}$("#download-collapse-div").append(staticTemplates.exportContainer),void 0!==localStorage.export_crs&&null!==localStorage.export_crs&&localStorage.export_crs.indexOf("EPSG")>-1?$("#export-crs").val(localStorage.export_crs):localStorage.export_crs=$("#export-crs").val(),"STORM"===mode&&($("#export-area-drawing-div").append("<hr>\n                                            <button class = 'btn' onclick = 'addTrackBounds()' title = 'Add bounds of storm track for export area.'><i class=\"pr-1 fa fa-square-o\" aria-hidden=\"true\"></i> Use storm track bound as area to download</button>\n                                            "),$("#export-button-div").append("<hr>"),addRangeSlider("export-button-div","Quick look spatial resolution","quickLookRes",1200,6e3,3e3,300,"quick-look-res-slider","null","Specify spatial resolution for quick look downloads."),$("#export-button-div").append("<button class = 'btn' onclick = 'downloadQuickLooks()'  title = 'Quickly download outputs at coarse resolution'><i class=\"pr-1 fa fa-cloud-download\" aria-hidden=\"true\"></i>Download Quick Look Outputs</button>\n                                            "))}function toggleSidebar(){$("#sidebar-left").toggle("collapse"),"false"===urlParams.showSidebar?urlParams.showSidebar="true":urlParams.showSidebar="false"}void 0!==urlParams.showSidebar&&null!==urlParams.showSidebar||(urlParams.showSidebar="true"),"false"===urlParams.showSidebar&&$("#sidebar-left").hide();var mapDiv=document.getElementById("map");function copyObj(e){let a,t={};for(a in e)t[a]=e[a];return t}function copyArray(e){var a=[];return e.map((function(e){a.push(e)})),a}function range(e,a,t){if(e=parseInt(e),void 0===(a=parseInt(a))&&(a=e,e=0),void 0===t&&(t=1),t>0&&e>=a||t<0&&e<=a)return[];for(var o=[],l=e;t>0?l<a:l>a;l+=t)o.push(l);return o}function llToNAD83(e,a){var t=[e,a],o=6378136.98,l=o*Math.PI*2,r=l/360,n=Math.PI/180;return t[0]*=r,(a=t[1])>86?t[1]=l:a<-86?t[1]=-l:(a*=n,a=Math.log(Math.tan(a)+1/Math.cos(a),Math.E),t[1]=a*o),{x:t[0],y:t[1]}}var toObj=(e,a)=>e.reduce(((e,t,o)=>(e[t]=a[o],e)),{}),toDict=toObj;function CopyAnArray(e){for(var a=[],t=0;t<e.length;t++){for(var o=[],l=0;l<e[0].length;l++)o.push(e[t][l]);a.push(o)}return a}function arrayColumn(e,a){return e.map((function(e){return e[a]}))}function tileXYZToQuadKey(e,a,t){for(var o="",l=t;l>0;l--){var r=0,n=1<<l-1;0!=(e&n)&&(r+=1),0!=(a&n)&&(r+=2),o+=r.toString()}return o}function centerMap(e,a,t){map.setCenter({lat:a,lng:e}),map.setZoom(t)}function synchronousCenterObject(e){var a=new google.maps.LatLngBounds;e.coordinates[0].map((function(e){a.extend({lng:e[0],lat:e[1]})})),map.fitBounds(a)}function centerObject(e){try{e.geometry().bounds(100).evaluate((function(e){synchronousCenterObject(e)}))}catch(a){try{e.bounds(100).evaluate((function(e){synchronousCenterObject(e)}))}catch(e){console.log(e)}console.log(a)}}function createColorRamp(e,a,t,o){for(var l="background-image:linear-gradient(to right, ",r=0;r<a.length;r++)l=l+"#"+a[r].toLowerCase()+",";return l=l.slice(0,-1)+");"}function convertToGeoJSON(e){var a=new FormData;return a.append("targetSrs","EPSG:4326"),jQuery.each(jQuery("#"+e)[0].files,(function(e,t){a.append("upload",t)})),$.ajax({type:"POST",url:"https://ogre.adc4gis.com/convert",data:a,processData:!1,contentType:!1,error:function(e){showMessage("Error!","Error converting file: <hr>"+e.responseJSON.msg.replace("\n","<br>")),$("#summary-spinner").hide()}})}function compressGeoJSON(e,a){return null==a&&(a=2),e.features=e.features.map((function(e){return e.geometry.type.indexOf("Multi")>-1?e.geometry.coordinates=e.geometry.coordinates.map((function(e){return e.map((function(e){return e.length>100&&(e=e.filter(((e,t)=>t%a==0))),e}))})):e.geometry.coordinates=e.geometry.coordinates.map((function(e){return e.length>100&&(e=e.filter(((e,t)=>t%a==0))),e})),e})),e}function printImage(e){print(e)}function print(e){console.log(e)}function printEE(e){print("Getting info about ee object"),console.log(e.getInfo((function(e,a){void 0!==e?console.log(e):console.log(a)})))}function getRandomArbitrary(e,a){return Math.random()*(a-e)+e}function clearPlots(){var e=document.getElementById("pt-list");for(print(e);e.firstChild;)e.removeChild(e.firstChild);plotDictID=1,plotIDList=[],plotID=1}function addPlotProject(e,a){var t=document.createElement("ee-pt-project");t.name=e,t.plotList=a,t.ID=plotProjectID;var o=document.querySelector("pt-project-list");o.insertBefore(t,o.firstChild),plotProjectID++}function setPlotColor(e){for(var a=document.getElementsByTagName("ee-pt"),t=0;t<a.length;t++)a[t].style.outline="none";a[a.length-e].style.outline="#FFF solid"}function setPlotProjectColor(e){for(var a=document.getElementsByTagName("ee-pt-project"),t=0;t<a.length;t++)a[t].style.outline="none";a[a.length-e].style.outline="#FFF dotted"}function addSelectLayerToMap(e,a,t,o,l,r,n,i,s){a.canQuery=!1,a.isSelectLayer=!0,addToMap(e,a,t,o,l,r,n,"area-charting-select-layer-list",s)}var intervalPeriod=666.6666666666666,timeLapseID,timeLapseFrame=0,cumulativeMode=!1,lastJitter;function pauseTimeLapse(e){null==e&&(e=timeLapseID),timeLapseObj[timeLapseID=e].isReady&&(pauseAll(),clearActiveButtons(),$("#"+timeLapseID+"-pause-button").addClass("time-lapse-active"))}function setFrameOpacity(e,a){var t=$("#"+e).slider();t.slider("option","value",a),t.slider("option","slide").call(t,null,{handle:$(".ui-slider-handle",t),value:a})}function selectFrame(id,fromYearSlider,advanceOne){if(null==id&&(id=timeLapseID),null==fromYearSlider&&(fromYearSlider=!1),null==advanceOne&&(advanceOne=!0),timeLapseID=id,void 0!==timeLapseID&&timeLapseObj[timeLapseID].isReady){turnOffLayers(),turnOnTimeLapseLayers();var slidersT=timeLapseObj[timeLapseID].sliders;timeLapseFrame>slidersT.length-1?timeLapseFrame=0:timeLapseFrame<0&&(timeLapseFrame=slidersT.length-1),eval(cumulativeMode)&&0!==timeLapseFrame?slidersT.slice(0,timeLapseFrame).map((function(e){try{setFrameOpacity(e,timeLapseObj[timeLapseID].opacity)}catch(e){}})):slidersT.map((function(e){try{setFrameOpacity(e,0)}catch(e){}}));var frame=slidersT[timeLapseFrame];try{setFrameOpacity(frame,timeLapseObj[timeLapseID].opacity),fromYearSlider||Object.keys(timeLapseObj).map((function(e){$("#"+e+"-year-slider").slider().slider("option","value",timeLapseObj[e].years[timeLapseFrame]),$("#"+e+"-year-slider-handle-label").text(timeLapseObj[e].years[timeLapseFrame])}))}catch(e){}$("#"+timeLapseID+"-year-label").show(),$("#time-lapse-year-label").show(),$("#time-lapse-year-label").html(`Time lapse year: ${timeLapseObj[timeLapseID].years[timeLapseFrame]}`)}}function advanceOneFrame(){timeLapseFrame++,selectFrame()}function pauseButtonFunction(e){null==e&&(e=timeLapseID),void 0!==(timeLapseID=e)&&timeLapseObj[timeLapseID].isReady&&(clearAllFrames(),pauseTimeLapse(),selectFrame(),alignTimeLapseCheckboxes(),timeLapseObj[timeLapseID].state="paused")}function pauseAll(){Object.keys(timeLapseObj).map((function(e){null!==timeLapseObj[e].intervalValue&&void 0!==timeLapseObj[e].intervalValue&&window.clearInterval(timeLapseObj[e].intervalValue),timeLapseObj[e].intervalValue=null}))}function forwardOneFrame(e){timeLapseObj[timeLapseID=e].isReady&&(clearAllFrames(),pauseTimeLapse(),advanceOneFrame(),alignTimeLapseCheckboxes())}function backOneFrame(e){timeLapseObj[timeLapseID=e].isReady&&(clearAllFrames(),pauseTimeLapse(),timeLapseFrame--,selectFrame(),alignTimeLapseCheckboxes())}function clearActiveButtons(){Object.keys(timeLapseObj).map((function(e){$("#"+e+"-pause-button").removeClass("time-lapse-active"),$("#"+e+"-play-button").removeClass("time-lapse-active"),e===timeLapseID&&$("#"+e+"-stop-button").removeClass("time-lapse-active")}))}function clearAllFrames(){turnOffAllNonActiveTimeLapseLayers(),Object.keys(timeLapseObj).map((function(e){var a=timeLapseObj[e].sliders;$("#"+e+"-year-label").hide(),$("#"+e+"-stop-button").addClass("time-lapse-active"),$("#"+e+"-pause-button").removeClass("time-lapse-active"),$("#"+e+"-play-button").removeClass("time-lapse-active"),timeLapseObj[e].state="inactive",a.map((function(e){try{setFrameOpacity(e,0)}catch(e){}}))}))}function setSpeed(e,a){intervalPeriod=a,timeLapseObj[timeLapseID=e].isReady&&(pauseAll(),playTimeLapse(e))}function playTimeLapse(e){null==e&&(e=timeLapseID),void 0!==(timeLapseID=e)&&timeLapseObj[timeLapseID].isReady&&(clearAllFrames(),pauseAll(),timeLapseObj[timeLapseID].state="play",selectFrame(null,null,!1),null!==timeLapseObj[e].intervalValue&&void 0!==timeLapseObj[e].intervalValue||(timeLapseObj[e].intervalValue=window.setInterval(advanceOneFrame,intervalPeriod)),$("#"+e+"-stop-button").removeClass("time-lapse-active"),$("#"+e+"-pause-button").removeClass("time-lapse-active"),$("#"+e+"-play-button").addClass("time-lapse-active"),alignTimeLapseCheckboxes())}function stopTimeLapse(e){$("#time-lapse-year-label").empty(),$("#time-lapse-year-label").hide(),timeLapseID=null,pauseAll(),clearAllFrames()}function toggleTimeLapseLayers(e){null==e&&(e=timeLapseID),timeLapseObj[k].layerVisibleIDs.map((function(e){$("#"+e).click()}))}function toggleAllTimeLapseLayers(){Object.keys(timeLapseObj).map((function(e){toggleTimeLapseLayers(e)}))}function turnOffAllTimeLapseLayers(){Object.keys(timeLapseObj).map((function(e){turnOffTimeLapseLayers(e)}))}function turnOffAllNonActiveTimeLapseLayers(){Object.keys(timeLapseObj).map((function(e){e!==timeLapseID&&turnOffTimeLapseLayers(e)}))}function toggleTimeLapseLayers(e){null==e&&(e=timeLapseID),timeLapseObj[e].isReady&&(timeLapseObj[e].layerVisibleIDs.map((function(e){$("#"+e).click()})),timeLapseObj[e].visible?timeLapseObj[e].visible=!1:timeLapseObj[e].visible=!0)}function turnOnTimeLapseLayers(e){null==e&&(e=timeLapseID),timeLapseObj[e].isReady&&(!1===timeLapseObj[e].visible&&(timeLapseObj[e].visible=!0,timeLapseObj[e].layerVisibleIDs.map((function(e){$("#"+e).click()}))),queryObj[e].visible=timeLapseObj[e].visible)}function turnOffTimeLapseLayers(e){null==e&&(e=timeLapseID),timeLapseObj[e].isReady&&(!0===timeLapseObj[e].visible&&(timeLapseObj[e].visible=!1,timeLapseObj[e].layerVisibleIDs.map((function(e){$("#"+e).click()}))),queryObj[e].visible=timeLapseObj[e].visible)}function jitterZoom(e){null==e&&(e=!1),null==lastJitter&&(lastJitter=new Date);var a=new Date-lastJitter,t=!1;if(a>5e3&&0===geeTileLayersDownloading||a>2e4||e){console.log("jittering zoom");var o=map.getZoom();updateViewList=!1,map.setZoom(o-1),updateViewList=!1,map.setZoom(o),t=!0,lastJitter=new Date}return t}function alignTimeLapseCheckboxes(){Object.keys(timeLapseObj).map((function(e){if(timeLapseObj[e].isReady){var a=!1;timeLapseObj[e].visible?(a=!0,$("#"+e+"-time-lapse-layer-range-container").slideDown(),$("#"+e+"-icon-bar").slideDown(),$("#"+e+"-collapse-label").addClass("time-lapse-label-container")):($("#"+e+"-collapse-label").css("background","-webkit-linear-gradient(left, #FFF, #FFF 0%, transparent 0%, transparent 100%)"),$("#"+e+"-time-lapse-layer-range-container").slideUp(),$("#"+e+"-icon-bar").slideUp(),$("#"+e+"-collapse-label").removeClass("time-lapse-label-container"),$("#"+e+"-loading-spinner").hide(),$("#"+e+"-loading-gear").hide()),$("#"+e+"-toggle-checkbox").prop("checked",a)}}))}function timeLapseCheckbox(e){var a=timeLapseObj[e].visible;ga("send","event","time-lapse-toggle",e,a),a?stopTimeLapse(e):pauseButtonFunction(e),alignTimeLapseCheckboxes()}function toggleFrames(e){$("#"+e+"-collapse-div").toggle()}function turnOffTimeLapseCheckboxes(){Object.keys(timeLapseObj).map((function(e){timeLapseObj[e].isReady&&timeLapseObj[e].visible&&stopTimeLapse(e)})),alignTimeLapseCheckboxes()}function toggleCumulativeMode(){cumulativeMode?($(".cumulativeToggler").removeClass("time-lapse-active"),cumulativeMode=!1):($(".cumulativeToggler").addClass("time-lapse-active"),cumulativeMode=!0),selectFrame()}function fillEmptyCollections(e,a){var t=ee.ImageCollection([a.mask(ee.Image(0))]),o=e.toList(1).length();return ee.ImageCollection(ee.Algorithms.If(o.gt(0),e,t))}function addTimeLapseToMap(e,a,t,o,l,r,n,i,s){null!=a&&null!==a.serialized&&void 0!==a.serialized&&!0===a.serialized&&(e=ee.Deserializer.decode(e),a.serialized=!1),null!==a.cumulativeMode&&void 0!==a.cumulativeMode||(a.cumulativeMode=!1);o=!1;void 0!==a.opacity&&null!==a.opacity||(a.opacity=1),e=ee.ImageCollection(e);var d="";var c=t.replaceAll(" ","-")+"-"+NEXT_LAYER_ID.toString();c=(c=(c=c.replaceAll("/","-")).replaceAll("(","-")).replaceAll(")","-"),a.autoViz&&(dicts=getLookupDicts(ee.Image(e.first()),null,"eeImage"),a.classLegendDict=dicts.classLegendDict,a.queryDict=dicts.queryDict,a.autoViz=!1),a.canQuery=!1,a.isSelectLayer=!1,a.isTimeLapse=!0,a.timeLapseID=c,a.layerType="geeImage",null!==a.dateFormat&&void 0!==a.dateFormat||(a.dateFormat="YYYY",a.advanceInterval="year"),timeLapseObj[c]={},null==i&&(i="layer-list"),null!==a.years&&void 0!==a.years||(console.log("start computing years"),a.years=unique(e.sort("system:time_start",!0).toList(1e4,0).map((function(e){var t=ee.Date(ee.Image(e).get("system:time_start"));return ee.Number.parse(t.format(a.dateFormat)).int32()})).getInfo()),console.log("done computing years"),console.log(a.years),console.log(a));var p=a.years[0],u=a.years[a.years.length-1];timeLapseObj[c].years=a.years,timeLapseObj[c].frames=ee.List.sequence(0,a.years.length-1).getInfo(),timeLapseObj[c].nFrames=a.years.length,timeLapseObj[c].loadingLayerIDs=[],timeLapseObj[c].loadingTilesLayerIDs=[],timeLapseObj[c].layerVisibleIDs=[],timeLapseObj[c].sliders=[],timeLapseObj[c].intervalValue=null,timeLapseObj[c].isReady=!1,timeLapseObj[c].visible=o,timeLapseObj[c].state="inactive",timeLapseObj[c].opacity=100*a.opacity,queryObj[c]={visible:timeLapseObj[c].visible,queryItem:e,queryDict:a.queryDict,type:"geeImageCollection",name:t};$("#"+i).append(`\n                                <li   title = 'Time lapse layers load multiple map layers throughout time. Once loaded, you can play the time lapse as an animation, or advance through single years using the buttons and sliders provided.  The layers can be displayed as a single year or as a cumulative mosaic of all preceding years using the right-most button.' id = '${c}-collapse-label' class = 'layer-container'>\n                                  <div class = 'time-lapse-layer-range-container' >\n                                    <div title = 'Opacity' id='${c}-opacity-slider' class = 'simple-time-lapse-layer-range-first'>\n                                      <div id='${c}-opacity-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                        <div style = 'display:none;' id='${c}-opacity-slider-handle-label' class = 'time-lapse-slider-handle-label'>${timeLapseObj[c].opacity/100}</div>\n                                      </div>\n                                    </div>\n                                    <div id='${c}-time-lapse-layer-range-container' style = 'display:none;'>\n                                      <div title = 'Frame Year' id='${c}-year-slider' class = 'simple-time-lapse-layer-range'>\n                                        <div id='${c}-year-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                          <div id='${c}-year-slider-handle-label' class = 'time-lapse-slider-handle-label'>${a.years[0]}</div>\n                                        </div>\n                                      </div>\n                                    \n                                      <div title = 'Frame Rate' id='${c}-speed-slider' class = 'simple-time-lapse-layer-range'>\n                                        <div id='${c}-speed-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                          <div id='${c}-speed-slider-handle-label' class = 'time-lapse-slider-handle-label'>${(1/(intervalPeriod/1e3)).toFixed(1)}fps</div>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  </div>\n                                  <input  id="${c}-toggle-checkbox" onchange = 'timeLapseCheckbox("${c}")' type="checkbox" ${d}/>\n                                  <label  title = 'Activate/deactivate time lapse' id="${c}-toggle-checkbox-label" style = 'margin-bottom:0px;display:none;'  for="${c}-toggle-checkbox"></label>\n                                  <i style = 'display:none;' id = '${c}-loading-gear' title = '${t} time lapse tiles loading' class="text-dark fa fa-gear fa-spin layer-spinner"></i>\n                                  <i id = '${c}-loading-spinner' title = '${t} time lapse layers loading' class="text-dark fa fa-spinner fa-spin layer-spinner"></i>\n\n                                  <span  id = '${c}-name-span'  class = 'layer-span'>${t}</span>\n\n                                  <div id = "${c}-icon-bar" class = 'icon-bar pl-4 pt-3' style = 'display:none;'>\n                                    <button class = 'btn' title = 'Back one frame' id = '${c}-backward-button' onclick = 'backOneFrame("${c}")'><i class="fa fa-backward fa-xs"></i></button>\n                                    <button class = 'btn' title = 'Pause animation' id = '${c}-pause-button' onclick = 'pauseButtonFunction("${c}")'><i class="fa fa-pause"></i></button>\n                                    <button style = 'display:none;' class = 'btn time-lapse-active' title = 'Clear animation' id = '${c}-stop-button' onclick = 'stopTimeLapse("${c}")'><i class="fa fa-stop"></i></button>\n                                    <button class = 'btn' title = 'Play animation' id = '${c}-play-button'  onclick = 'playTimeLapse("${c}")'><i class="fa fa-play"></i></button>\n                                    <button class = 'btn' title = 'Forward one frame' id = '${c}-forward-button' onclick = 'forwardOneFrame("${c}")'><i class="fa fa-forward"></i></button>\n                                    <button style = '' class = 'btn' title = 'Refresh layers if tiles failed to load' id = '${c}-refresh-tiles-button' onclick = 'jitterZoom(true)'><i class="fa fa-refresh"></i></button>\n                                    <button style = 'display:none;' class = 'btn' title = 'Toggle frame visiblity' id = '${c}-toggle-frames-button' onclick = 'toggleFrames("${c}")'><i class="fa fa-eye"></i></button>\n                                    <button class = 'btn cumulativeToggler' onclick = 'toggleCumulativeMode()' title = 'Click to toggle whether to show a single year or all years in the past along with current year'><img style = 'width:1.4em;filter: invert(100%) brightness(500%)'  src="images/cumulative_icon.png"></button>\n                                    <div id = "${c}-message-div" class = 'pt-2'></div>\n                                  </div>\n\n                                </li>\n                                \n                                <div id = '${c}-collapse-div' style = 'display:none;'></div>`),$("#time-lapse-legend-list").append(`<div id="legend-${c}-collapse-div"></div>`),onclick='timeLapseCheckbox("${legendDivID}")';if($("#"+c+"-name-span").click((function(){setTimeout((function(){timeLapseCheckbox(c)}),200)})),a.layerType="geeImage",a.legendTitle=t,a.opacity=0,"tileMapService"===a.timeLapseType)a.layerType="tileMapService",a.years.map((function(i){i!==a.years[0]&&(a.addToLegend=!1,a.addToClassLegend=!1);var d=Object.assign({},a);d.year=i,addToMap(standardTileURLFunction(e+i.toString()+"/",!0,""),d,t+" "+i.toString(),o,l,r,n,c+"-collapse-div",s)}));else{var m=ee.Image(e.first());a.years.map((function(i){var d=ee.Date.parse(a.dateFormat,i.toString()),p=fillEmptyCollections(e.filterDate(d,d.advance(1,a.advanceInterval)),m);p=ee.Image(p.first()).set("system:time_start",d.millis());i!==a.years[0]&&(a.addToLegend=!1,a.addToClassLegend=!1,a.classLegendDict=null);var u=Object.assign({},a);u.year=i,addToMap(p,u,t+" "+i.toString(),o,l,r,n,c+"-collapse-div",s)}))}"tileMapService"===a.timeLapseType&&(timeLapseObj[c].isReady=!0,$("#"+c+"-toggle-checkbox-label").show(),$("#"+c+"-loading-spinner").hide()),timeLapseObj[c].sliders=timeLapseObj[c].sliders,$("#"+c+"-opacity-slider").slider({min:0,max:1,step:.05,value:timeLapseObj[c].opacity/100,slide:function(e,a){var t=a.value,o=c;$("#"+o+"-opacity-slider").slider().slider("option","value",a.value),$("#"+o+"-opacity-slider-handle-label").text(t),timeLapseObj[o].opacity=100*t,selectFrame(null,null,!1)}}),$("#"+c+"-year-slider").slider({min:p,max:u,step:1,value:p,slide:function(e,t){var o=t.value,l=a.years.indexOf(o);timeLapseFrame=l,Object.keys(timeLapseObj).map((function(e){$("#"+e+"-year-slider").slider().slider("option","value",t.value),$("#"+e+"-year-slider-handle-label").text(t.value)})),timeLapseObj[c].isReady&&(clearAllFrames(),pauseTimeLapse(c),selectFrame(c,!0,!1),alignTimeLapseCheckboxes())}}),$("#"+c+"-speed-slider").slider({min:.5,max:3,step:.5,value:1.5,slide:function(e,a){var t=1/a.value*1e3;Object.keys(timeLapseObj).map((function(e){$("#"+e+"-speed-slider").slider().slider("option","value",a.value),$("#"+e+"-speed-slider-handle-label").text(`${a.value.toFixed(1)}fps`)})),timeLapseObj[c].isReady&&setSpeed(c,t)}})}function addExport(e,a,t,o,l,r){var n={};null==l&&(l={}),null==o&&(o=!0),null==r&&(r=-32768);var i="";o&&(i="checked");var s=Date().split(" ");s[2],s[1],s[3],s[4];a=(a=(a=a.replace(/\s+/g,"_")).replaceAll("(","_")).replaceAll(")","_"),n.res=t,n.name=a,n.eeImage=e,n.Export=o,n.ID=exportID,exportImageDict[exportID]={eeImage:e,name:a,res:t,shouldExport:o,metadataParams:l,noDataValue:r},$("#export-list").append(`<div class = 'input-group'>\n                              <span  class="input-group-addon">\n                                <input  id = '${a}-checkbox-${exportID}' type="checkbox" ${i} >\n                                <label  style = 'margin-bottom:0px;'  for='${a}-checkbox-${exportID}'></label>\n                              </span>\n                              \n                              <input  id = '${a}-name-${exportID}' class="form-control export-name-input" type="text" value="${n.name}" title = 'Change export name if needed'>\n                            </div>`),$("#"+a+"-name-"+exportID.toString()).on("input",(function(){exportImageDict[n.ID].name=$(this).val()})),$("#"+a+"-checkbox-"+exportID.toString()).on("change",(function(){exportImageDict[n.ID].shouldExport=this.checked})),exportID++}function getLookupDicts(e,a,t){return"geeImageCollection"==t&&(e=ee.Image(e.first())),null==a&&(a=ee.Image(e).bandNames().getInfo()[0]),values=ee.List([e.get(a+"_class_values"),e.get(a+"_class_names"),e.get(a+"_class_palette")]).getInfo(),value_name=zip(values[0],values[1]).map((function(e){return e.join("- ")})),legendDict=toObj(value_name,values[2]),queryDict=toObj(values[0],value_name),{classLegendDict:legendDict,queryDict:queryDict}}var typeLookup={Image:"geeImage",ImageCollection:"geeImageCollection",Feature:"geeVectorImage",FeatureCollection:"geeVectorImage",Geometry:"geeVectorImage"};function addToMap(e,a,t,o,l,r,n,i,s){null!=a&&null!==a.serialized&&void 0!==a.serialized&&!0===a.serialized&&(e=ee.Deserializer.decode(e));var d=geeRunID;if(null==i&&(i="layer-list"),null==a&&(a={}),null==t&&(t="Layer "+NEXT_LAYER_ID),null===a.layerType||void 0===a.layerType){var c=ee.Algorithms.ObjectType(e).getInfo();"Feature"===c&&(e=ee.FeatureCollection([e]),c=ee.Algorithms.ObjectType(e).getInfo()),a.layerType=typeLookup[c]}console.log(t+": "+a.layerType),"geoJSONVector"===a.layerType&&(a.canQuery=!1),"geeVector"===a.layerType||"geoJSONVector"===a.layerType?(void 0!==a.strokeOpacity&&null!==a.strokeOpacity||(a.strokeOpacity=1),void 0!==a.fillOpacity&&null!==a.fillOpacity||(a.fillOpacity=.2),void 0!==a.fillColor&&null!==a.fillColor||(a.fillColor="222222"),void 0!==a.strokeColor&&null!==a.strokeColor||(a.strokeColor=getColor()),void 0!==a.strokeWeight&&null!==a.strokeWeight||(a.strokeWeight=3),a.opacityRatio=a.strokeOpacity/a.fillOpacity,-1==a.fillColor.indexOf("#")&&(a.fillColor="#"+a.fillColor),-1==a.strokeColor.indexOf("#")&&(a.strokeColor="#"+a.strokeColor),void 0!==a.addToClassLegend&&null!==a.addToClassLegend||(a.addToClassLegend=!0)):"geeVectorImage"===a.layerType&&(void 0!==a.strokeOpacity&&null!==a.strokeOpacity||(a.strokeOpacity=1),a.fillOpacity=0,void 0!==a.fillColor&&null!==a.fillColor||(a.fillColor="222222"),void 0!==a.strokeColor&&null!==a.strokeColor||(a.strokeColor=getColor()),void 0!==a.strokeWeight&&null!==a.strokeWeight||(a.strokeWeight=2),-1==a.fillColor.indexOf("#")&&(a.fillColor="#"+a.fillColor),-1==a.strokeColor.indexOf("#")&&(a.strokeColor="#"+a.strokeColor),void 0!==a.addToClassLegend&&null!==a.addToClassLegend||(a.addToClassLegend=!0,a.addToLegend=!1));var p=t.replaceAll(" ","-")+"-"+NEXT_LAYER_ID.toString();p=(p=(p=(p=(p=(p=p.replaceAll("/","-")).replaceAll("(","-")).replaceAll(")","-")).replaceAll("&","-")).replaceAll(",","-")).replaceAll(".","-"),null==o&&(o=!0),null==a.opacity&&(a.opacity=1),-1!=Object.keys(layerObj).indexOf(p)&&(o=layerObj[p].visible,a.opacity=layerObj[p].opacity,"geeVector"!==a.layerType&&"geoJSONVector"!==a.layerType||(a.strokeOpacity=layerObj[p].opacity,a.fillOpacity=a.strokeOpacity/a.opacityRatio)),null!=n&&void 0!==n||(n=""),null!==a.title&&void 0!==a.title&&(n=a.title);var u={};if(u.ID=NEXT_LAYER_ID,NEXT_LAYER_ID+=1,u.layerChildID=layerChildID,layerChildID++,u.name=t,u.opacity=a.opacity,a.opacity=1,u.map=map,u.helpBoxMessage=n,u.visible=o,u.label=l,u.fontColor=r,u.helpBox=n,u.legendDivID=p,null==s&&(s=e),null!==a.canQuery&&void 0!==a.canQuery||(a.canQuery=!0),u.canQuery=a.canQuery,u.queryItem=s,u.layerType=a.layerType,a.autoViz&&(dicts=getLookupDicts(e,null,a.layerType),a.classLegendDict=dicts.classLegendDict,a.queryDict=dicts.queryDict),null==a||null!=a.bands||0==a.addToLegend||void 0!==a.addToClassLegend&&null!==a.addToClassLegend&&!1!==a.addToClassLegend||null!=a.classLegendDict&&null!=a.classLegendDict){if(null!=a&&(void 0!==a.classLegendDict&&null!==a.classLegendDict||!0===a.addToClassLegend)){addLegendContainer(p,"legend-"+i,!1,n);var m,g=p+"-class-container";if(m=null!==a.legendTitle&&void 0!==a.legendTitle?a.legendTitle:t,addClassLegendContainer(g,p,m),"geeVector"!==a.layerType&&"geoJSONVector"!==a.layerType&&"geeVectorImage"!==a.layerType){Object.keys(a.classLegendDict).map((function(e){var o={};o.name=t,o.helpBoxMessage=n,o.classColor=a.classLegendDict[e],o.classStrokeColor="999",o.classStrokeWeight=1,o.className=e,addClassLegendEntry(g,o)}))}else{(v={}).name=t,v.helpBoxMessage=n;var h=a.strokeColor.slice(1),y=a.fillColor.slice(1);3===h.length&&(h=h.split("").map((function(e){return e+e})).join().replaceAll(",","")),3===y.length&&(y=y.split("").map((function(e){return e+e})).join().replaceAll(",","")),v.classColor=y+Math.floor(a.fillOpacity/2*255).toString(16),v.classStrokeColor=h+Math.floor(255*a.strokeOpacity).toString(16),v.classStrokeWeight=a.strokeWeight+1,v.className="",addClassLegendEntry(g,v)}var f={};f.name=t,f.helpBoxMessage=n}}else{addLegendContainer(p,"legend-"+i,!1,n);var v={};if(null!==a.legendTitle&&void 0!==a.legendTitle?v.name=a.legendTitle:v.name=t,v.helpBoxMessage=n,null!=a.palette)var b=a.palette;else b="000,FFF";var w=b;"string"==typeof b&&(w=w.split(",")),1==w.length&&(w=[w[0],w[0]]),w=w.map((function(e){return e.indexOf("#")>-1&&(e=e.slice(1)),e}));var S=createColorRamp("colorRamp"+colorRampIndex.toString(),w,180,20);v.colorRamp=S,null!=l&&null!=a.min?v.min=a.min+" "+l:null!=l&&null==a.min?v.min=minLabel:null==l&&null!=a.min&&(v.min=a.min),null!=l&&null!=a.max?v.max=a.max+" "+l:null!=l&&null==a.max?v.max=maxLabel:null==l&&null!=a.max&&(v.max=a.max),null!==a.legendLabelLeft&&void 0!==a.legendLabelLeft&&(v.min=a.legendLabelLeft+" "+a.min),null!==a.legendLabelRight&&void 0!==a.legendLabelRight&&(v.max=a.legendLabelRight+" "+a.max),null!==a.legendLabelLeftAfter&&void 0!==a.legendLabelLeftAfter&&(v.min=a.min+" "+a.legendLabelLeftAfter),null!==a.legendLabelRightAfter&&void 0!==a.legendLabelRightAfter&&(v.max=a.max+" "+a.legendLabelRightAfter),null==v.min&&(v.min="min"),null==v.max&&(v.max="max"),v.fontColor=null!=r?"color:#"+r+";":"color:#DDD;",addColorRampLegendEntry(p,v)}u.visible=o,u.item=e,u.name=t,u.viz=a,u.whichLayerList=i,u.layerId=layerCount,u.currentGEERunID=d,addLayer(u),layerCount++}function standardTileURLFunction(e,a,t,o){return null==a&&(a=!1),o=null==o?"":"?token="+o,null==t&&(t=".png"),function(l,r){var n=1<<r,i=l.x%n;return console.log(l,r,i),i<0&&(i=n+i),a?e+r+"/"+i+"/"+l.y+t+o:e+r+"/"+l.y+"/"+i+t+o}}function superSimpleTileURLFunction(e){return function(a,t){return e+t+"/"+a.y+"/"+a.x}}function addRESTToMap(e,a,t,o,l,r){var n=ee.Image();null==r&&(r="layer-list"),null==a&&(a="Layer "+NEXT_LAYER_ID),null==t&&(t=!0),null==o&&(o=18),null==l&&(l="");var i=document.createElement("REST-layer");i.tileURLFunction=e,i.ID=NEXT_LAYER_ID,NEXT_LAYER_ID+=1,i.layerChildID=layerChildID,layerChildID++,i.name=a,i.map=map,i.helpBoxMessage=l,i.visible=t,i.helpBox=l,i.maxZoom=o,i.visible=t,i.item=n,i.name=a;var s=document.querySelector(r);s.insertBefore(i,s.firstChild),layerCount++,n.getMap({},(function(e){i.setLayer(e)}))}function point2LatLng(e,a){var t=document.getElementById("map");e-=t.offsetLeft,a-=t.offsetTop;var o=map.getProjection().fromLatLngToPoint(map.getBounds().getNorthEast()),l=map.getProjection().fromLatLngToPoint(map.getBounds().getSouthWest()),r=Math.pow(2,map.getZoom()),n=new google.maps.Point(e/r+l.x,a/r+o.y);return map.getProjection().fromPointToLatLng(n)}function getGroundOverlay(e,a,t){if(map.getZoom()>=a){null==t&&(t="");var o=$("#map").height(),l=$("#map").width(),r=map.getBounds(),n=Object.keys(r),i=Object.keys(r[n[0]]),s=Object.keys(r[n[1]]);eeBoundsPoly=ee.Geometry.Rectangle([r[n[1]][i[0]],r[n[0]][s[0]],r[n[1]][i[1]],r[n[0]][s[1]]]);var d=r[n[1]][i[0]],c=r[n[1]][i[1]],p=[d,r[n[0]][s[0]]],u=[c,r[n[0]][s[1]]],m=llToNAD83(p[0],p[1]),g=llToNAD83(u[0],u[1]),h=e+m.x.toString()+"%2C"+g.y.toString()+"%2C"+g.x.toString()+"%2C"+m.y.toString()+"&bboxSR=102100&imageSR=102100&size="+l.toString()+"%2C"+o.toString()+"&f=image"+t;return overlay=new google.maps.GroundOverlay(h,r),overlay}return h="../images/blank.png",overlay=new google.maps.GroundOverlay(h,map.getBounds()),overlay}function addDynamicToMap(e,a,t,o,l,r,n,i,s,d){null==d&&(d="layer-list");var c=ee.Image();null==n&&(n="Layer "+NEXT_LAYER_ID),null==i&&(i=!0),null==s&&(s="");var p=document.createElement("dynamic-layer");p.ID=NEXT_LAYER_ID,NEXT_LAYER_ID+=1,p.layerChildID=layerChildID,layerChildID++,p.name=n,p.map=map,p.helpBoxMessage=s,p.visible=i,p.groundOverlayFunction=function(){return map.getZoom()>r?getGroundOverlay(a,r,t):getGroundOverlay(e,l,o)},p.helpBox=s,p.visible=i,p.item=c,p.name=n;var u=document.querySelector(d);u.insertBefore(p,u.firstChild),layerCount++,p.startUp()}function addFeatureToMap(e,a,t,o,l,r,n,i,s){console.log("adding feature: "+t),e.evaluate((function(e){var a=new google.maps.Data({fillOpacity:0,strokeColor:"#F00"});a.addGeoJson(e),a.setMap(map)}))}var featureViewObj={};function addFeatureView(e,a,t,o,l,r,n){ee.data.getFeatureViewTilesKey({assetId:e,visParams:a},(function(e){console.log(e);var a="https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/featureViews/"+e.token+"/tiles/";tileURLFunction=function(e,t){return a+t+"/"+e.x+"/"+e.y},addToMap(tileURLFunction,{layerType:"tileMapService"},t,o)}));var i=t.replaceAll(" ","-")+"-"+NEXT_LAYER_ID.toString();i=(i=(i=(i=(i=(i=i.replaceAll("/","-")).replaceAll("(","-")).replaceAll(")","-")).replaceAll("&","-")).replaceAll(",","-")).replaceAll(".","-"),NEXT_LAYER_ID++,featureViewObj[i]={name:t,assetId:e}}function mp(){this.addLayer=function(e,a,t,o,l,r,n,i,s){addToMap(e,a,t,o,l,r,n,i,s)},this.addSerializedLayer=function(e,a,t,o,l,r,n,i,s){a.serialized=!0,addToMap(e,a,t,o,l,r,n,i,s)},this.addSelectLayer=function(e,a,t,o,l,r,n,i,s){addSelectLayerToMap(e,a,t,o,l,r,n,i,s)},this.addTimeLapse=function(e,a,t,o,l,r,n,i,s){addTimeLapseToMap(e,a,t,o,l,r,n,i,s)},this.addSerializedTimeLapse=function(e,a,t,o,l,r,n,i,s){a.serialized=!0,addTimeLapseToMap(e,a,t,o,l,r,n,i,s)},this.addREST=function(e,a,t,o,l,r){addRESTToMap(e,a,t,o,l,r)},this.addExport=function(e,a,t,o,l,r,n,i){addExport(e,a,t,o,l,r,n,i)},this.addPlot=function(e){addPlot(e)},this.addFeatureView=function(e,a,t,o,l,r,n){addFeatureView(e,a,t,o,l,r,n)},this.centerObject=function(e){centerObject(e)}}var Map2=new mp;function sleep(e){for(var a=(new Date).getTime();(new Date).getTime()<a+e;);}function stringToBoolean(e){switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function setGEERunID(){geeRunID=(new Date).getTime()}function reRun(){showMessage("Loading Updated Layers",staticTemplates.loadingModal),setGEERunID(),clearSelectedAreas(),clearUploadedAreas(),layerChildID=0,geeTileLayersDownloading=0,updateGEETileLayersLoading(),stopTimeLapse(),queryObj={},areaChartCollections={},pixelChartCollections={},timeLapseObj={},intervalPeriod=666.6666666,timeLapseID=null,timeLapseFrame=0,cumulativeMode=!1,NEXT_LAYER_ID=1,clearSelectedAreas(),selectedFeaturesGeoJSON={},["layer-list","reference-layer-list","area-charting-select-layer-list","fhp-div","time-lapse-legend-list"].map((function(e){$("#"+e).empty(),$("#legend-"+e).empty()})),$("#export-list").empty(),Object.values(featureObj).map((function(e){e.setMap(null)})),featureObj={},map.overlayMapTypes.getArray().forEach((function(e,a){map.overlayMapTypes.setAt(a,null)})),refreshNumber++,exportImageDict={};try{clearDownloadDropdown()}catch(e){}google.maps.event.clearListeners(mapDiv,"click"),setTimeout((function(){run(),$(".modal").modal("hide"),$(".modal-backdrop").remove(),setupAreaLayerSelection(),addLabelOverlay()}),1500)}function getRandomInt(e,a){return Math.floor(Math.random()*(a-e+1))+e}function padLeft(e,a,t){return Array(a-String(e).length+1).join(t||"0")+e}function rgbToHex(e,a,t){return"#"+("00000"+(e<<16|a<<8|t).toString(16)).slice(-6)}function hexToRgb(e){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function offsetColor(e,a){return obj=hexToRgb(e),obj.r=(obj.r+a)%255,obj.g=(obj.g+a)%255,obj.b=(obj.b+a)%255,rgbToHex(obj.r,obj.g,obj.b)}function invertColor(e){if(0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6!==e.length)throw new Error("Invalid HEX color.");var a=(255-parseInt(e.slice(0,2),16)).toString(16),t=(255-parseInt(e.slice(2,4),16)).toString(16),o=(255-parseInt(e.slice(4,6),16)).toString(16);return"#"+padZero(a)+padZero(t)+padZero(o)}function padZero(e,a){return a=a||2,(new Array(a).join("0")+e).slice(-a)}function randomColor(){return rgbToHex(getRandomInt(100,200),getRandomInt(100,200),getRandomInt(100,255))}function getChartColor(){var e=chartColors[chartColorI%chartColors.length];return chartColorI++,e}function randomRGBColor(){return[getRandomInt(100,225),getRandomInt(100,225),getRandomInt(100,225)]}function randomColors(e){for(var a=[];e>0;)a.push(randomColor()),e-=1;return a}var colorList=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#808080","#ffffff","#000000"],colorMod=colorList.length;function getColor(){var e=colorList[colorMod%colorList.length];return colorMod++,e}function LightenDarkenColor(e,a){var t=!1;"#"==e[0]&&(e=e.slice(1),t=!0);var o=parseInt(e,16),l=(o>>16)+a;l>255?l=255:l<0&&(l=0);var r=(o>>8&255)+a;r>255?r=255:r<0&&(r=0);var n=(255&o)+a;return n>255?n=255:n<0&&(n=0),(t?"#":"")+(n|r<<8|l<<16).toString(16)}function startArea(){!1===polyOn&&(polyOn=!0),areaPolygonOptions.polyNumber=polyNumber,map.setOptions({draggableCursor:"crosshair"}),map.setOptions({disableDoubleClickZoom:!0}),areaPolygonObj[polyNumber]=new google.maps.Polyline(areaPolygonOptions),areaPolygonObj[polyNumber].setMap(map),updateArea=function(){var e,a,t=Object.keys(areaPolygonObj),o=0,l=0;t.map((function(t){var r=areaPolygonObj[t].getPath().getArray();if(r.length>0){clickCoords=clickLngLat,console.log(clickCoords),console.log(r),area=google.maps.geometry.spherical.computeArea(areaPolygonObj[t].getPath());var n=unitNameDict[metricOrImperialArea].area,i=unitMultiplierDict[metricOrImperialArea].area;area>0&&l++,(o+=area)>=1e3?(e=n[1],a=i[1]):(e=n[0],a=i[0]),console.log(n),console.log(i),console.log(area),console.log(o),console.log(e),console.log(a)}}));var r=o/9;o=(o*=a).formatNumber();var n="polygon";t.length>1&&(n="polygons");var i=l.toString()+" "+n+" <br>"+o+" "+e;"Ancillary"===mode&&(i+="<br>"+r.formatNumber()+" % pixel"),infowindow.setContent(i),infowindow.setPosition(clickCoords),infowindow.open(map),$(".gm-ui-hover-effect").hide()},startListening()}function setToPolygon(e){null!=e&&null!=e||(e=polyNumber),console.log("Setting "+e.toString()+" to polygon"),areaPolygonOptions.strokeColor=areaPolygonObj[e].strokeColor;var a=areaPolygonObj[e].getPath();areaPolygonObj[e].setMap(null),areaPolygonObj[e]=new google.maps.Polygon(areaPolygonOptions),areaPolygonObj[e].setPath(a),areaPolygonObj[e].setMap(map)}function setToPolyline(e){null!=e&&null!=e||(e=polyNumber),areaPolygonOptions.strokeColor=areaPolygonObj[e].strokeColor;var a=areaPolygonObj[polyNumber].getPath();areaPolygonObj[e].setMap(null),areaPolygonObj[e]=new google.maps.Polyline(areaPolygonOptions),areaPolygonObj[e].setPath(a),areaPolygonObj[e].setMap(map)}function startListening(){mapHammer=new Hammer(document.getElementById("map")),mapHammer.on("tap",(function(e){var a=areaPolygonObj[polyNumber].getPath(),t=e.center.x,o=e.center.y;clickLngLat=point2LatLng(t,o),a.push(clickLngLat),updateArea()})),mapHammer.on("doubletap",(function(){setToPolygon(),resetPolygon()})),google.maps.event.addListener(areaPolygonObj[polyNumber],"click",updateArea),google.maps.event.addListener(areaPolygonObj[polyNumber],"mouseup",updateArea),google.maps.event.addListener(areaPolygonObj[polyNumber],"dragend",updateArea),google.maps.event.addListener(areaPolygonObj[polyNumber].getPath(),"set_at",updateArea),window.addEventListener("keydown",resetPolys),window.addEventListener("keydown",deleteLastAreaVertex)}function resetPolys(e){void 0!==e&&"Delete"!==e.key&&"d"!==e.key&&"Backspace"!==e.key||(stopArea(),startArea())}function undoAreaMeasuring(){areaPolygonObj[polyNumber].getPath().length>0?(areaPolygonObj[polyNumber].getPath().pop(1),updateArea()):polyNumber>1&&(stopListening(),polyNumber-=1,setToPolyline(),startListening())}function undoDistanceMeasuring(){distancePolyline.getPath().pop(1),updateDistance()}function deleteLastAreaVertex(e){"z"==e.key&&e.ctrlKey&&undoAreaMeasuring()}function deleteLastDistanceVertex(e){"z"==e.key&&e.ctrlKey&&undoDistanceMeasuring()}function activatePoly(e){console.log(e.polyNumber)}function stopListening(){try{mapHammer.destroy(),google.maps.event.clearListeners(areaPolygonObj[polyNumber],"dblclick"),google.maps.event.clearListeners(areaPolygonObj[polyNumber],"click"),google.maps.event.clearListeners(mapDiv,"click"),google.maps.event.clearListeners(areaPolygonObj[polyNumber],"mouseup"),google.maps.event.clearListeners(areaPolygonObj[polyNumber],"dragend"),window.removeEventListener("keydown",resetPolys),window.removeEventListener("keydown",deleteLastAreaVertex)}catch(e){}}function clearPoly(e){areaPolygonObj[e].setMap(null),areaPolygonObj[e].setPath([]),updateArea(),google.maps.event.clearListeners(areaPolygonObj[e],"click")}function clearPolys(){stopListening(),Object.keys(areaPolygonObj).map((function(e){areaPolygonObj[e].setMap(null)})),areaPolygonObj={},polyNumber=1,polyOn=!1}function stopArea(){try{mapHammer.destroy()}catch(e){}map.setOptions({disableDoubleClickZoom:!0}),clearPolys(),infowindow.setMap(null),map.setOptions({draggableCursor:"hand"})}function resetPolygon(){stopListening();var e=Object.keys(areaPolygonObj),a=e[e.length-1];console.log("last key "+a.toString()),polyNumber=parseInt(a),polyNumber++,startArea()}function newPolygon(){stopArea()}function startDistance(){map.setOptions({draggableCursor:"crosshair"});try{distancePolyline.destroy()}catch(e){}distancePolyline=new google.maps.Polyline(distancePolylineOptions),distancePolyline.setMap(map),map.setOptions({disableDoubleClickZoom:!0}),google.maps.event.addListener(distancePolyline,"click",updateDistance),mapHammer=new Hammer(document.getElementById("map")),mapHammer.on("doubletap",resetPolyline),mapHammer.on("tap",(function(e){var a=e.center.x,t=e.center.y,o=distancePolyline.getPath();clickLngLat=point2LatLng(a,t),o.push(clickLngLat),updateDistance()})),google.maps.event.addListener(distancePolyline,"mouseup",updateDistance),google.maps.event.addListener(distancePolyline,"dragend",updateDistance),google.maps.event.addListener(distancePolyline.getPath(),"set_at",updateDistance),window.addEventListener("keydown",deleteLastDistanceVertex),window.addEventListener("keydown",resetPolyline)}function stopDistance(){try{window.removeEventListener("keydown",deleteLastDistanceVertex),window.removeEventListener("keydown",resetPolyline),mapHammer.destroy(),map.setOptions({disableDoubleClickZoom:!0}),google.maps.event.clearListeners(distancePolyline,"click"),google.maps.event.clearListeners(mapDiv,"click"),google.maps.event.clearListeners(distancePolyline,"mouseup"),google.maps.event.clearListeners(distancePolyline,"dragend"),null!=infowindow&&infowindow.setMap(null),distancePolyline.setMap(null),map.setOptions({draggableCursor:"hand"}),infowindow.setMap(null)}catch(e){}}function resetPolyline(e){void 0!==e&&void 0!==e.key&&"Delete"!=e.key&&"d"!=e.key&&"Backspace"!=e.key||(stopDistance(),startDistance())}function dropdownUpdateStudyArea(e){$("#summary-spinner").show(),resetStudyArea(e);var a=studyAreaDict[e].center;centerMap(a[1],a[0],a[2]),"Ancillary"===mode?run=runAncillary:"LT"===mode?run=runLT:"LCMS"===mode||"LCMS-pilot"===mode&&0==studyAreaDict[longStudyAreaName].isPilot?run=runGTAC:"LCMS-pilot"===mode?run=runUSFS:"STORM"===mode?run=runStorm:"LAMDA"===mode?run=runLAMDA:"lcms-base-learner"===mode?run=runBaseLearner:run="CONUS"===studyAreaName?runCONUS:runUSFS,reRun()}updateDistance=function(){distance=google.maps.geometry.spherical.computeLength(distancePolyline.getPath());distancePolyline.getPath().j;clickCoords=clickLngLat;var e=unitNameDict[metricOrImperialDistance].distance,a=unitMultiplierDict[metricOrImperialDistance].distance;if(distance>=1e3)var t=e[1],o=a[1];else t=e[0],o=a[0];if(distance*=o,distance>=0){var l=distance.formatNumber()+" "+t;infowindow.setContent(l),infowindow.setPosition(clickCoords),infowindow.open(map),$(".gm-ui-hover-effect").hide()}};var resetStudyArea=function(e){localStorage.setItem("cachedStudyAreaName",e),urlParams.studyAreaName=e,$("#studyAreaDropdown").val(e),$("#study-area-label").text(e),console.log("changing study area"),console.log(e),lowerThresholdDecline=studyAreaDict[e].lossThresh,lowerThresholdSlowLoss=void 0!==studyAreaDict[e].lossSlowThresh&&null!==studyAreaDict[e].lossSlowThresh?studyAreaDict[e].lossSlowThresh:lowerThresholdDecline,lowerThresholdFastLoss=void 0!==studyAreaDict[e].lossFastThresh&&null!==studyAreaDict[e].lossFastThresh?studyAreaDict[e].lossFastThresh:lowerThresholdDecline,upperThresholdDecline=1,upperThresholdSlowLoss=1,upperThresholdFastLoss=1,lowerThresholdRecovery=studyAreaDict[e].gainThresh,upperThresholdRecovery=1,startYear=studyAreaDict[e].startYear,endYear=studyAreaDict[e].endYear,setUpRangeSlider("lowerThresholdDecline",0,1,lowerThresholdDecline,.05,"decline-threshold-slider","null"),setUpRangeSlider("lowerThresholdRecovery",0,1,lowerThresholdRecovery,.05,"recovery-threshold-slider","null"),setUpRangeSlider("lowerThresholdSlowLoss",0,1,lowerThresholdSlowLoss,.05,"slow-loss-threshold-slider","null"),setUpRangeSlider("lowerThresholdFastLoss",0,1,lowerThresholdFastLoss,.05,"fast-loss-threshold-slider","null"),setUpDualRangeSlider("urlParams.startYear","urlParams.endYear",minYear,maxYear,urlParams.startYear,urlParams.endYear,1,"analysis-year-slider","analysis-year-slider-update","null");studyAreaDict[e].center;studyAreaName=studyAreaDict[e].name,"CONUS"===studyAreaName?run=runCONUS:"LCMS"===mode||"LCMS-pilot"===mode&&0==studyAreaDict[longStudyAreaName].isPilot?run=runGTAC:run=runUSFS,studyAreaDict[e].addFastSlow?$("#fast-slow-threshold-container").show():$("#fast-slow-threshold-container").hide(),studyAreaDict[e].addGainThresh?$("#recovery-threshold-slider-container").show():$("#recovery-threshold-slider-container").hide(),$("#export-crs").val(studyAreaDict[e].crs)};function initSearchBox(){var e=document.getElementById("pac-input"),a=new google.maps.places.SearchBox(e);map.addListener("bounds_changed",(function(){a.setBounds(map.getBounds())}));var t=[];a.addListener("places_changed",(function(){var e=a.getPlaces();if(0!=e.length){t.forEach((function(e){e.setMap(null)})),t=[];var o=new google.maps.LatLngBounds,l=[];e.forEach((function(e){if(e.geometry){l.push(e.formatted_address);var a={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};t.push(new google.maps.Marker({map:map,icon:a,title:e.name,position:e.geometry.location})),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)}else console.log("Returned place contains no geometry")}));var r={south:[-85,85],west:[-179,179],north:[-85,85],east:[-179,179]};o=o.toJSON(),Object.keys(o).map((function(e){var a=o[e],t=r[e][0],l=r[e][1];a<t&&(o[e]=t,showMessage("Search coords tip!","Search coords format is lat lng (e.g. 45 -111)")),a>l&&(o[e]=l,showMessage("Search coords tip!","Search coords format is lat lng (e.g. 45 -111)"))})),console.log(o),console.log(l.join(",")),ga("send","event","places-search",JSON.stringify(o),l.join(",")),map.fitBounds(o)}}))}var infoWindowXOffset=30;function getInfoWindow(e,a){return null!=e&&void 0!==e||(e=30),null!=a&&void 0!==a||(a=-30),new google.maps.InfoWindow({content:"",maxWidth:300,pixelOffset:new google.maps.Size(e,a,"rem","rem"),close:!1})}function trackView(){updateViewList&&(viewList=viewList.slice(0,viewIndex),viewList.push({lng:urlParams.lng,lat:urlParams.lat,zoom:urlParams.zoom}),viewIndex=viewList.length,checkViewIndex())}function checkViewIndex(){viewIndex<=1?(viewIndex=1,$("#back-view-button").prop("disabled",!0)):$("#back-view-button").prop("disabled",!1),viewIndex>=viewList.length?(viewIndex=viewList.length,$("#forward-view-button").prop("disabled",!0)):$("#forward-view-button").prop("disabled",!1)}function setView(e){updateViewList=!1,map.setCenter(e),map.setZoom(e.zoom)}function backView(){viewIndex--,checkViewIndex(),setView(viewList[viewIndex-1])}function forwardView(){viewIndex++,checkViewIndex(),setView(viewList[viewIndex-1])}var labelOverlayAdded=!1,labelsMapType;function addLabelOverlay(){map.overlayMapTypes.setAt(Object.keys(layerObj).length,labelsMapType),labelOverlayAdded=!0}function removeLabelOverlay(){map.overlayMapTypes.setAt(Object.keys(layerObj).length,null),labelOverlayAdded=!1}function toggleLabelOverlay(){labelOverlayAdded?removeLabelOverlay():addLabelOverlay()}var geeAuthenticated=!1;function initialize(){labelsMapType=new google.maps.StyledMapType([{elementType:"geometry.fill",stylers:[{visibility:"off"}]},{elementType:"geometry.stroke",stylers:[{weight:.01}]}]);(void 0===urlParams.mapTypeId||null===urlParams.mapTypeId&&-1===urlParams.mapTypeId.indexOf(urlParams.mapTypeIds))&&(urlParams.mapTypeId="hybrid");var e={center:null,zoom:null,minZoom:2,disableDefaultUI:!1,disableDoubleClickZoom:!0,mapTypeId:urlParams.mapTypeId,streetViewControl:!0,fullscreenControl:!1,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,mapTypeIds:["roadmap","satellite","hybrid","terrain"]},streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},scaleControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},tilt:0,controlSize:25,scaleControl:!0,clickableIcons:!1},a=new google.maps.LatLng(initialCenter[0],initialCenter[1]),t=initialZoomLevel,o=null;"undefined"!=typeof Storage&&(cachedStudyAreaName=localStorage.getItem("cachedStudyAreaName"),null!==urlParams.studyAreaName&&void 0!==urlParams.studyAreaName?cachedStudyAreaName=decodeURIComponent(urlParams.studyAreaName):null==cachedStudyAreaName&&(cachedStudyAreaName=defaultStudyArea),studyAreaName=studyAreaDict[cachedStudyAreaName].name,longStudyAreaName=cachedStudyAreaName,$("#study-area-label").text(longStudyAreaName),$("#study-area-label").fitText(1.8),1==studyAreaSpecificPage&&(cachedSettingskey=studyAreaName+"-settings"),o=JSON.parse(localStorage.getItem(cachedSettingskey)),layerObj=null),null!=o&&null!=o.center&&null!=o.zoom&&(a=o.center,t=o.zoom),null===layerObj&&(layerObj={}),void 0!==urlParams.lng&&null!==urlParams.lng&&void 0!==urlParams.lat&&null!==urlParams.lat?(print("Setting center from URL"),e.center={lng:parseFloat(urlParams.lng),lat:parseFloat(urlParams.lat)}):e.center=a,void 0!==urlParams.zoom&&null!==urlParams.zoom?(print("Setting zoom from URL"),e.zoom=parseInt(urlParams.zoom)):e.zoom=t,urlParams.lng=e.center.lng,urlParams.lat=e.center.lat,urlParams.zoom=e.zoom,map=new google.maps.Map(document.getElementById("map"),e);var l=map.getStreetView();function r(e,a,t,o){$(".legendDiv").css("bottom",$(".bottombar").height()),$("#current-mouse-position").html("Lng: "+e+", Lat: "+a+", "+o+"Zoom: "+t+", 1:"+zoomDict[t])}google.maps.event.addListener(l,"visible_changed",(function(){l.getVisible()?(console.log("street view in use"),$("#sidebar-left-container").hide(),$(".sidebar-toggler").hide(),$("#legendDiv").hide(),$("#bottombar").hide()):(console.log("street view not in use"),$("#sidebar-left-container").show(),$(".sidebar-toggler").show(),$("#legendDiv").show(),$("#bottombar").show())})),marker=new google.maps.Circle({center:{lat:45,lng:-111},radius:5}),infowindow=getInfoWindow(),queryGeoJSON=new google.maps.Data,queryGeoJSON.setMap(map),queryGeoJSON.setStyle({strokeColor:"#FF0"}),initSearchBox(),placeholderID=1;var n=0,i=0;function s(e){mouseLat=e.lat().toFixed(4).toString(),mouseLng=e.lng().toFixed(4).toString();try{ee.Image("USGS/SRTMGL1_003").reduceRegion(ee.Reducer.first(),ee.Geometry.Point([e.lng(),e.lat()])).get("elevation").evaluate((function(e){if(null!==e){var a=parseInt(3.28084*e);n="Elevation: "+e.toString()+"(m),"+a.toString()+"(ft),"}else{a="NA";n="Elevation: NA,"}r(mouseLng,mouseLat,t,n)}))}catch(e){r(mouseLng,mouseLat,t,n="Elevation: NA,")}}google.maps.event.addDomListener(mapDiv,"mousemove",(function(e){var a=point2LatLng(e.clientX,e.clientY),t=map.getZoom();mouseLat=a.lat().toFixed(4).toString(),mouseLng=a.lng().toFixed(4).toString();var o=(new Date).getTime();o-i>1e3?(s(a),i=o):r(mouseLng,mouseLat,t,n)})),google.maps.event.addListener(map,"maptypeid_changed",(function(){console.log("map type id changed"),urlParams.mapTypeId=map.mapTypeId,"satellite"===map.mapTypeId?removeLabelOverlay():addLabelOverlay()})),google.maps.event.addListener(map,"idle",(function(){t=map.getZoom();var e=map.getCenter(),a=e.lng(),o=e.lat();urlParams.lng=a,urlParams.lat=o,urlParams.zoom=t,trackView();var l=map.getBounds(),i=Object.keys(l),s=Object.keys(l[i[0]]),d=Object.keys(l[i[1]]);r(mouseLng,mouseLat,t,n);try{eeBoundsPoly=ee.Geometry.Rectangle([l[i[1]][s[0]],l[i[0]][d[0]],l[i[1]][s[1]],l[i[0]][d[1]]])}catch(e){}"undefined"!=typeof Storage&&(localStorage.setItem(cachedSettingskey,JSON.stringify({center:{lat:o,lng:a},zoom:t})),updateViewList=!0)})),ee.initialize(authProxyAPIURL,geeAPIURL,(function(){geeAuthenticated=!0,setTimeout((function(){"true"===localStorage["showIntroModal-"+mode]?$("#introModal").modal().show():showMessage("Loading",staticTemplates.loadingModal),$("#dontShowAgainCheckbox").change((function(){console.log(this.checked),localStorage["showIntroModal-"+mode]=!this.checked}))}),1e3),geeAuthenticated&&$("#main-container").append(staticTemplates.introModal[mode]),null===cachedStudyAreaName&&$("#study-area-label").text(defaultStudyArea),"Ancillary"===mode?run=runAncillary:"LCMS"===mode||"LCMS-pilot"===mode&&0==studyAreaDict[longStudyAreaName].isPilot?run=runGTAC:"LT"===mode?run=runLT:"MTBS"===mode?run=runMTBS:"TEST"===mode?run=runTest:"IDS"===mode?run=runIDS:"geeViz"===mode?run=runGeeViz:"LAMDA"===mode?run=runLAMDA:"STORM"===mode?run=runStorm:"lcms-base-learner"===mode?run=runBaseLearner:"CONUS"===studyAreaName?(longStudyAreaName=cachedStudyAreaName,run=runCONUS):null!=cachedStudyAreaName?(longStudyAreaName=cachedStudyAreaName,resetStudyArea(cachedStudyAreaName)):run=runUSFS,"LCMS"===mode&&(setupDropdownTreeDownloads(studyAreaName),populateLCMSDownloads()),setGEERunID(),setTimeout((function(){run(),setupAreaLayerSelection(),plotsOn&&(addPlotCollapse(),loadAllPlots()),"true"!==localStorage["showIntroModal-"+mode]?($(".modal").modal("hide"),$(".modal-backdrop").remove()):($("#intro-modal-loading-div").hide(),$("#summary-spinner").hide()),addLabelOverlay()}),1500)}),(function(e){"LCMS"===mode&&(setupDropdownTreeDownloads(studyAreaName),populateLCMSDownloads()),ga("send","event",mode+"-gee-auth-error","failure","failure"),showMessage("Map Loading Error",staticTemplates.authErrorMessage)}))}var mapWaitCount=0,mapWaitMax=20;function map_load(){mapWaitCount++,"undefined"!=typeof google?initialize():mapWaitCount<mapWaitMax?(console.log("Waiting attempt #"+mapWaitCount),setTimeout((function(){map_load()}),1e3)):mapWaitCount>=mapWaitMax&&console.log("Failed to load google api")}function sortFunction(e,a){return e[0]===a[0]?0:e[0]<a[0]?-1:1}function downloadURI(){if(null!=uri&&null!=uri){var e=document.createElement("a");e.download=uriName+".png",e.href=uri,e.click(),delete e}}function clearUploadedAreas(){void 0!==selectionTracker.uploadedLayerIndices&&null!==selectionTracker.uploadedLayerIndices||(selectionTracker.uploadedLayerIndices=[]),turnOffUploadedLayers(),$("#area-charting-shp-layer-list").empty()}function clearSelectedAreas(){selectionTracker.seletedFeatureLayerIndices.reverse().map((function(e){map.overlayMapTypes.setAt(e,null)})),setupAreaLayerSelection(),updateSelectedAreasNameList(),updateSelectedAreaArea()}function removeLastSelectArea(){selectionTracker.selectedFeatures=selectionTracker.selectedFeatures.slice(0,selectionTracker.selectedFeatures.length-1),updateSelectedAreasNameList(),updateSelectedAreaArea();var e=selectionTracker.seletedFeatureLayerIndices[selectionTracker.seletedFeatureLayerIndices.length-1];map.overlayMapTypes.setAt(e,null),selectionTracker.seletedFeatureLayerIndices=selectionTracker.seletedFeatureLayerIndices.slice(0,selectionTracker.seletedFeatureLayerIndices.length-1),$("#area-charting-selected-layer-list li:first-child").remove()}function updateSelectedAreasNameList(){var e=ee.FeatureCollection(selectionTracker.selectedFeatures).flatten();ee.List(ee.Dictionary(e.aggregate_histogram("name")).keys()).evaluate((function(e,a){void 0!==a?showMessage("Error",a):selectionTracker.selectedNames=e}))}function updateSelectedAreaArea(){var e=ee.FeatureCollection(selectionTracker.selectedFeatures).flatten();$("#select-features-area-spinner").show(),e.geometry().area(1e3).evaluate((function(e,a){void 0!==a?showMessage("Error",a):($("#selected-features-area").html((1e-4*e).formatNumber()+" hectares / "+(247105e-9*e).formatNumber()+" acres"),$("#select-features-area-spinner").hide())}))}function setupAreaLayerSelection(){google.maps.event.clearListeners(map,"click"),selectionTracker.selectedFeatures=[],selectionTracker.selectedNames=[],selectionTracker.seletedFeatureLayerIndices=[],$("#selected-features-list").empty(),$("#area-charting-selected-layer-list").empty(),map.addListener("click",(function(e){if(getActiveTools().indexOf("Area Tools-Select an Area on map")>-1){var a=[e.latLng.lng(),e.latLng.lat()];Object.keys(selectedFeaturesJSON).map((function(e){if(layerObj[selectedFeaturesJSON[e].id].visible){var t=selectedFeaturesJSON[e].eeObject.filterBounds(ee.Geometry.Point(a));ee.List(t.aggregate_array("name")).evaluate((function(a,o){if(void 0!==o)showMessage("Error",o);else{if(a.length>0){console.log("names "+a),0!==simplifyMaxError&&(t=ee.FeatureCollection(t.map((function(e){return ee.Feature(e).simplify(simplifyMaxError,crs)})))),selectionTracker.selectedFeatures.push(t);var l="Selected "+selectedFeaturesJSON[e].layerName+" "+a.join("-").replaceAll("&","-");0!==simplifyMaxError&&(l="Simplified ("+simplifyMaxError.toString()+"m)- "+l),Map2.addLayer(t,{layerType:"geeVectorImage",isSelectedLayer:!0},l,!0,null,null,null,"area-charting-selected-layer-list")}updateSelectedAreasNameList(),updateSelectedAreaArea()}}))}}))}}))}function updateUserDefinedAreaArea(){var e=0;Object.values(udpPolygonObj).map((function(a){e+=google.maps.geometry.spherical.computeArea(a.getPath())})),$("#user-defined-features-area").html((1e-4*e).formatNumber()+" hectares / "+(247105e-9*e).formatNumber()+" acres")}function turnOffVectorLayers(){$(".vector-layer-checkbox").trigger("turnOffAllVectors")}function turnOffLayers(){$(".layer-checkbox").trigger("turnOffAll")}function turnOffSelectLayers(){$(".vector-layer-checkbox").trigger("turnOffAllSelectLayers")}function turnOnSelectedLayers(){$(".vector-layer-checkbox").trigger("turnOnAllSelectedLayers")}function turnOffUploadedLayers(){$(".vector-layer-checkbox").trigger("turnOffAllUploadedLayers")}function turnOnUploadedLayers(){$(".vector-layer-checkbox").trigger("turnOnAllUploadedLayers")}function turnOffSelectGeoJSON(){}function turnOnSelectGeoJSON(){Object.keys(selectedFeaturesJSON).map((function(e){selectedFeaturesJSON[e].geoJSON.forEach((function(a){selectedFeaturesJSON[e].geoJSON.setMap(map)}))}))}function chartSelectedAreas(){var e=ee.FeatureCollection(selectionTracker.selectedFeatures).flatten();$("#summary-spinner").slideDown(),e.size().evaluate((function(a,t){if(void 0!==t)showMessage("Error",t);else if(0!==a){var o=$("#user-selected-area-name").val();""===o&&(o=selectionTracker.selectedNames.join(" - ")),makeAreaChart(e,o+" "+areaChartCollections[whichAreaChartCollection].label+" Summary",!0)}else showMessage("Error!","Please select area to chart. Turn on any of the layers and click on polygons to select them.  Then hit the <kbd>Chart Selected Areas</kbd> button."),$("#summary-spinner").slideUp()}))}function clearQueryGeoJSON(){queryGeoJSON.forEach((function(e){queryGeoJSON.remove(e)}))}map_load();var getQueryImages=function(e,a){var t=[e,a];$(".gm-ui-hover-effect").show(),$("#summary-spinner").slideDown(),infowindow.setMap(null),infowindow.setPosition({lng:e,lat:a});var o=" Queried Values for Lng "+e.toFixed(3)+" Lat "+a.toFixed(3),l=`<div>\n\t\t\t\t\t\t\t<h6 style = 'font-weight:bold;'>Queried values for<br>lng: ${e.toFixed(3).toString()} lat: ${a.toFixed(3).toString()}</h6>\n\t\t\t\t\t\t\t<li id = 'query-list-container'></li>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>`;infowindow.setOptions({maxWidth:350}),infowindow.setContent(l),infowindow.open(map);var r=1;function n(e,a,t){var l=t+"-container-"+r.toString();if(r++,$("#query-list-container").append("<table class=\"table table-hover bg-white\">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class = 'bg-black'><th></th></tr>\n\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>"),null==e)$("#query-list-container").append(`<table class="table table-hover bg-white">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody id = '${l}'></tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>`),$("#"+l).append(`<tr><th>${a.name}</th><th>NULL</th></tr>`);else if("geeImage"===a.type)if($("#query-list-container").append(`<table class="table table-hover bg-white">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody id = '${l}'></tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>`),1===Object.keys(e).length){var n=JSON.stringify(Object.values(e)[0]);null!==a.queryDict&&void 0!==a.queryDict&&(n=a.queryDict[parseInt(n)]),$("#"+l).append(`<tr><th>${a.name}</th><td>${n}</td></tr>`)}else $("#"+l).append(`<tr><th>${a.name}</th><th>Multi band</th></tr>`),Object.keys(e).map((function(a){try{var t=e[a];null!==t&&(t=t.toFixed(2).toString()),$("#"+l).append(`<tr><td>${a}</td><td>${t}</td></tr>`)}catch(e){$("#"+l).append(`<tr><td>${a}</td><td>${JSON.stringify(t)}</td></tr>`)}}));else if("geeImageCollection"===a.type){$("#query-list-container").append("<ul class = 'bg-black dropdown-divider'></ul>"),$("#query-list-container").append(`<ul class = 'm-0 p-0 bg-white' id = '${l}'></ul>`),infowindow.setOptions({maxWidth:1200}),infowindow.open(map);var i={plot_bgcolor:"#D6D1CA",paper_bgcolor:"#D6D1CA",font:{family:"Roboto Condensed, sans-serif"},margin:{l:50,r:10,b:80,t:80,pad:0},width:600,height:400,title:{text:a.name},xaxis:{tickangle:45,tickfont:{size:12},title:{text:e.xLabel}}},s={toImageButtonOptions:{filename:a.name+o,width:1200,height:800,format:"png"}};console.log(e.table),Plotly.newPlot(l,e.table,i,s)}else if("geeVectorImage"===a.type||"geeVector"===a.type){$("#query-list-container").append(`<table class="table table-hover bg-white">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody id = '${l}'></tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>`);var p=Object.keys(e);$("#"+l).append(`<tr><th>${a.name}</th><th>Attribute Table</th></tr>`),p.map((function(a){var t=e[a];$("#"+l).append(`<tr><th>${a}</th><td>${t}</td></tr>`)}))}c>=d&&(map.setOptions({draggableCursor:"help"}),map.setOptions({cursor:"help"}),$("#summary-spinner").slideUp())}var i=Object.keys(queryObj),s=[];i.map((function(e){queryObj[e].visible&&s.push(e)}));var d=s.length,c=0;0===d&&($("#summary-spinner").slideUp(),showMessage("No Layers to Query!","No visible layers to query. Please turn on any layers you would like to query")),clearQueryGeoJSON(),s.map((function(e){var a=queryObj[e];if(a.visible){var o=ee.Geometry.Point(t);if(ga("send","event",mode,"pixelQuery-"+a.type,a.name),"geeImage"===a.type)ee.Image(a.queryItem).reduceRegion(ee.Reducer.first(),o,30,"EPSG:5070",null,!0,1e13,1).evaluate((function(t){c++,n(t,a,e)}));else if("geeImageCollection"===a.type){var l=a.queryDateFormat;null==l&&(l="YYYY-MM-dd");var r=ee.ImageCollection(a.queryItem),i=o.buffer(plotRadius).bounds();r.first().propertyNames().getInfo().indexOf("system:time_start")>-1&&(r=r.sort("system:time_start").map((function(e){return e.set("system:time_start",e.date().format(l))}))),r.getRegion(i,null,"EPSG:5070",[30,0,-2361915,0,-30,3177735]).evaluate((function(t,o){console.log(t),null!=t?function(t){if(c++,t.length>1){var o=t[0];t=t.slice(1);var l,r,i=o.indexOf("time"),s=o.indexOf("id"),d=arrayColumn(t,s).filter(((e,a,t)=>t.indexOf(e)===a)).length;t.length>d&&(console.log("reducing number of inputs"),t=t.slice(0,d)),null!==t[0][i]?(l=arrayColumn(t,i),r="Time"):(l=arrayColumn(t,s),r="ID");var p=o.slice(4);yColumns=t.map((function(e){return e.slice(4)}));var u=p.map((function(e,a){return{x:l,y:arrayColumn(yColumns,a),type:"scatter",name:e}}));n({table:u,xLabel:r},a,e)}else console.log("no data"),n(null,a,e)}(t):(c++,n(null,a,e)),null!=o&&showMessage("Error",o)}))}else if("geeVectorImage"===a.type||"geeVector"===a.type){try{var s=a.queryItem.filterBounds(o)}catch(e){s=ee.FeatureCollection([a.queryItem]).filterBounds(o)}s.evaluate((function(t){c++,queryGeoJSON.addGeoJson(t);var o=t.features;0===o.length?n(null,a,e):o.map((function(t){n(t.properties,a,e)}))}))}}}))},fsb,udp;function populateChartDropdown(id,collectionDict,whichChartCollectionVar){$("#"+id).empty();var keys=Object.keys(collectionDict);eval(whichChartCollectionVar+" = keys[0]"),keys.length>1?(Object.keys(collectionDict).map((function(e){addDropdownItem(id,collectionDict[e].label,e,collectionDict[e].tooltip)})),$("#"+id+"-container").show()):$("#"+id+"-container").hide()}function populateAreaChartDropdown(){populateChartDropdown("area-collection-dropdown",areaChartCollections,"whichAreaChartCollection")}function populatePixelChartDropdown(){populateChartDropdown("pixel-collection-dropdown",pixelChartCollections,"whichPixelChartCollection")}function setupFSB(){$("#forestBoundaries").empty(),$("#forestBoundaries").hide(),$("#select-area-spinner").show();var e=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/FS_Boundaries"),a=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/NPS_Boundaries");if(e=e.map((function(e){return e.set("label",e.get("FORESTNAME"))})),a=a.map((function(e){return e.set("label",ee.String(e.get("PARKNAME")).cat(" National Park"))})),fsb=e.merge(a),fieldName="label",void 0!==areaChartCollections[whichAreaChartCollection]){fsb=fsb.filterBounds(areaChartCollections[whichAreaChartCollection].collection.geometry());var t=ee.List(ee.Dictionary(fsb.aggregate_histogram(fieldName)).keys());ee.Dictionary.fromLists(t,t).evaluate((function(e){var a=$("#forestBoundaries");a.append($("<option></option>").val(undefined).html("Choose an area")),$.each(e,(function(e,t){a.append($("<option></option>").val(e).html(t))})),$("#select-area-spinner").hide(),$("#forestBoundaries").show()}))}}var udpList=[],whichAreaDrawingMethod;function areaChartingTabSelect(e){stopAreaCharting(),stopCharting(),whichAreaDrawingMethod=e,console.log(e),"#user-defined"===e?startUserDefinedAreaCharting():"#shp-defined"===e?startShpDefinedCharting():"#pre-defined"===e?$("#pre-defined").slideDown():"#user-selected"===e&&(map.setOptions({draggableCursor:"pointer"}),map.setOptions({cursor:"pointer"}))}function restartUserDefinedAreaCarting(e){void 0!==e&&"Delete"!=e.key&&"d"!=e.key&&"Backspace"!=e.key||(areaChartingTabSelect(whichAreaDrawingMethod),updateUserDefinedAreaArea())}function undoUserDefinedAreaCharting(e){if(void 0===e||"z"==e.key&&e.ctrlKey){try{udpPolygonObj[udpPolygonNumber].getPath().pop(1)}catch(e){udpPolygonNumber--,udpPolygonNumber<1&&(udpPolygonNumber=1,showMessage("Error!","No more vertices to undo")),udpPolygonObj[udpPolygonNumber].getPath().pop(1)}updateUserDefinedAreaArea()}}function startUserDefinedAreaCharting(){console.log("start clicking"),map.setOptions({draggableCursor:"crosshair"}),map.setOptions({disableDoubleClickZoom:!0}),google.maps.event.clearListeners(mapDiv,"dblclick"),google.maps.event.clearListeners(mapDiv,"click"),window.addEventListener("keydown",restartUserDefinedAreaCarting),window.addEventListener("keydown",undoUserDefinedAreaCharting);try{udp.setMap(null)}catch(e){}udpPolygonObj[udpPolygonNumber]=new google.maps.Polyline(udpOptions),udpPolygonObj[udpPolygonNumber].setMap(map),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"click",updateUserDefinedAreaArea),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"mouseup",updateUserDefinedAreaArea),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"dragend",updateUserDefinedAreaArea),mapHammer=new Hammer(document.getElementById("map")),mapHammer.on("tap",(function(e){var a=udpPolygonObj[udpPolygonNumber].getPath(),t=e.center.x,o=e.center.y;clickLngLat=point2LatLng(t,o),a.push(clickLngLat),updateUserDefinedAreaArea()})),mapHammer.on("doubletap",(function(){var e=udpPolygonObj[udpPolygonNumber].getPath();udpPolygonObj[udpPolygonNumber].setMap(null),udpPolygonObj[udpPolygonNumber]=new google.maps.Polygon(udpOptions),udpPolygonObj[udpPolygonNumber].setPath(e),udpPolygonObj[udpPolygonNumber].setMap(map),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"click",updateUserDefinedAreaArea),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"mouseup",updateUserDefinedAreaArea),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"dragend",updateUserDefinedAreaArea),udpPolygonNumber++,udpPolygonObj[udpPolygonNumber]=new google.maps.Polyline(udpOptions),udpPolygonObj[udpPolygonNumber].setMap(map),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"click",updateUserDefinedAreaArea),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"mouseup",updateUserDefinedAreaArea),google.maps.event.addListener(udpPolygonObj[udpPolygonNumber],"dragend",updateUserDefinedAreaArea),updateUserDefinedAreaArea()}))}function chartUserDefinedArea(){try{var e=[],a=!1;if(Object.values(udpPolygonObj).map((function(t){var o=t.getPath().getArray(),l=[];o.map((function(e){l.push([e.lng(),e.lat()])})),l.length>2&&(e.push(ee.Feature(ee.Geometry.Polygon(l))),a=!0)})),a){e=ee.FeatureCollection(e);var t=$("#user-defined-area-name").val();""===t&&(t="User Defined Area "+userDefinedI.toString(),userDefinedI++),t+=" "+areaChartCollections[whichAreaChartCollection].label+" Summary",$("#summary-spinner").slideDown(),makeAreaChart(e,t,!0)}else showMessage("Error!","Please draw polygons on map. Double-click to finish drawing polygon. Once all polygons have been drawn, click the <kbd>Chart Selected Areas</kbd> button to create chart.")}catch(e){showMessage("Error",e)}}function chartChosenArea(){$("#summary-spinner").slideDown();try{udp.setMap(null)}catch(e){}map.setOptions({draggableCursor:"progress"}),map.setOptions({cursor:"progress"});var e=$("#forestBoundaries").val(),a=e+" "+areaChartCollections[whichAreaChartCollection].label+" Summary";makeAreaChart(fsb.filter(ee.Filter.eq(fieldName,e)),a)}function getAreaSummaryTable(e,a,t,o,l,r,n,i){null==t&&(t="year"),null==o&&(o=100),null==l&&(l="YYYY"),null==r&&(r="EPSG:5070"),"year"===t&&(e=e.map((function(e){return e.set("year",e.date().format(l))})));var s=ee.Image(e.first()).bandNames();return e.toList(1e4,0).map((function(e){var l,d=(e=ee.Image(e)).reduceRegion(ee.Reducer.fixedHistogram(0,2,2),a,i,r,n,!0,1e13,4),c=e.get(t);return d=ee.Dictionary(d),values=s.map((function(e){var a=d.get(e);return a=ee.Array(a).slice(1,1,2).project([0]),l=ee.Number(a.reduce(ee.Reducer.sum(),[0]).get([0])),(a=ee.Number(a.toList().get(1))).divide(l).multiply(o)})),values=ee.List([c]).cat(values),values}))}function expandChart(){console.log("expanding"),$("#curve_chart_big").slideDown(),$("#curve_chart_big_modal").modal(),closeChart()}var currentChartID=0;function cancelMakeAreaChart(){currentChartID++,$("#summary-spinner").slideUp()}function makeAreaChart(e,a,t){var o=++currentChartID;areaGeoJson=null,console.log("making chart"),null==t&&(t=!1),areaChartingCount++;randomColor().slice(1,7);centerObject(e=e.set("source","LCMS_data_explorer")),e=e.geometry();var l=areaChartCollections[whichAreaChartCollection].collection,r=areaChartCollections[whichAreaChartCollection].xAxisProperty,n=areaChartCollections[whichAreaChartCollection].xAxisLabel,i=areaChartCollections[whichAreaChartCollection].yAxisLabel,s=areaChartCollections[whichAreaChartCollection].dateFormat;null!==r&&null!=r||(r="year"),null!==n&&null!=n||(n=null),null!==i&&null!=i||(i="% Area"),i=areaChartFormatDict[areaChartFormat].label;var d=e.area(1e3);["Acres","Hectares"].indexOf(areaChartFormat)>-1?multiplier=d.multiply(areaChartFormatDict[areaChartFormat].mult):multiplier=areaChartFormatDict[areaChartFormat].mult;var c=ee.Image(l.first()).bandNames().getInfo();(c=c.map((function(e){return e.replaceAll("_"," ")+" "+areaChartFormatDict[areaChartFormat].label}))).unshift(r);var p=getAreaSummaryTable(l,e,r,multiplier,s,crs,transform,scale),u=0,m=new Date;!function t(){console.log("Evaluating area chart tables"),p.evaluate((function(l,r){print(u),print(l),print(r),print(areaChartingCount);var s=new Date-m;if(console.log("dt: "+s.toString()),void 0!==r&&u<60&&currentChartID===o&&s<1e4)t();else if(void 0===r&&currentChartID===o){l.unshift(c),$("#summary-spinner").slideUp();var d=areaChartCollections[whichAreaChartCollection].stacked,p=areaChartCollections[whichAreaChartCollection].steppedLine,g=areaChartCollections[whichAreaChartCollection].colors,h=areaChartCollections[whichAreaChartCollection].chartType,y=areaChartCollections[whichAreaChartCollection].fieldsHidden;null==h&&(h="line"),ga("send","event",mode,"areaChart",whichAreaChartCollection),addChartJS(l,a,h,d,p,g,n,i,y),e.evaluate((function(e,t){areaGeoJson=e,areaGeoJson[a]=l,void 0===t&&null!=areaGeoJson?$("#chart-download-dropdown").append(`<a class="dropdown-item" href="#" onclick = "exportJSON('${a}.geojson', areaGeoJson)">geoJSON</a>`):showMessage("Error","Could not convert summary area to geoJSON "+t)})),areaChartingCount--}else void 0!==r&&($("#summary-spinner").slideUp(),(r.indexOf("Dictionary.toArray: Unable to convert dictionary to array")>-1||r.indexOf("Array: Parameter 'values' is required.")>-1)&&(r="Most likely selected area does not overlap with selected LCMS study area<br>Please select area that overlaps with products<br>Raw Error Message:<br>"+r),showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Error! Try again',r));u++}))}()}function fixGeoJSONZ(e){return console.log("getting rid of z"),e.features=e.features.map((function(e){return-1===e.geometry.type.indexOf("Multi")?e.geometry.coordinates=e.geometry.coordinates.map((function(e){return e.map((function(e){return e.slice(0,2)}))})):e.geometry.coordinates=e.geometry.coordinates.map((function(e){return e.map((function(e){return e.map((function(e){return e.slice(0,2)}))}))})),e})),console.log(e),e}function runShpDefinedCharting(){if(clearUploadedAreas(),jQuery("#areaUpload")[0].files.length>0){try{udp.setMap(null)}catch(e){console.log(e)}$("#summary-spinner").slideDown();var e=jQuery("#areaUpload")[0].files[0].name.split(".")[0],a=" "+areaChartCollections[whichAreaChartCollection].label+" Summary";-1===e.indexOf(a)&&(e+=a),map.setOptions({draggableCursor:"progress"}),map.setOptions({cursor:"progress"}),convertToGeoJSON("areaUpload").done((function(a){console.log("successfully converted to JSON"),console.log(a),console.log("compressing geoJSON");var t=compressGeoJSON(a,uploadReductionFactor);console.log(t);try{var o=ee.FeatureCollection(t.features.map((function(e){return ee.Feature(e).dissolve(100,ee.Projection("EPSG:4326"))})));console.log("N features to summarize ");var l=o.size().getInfo();if(console.log(l),0==l)return showMessage("No Features Found","Found "+l.toString()+" in provided file. Please select a file with features."),void $("#summary-spinner").hide()}catch(e){if(e=e.toString(),console.log("Error"),console.log(e),!(e.indexOf("Error: Invalid GeoJSON geometry:")>-1))return e.indexOf("413")>-1?showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Error Ingesting Study Area!','Provided vector has too many vertices.<br>Try increasing the "Vertex Reduction Factor" slider by one and then rerunning.'):showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Error Ingesting Study Area!',e),void $("#summary-spinner").hide();try{o=ee.FeatureCollection(fixGeoJSONZ(t).features.map((function(e){return ee.Feature(e).dissolve(100,ee.Projection("EPSG:4326"))})));console.log("N features to summarize "),console.log(o.size().getInfo())}catch(e){return e=e.toString(),console.log(e),e.indexOf("413")>-1?showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Error Ingesting Study Area!','Provided vector has too many vertices.<br>Try increasing the "Vertex Reduction Factor" slider by one and then rerunning.'):showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Error Ingesting Study Area!',e),void $("#summary-spinner").hide()}}Map2.addLayer(o,{isUploadedLayer:!0},e,!0,null,null,e+" for area summarizing","area-charting-shp-layer-list"),makeAreaChart(o,e)}))}else showMessage("No Summary Area Selected","Please select a .zip shapefile or a .geojson file to summarize across")}function startShpDefinedCharting(){turnOnUploadedLayers(),void 0!==selectionTracker.uploadedLayerIndices&&null!==selectionTracker.uploadedLayerIndices||(selectionTracker.uploadedLayerIndices=[])}function stopAreaCharting(){window.removeEventListener("keydown",restartUserDefinedAreaCarting),window.removeEventListener("keydown",undoUserDefinedAreaCharting),console.log("stopping area charting");try{Object.keys(udpPolygonObj).map((function(e){udpPolygonObj[e].setMap(null)})),udpPolygonObj={},udpPolygonNumber=1,updateUserDefinedAreaArea()}catch(e){}$("#areaUpload").unbind("change"),$("#summary-spinner").slideUp()}function startQuery(){areaGeoJson=null;try{udp.setMap(null)}catch(e){console.log(e)}google.maps.event.clearListeners(mapDiv,"dblclick"),google.maps.event.clearListeners(mapDiv,"click"),map.setOptions({draggableCursor:"help"}),map.setOptions({cursor:"help"}),mapHammer=new Hammer(document.getElementById("map")),mapHammer.on("doubletap",(function(e){$("#summary-spinner").slideDown(),map.setOptions({draggableCursor:"progress"}),map.setOptions({cursor:"progress"}),print("Map was double clicked");var a=e.center.x,t=e.center.y;center=point2LatLng(a,t),addClickMarker(ee.Geometry.Point([center.lng(),center.lat()]).buffer(plotRadius).bounds()),marker.setMap(map),getQueryImages(center.lng(),center.lat())}))}function stopQuery(){print("stopping");try{mapHammer.destroy(),map.setOptions({draggableCursor:"hand"}),map.setOptions({cursor:"hand"}),google.maps.event.clearListeners(mapDiv,"dblclick"),map.setOptions({cursor:"hand"}),infowindow.setMap(null),marker.setMap(null)}catch(e){}}function getImageCollectionValuesForCharting(e){var a=ee.ImageCollection(chartCollection.filterBounds(e));try{var t=a.getRegion(e,null,"EPSG:5070",[30,0,-2361915,0,-30,3177735]).evaluate();return print(t),t}catch(e){showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Charting error',e.message)}}function getDataTable(e){var a=getImageCollectionValuesForCharting(e);if(globalChartValues=a,chartIncludeDate)var t=3;else t=4;var o=a[0].slice(t);print(a=a.slice(1).map((function(e){return e.slice(t)})).sort(sortFunction)),chartIncludeDate&&(a=a.map((function(e){var a=[new Date(e[0])];return e.slice(1).map((function(e){a.push(e)})),a})));var l=[o];return a.map((function(e){l.push(e)})),l}function downloadChartJS(e,a){var t=document.createElement("a");t.download=a,t.href=e.toBase64Image(),t.click(),delete t,ga("send","event",mode,getActiveTools()[0]+"-chartDownload","png")}Date.prototype.yyyymmdd=function(){var e=this.getMonth()+1,a=this.getDate();return[this.getFullYear(),!e[1]&&"0",e,!a[1]&&"0",a].join("")},Chart.pluginService.register({beforeDraw:function(e,a){if(e.config.options.chartArea&&e.config.options.chartArea.backgroundColor){Chart.helpers;var t=e.chart.ctx,o=e.chartArea;t.save(),t.fillStyle=e.config.options.chartArea.backgroundColor,t.fillRect(o.left-90,o.top-40,o.right-o.left+190,o.bottom-o.top+350),t.restore()}}});var dataToTable=function(e){var a="<table>";a+='<thead><tr><th style="width:120px;">#</th>';var t=0;return jQuery.each(e.datasets,(function(e,o){a+='<th style="background-color:'+o.fillColor+';">'+o.label+"</th>",t+=1})),a+="</tr></thead>",jQuery.each(e.labels,(function(o,l){for(a+="<tr><td>"+l+"</td>",i=0;i<t;i++)a+='<td style="background-color:'+e.datasets[i].fillColor+';">'+("0"===e.datasets[i].data[o]?"-":e.datasets[i].data[o])+"</td>";a+="</tr>"})),a+="</tr><tbody></table>"},chartJSChart,chartType,chartTableDict;function addChartJS(e,a,t,o,l,r,n,i,s){var d=!0,c=!0;null==s&&(s=null),null==n&&(n="",d=!1),null==i&&(i="",c=!1),null==r&&(r=chartColors),null==t&&(t="line"),null==o&&(o=!1),void 0!==l&&null!=l||(l=!1),console.log("starting convert to table"),dataTable=dataTableNumbersToNames(e),console.log("finished convert to table"),$(document).height()/$(document).width()>1?(canvasHeight="90%",canvasWidth="100%"):(canvasHeight="50%",canvasWidth="100%"),clearModal("chart-modal"),$("#chart-modal-body").append("<div id = 'chart-modal-graph-table-container' class = 'flexcroll chart-table-graph-container'></div>"),$("#chart-modal-graph-table-container").append(`<div id = 'chart-modal-graph-container' class = 'pb-2'>\n    \t\t\t\t\t\t\t\t\t\t\t\t\t<canvas id="chart-canvas" width="${canvasWidth}" height = "${canvasHeight}" ></canvas>\n    \t\t\t\t\t\t\t\t\t\t\t\t</div>`),$("#chart-modal-graph-table-container").append(`<div id="chart-table" style = 'display:none;' width="${canvasWidth}" height = "${canvasHeight}" ></div>`);var p=arrayColumn(e.slice(1),0),u=range(1,e[1].length);console.log("starting to convert to chart");var m=u.map((function(a){var t=!1;null!==s&&(t=s[a-1]);var n=arrayColumn(e,a),i=n[0],d=n.slice(1);d=d.map((function(e){var a;try{a=e.toFixed(6)}catch(t){a=e}return a}));var c=r[(a-1)%r.length];-1===c.indexOf("#")&&(c="#"+c);var p={label:i,pointStyle:"circle",pointRadius:1,data:d,fill:!1,borderColor:c,lineTension:0,borderWidth:2,steppedLine:l,showLine:!0,spanGaps:!0,hidden:t};return o&&(p.fill=!0,p.backgroundColor=c),p}));console.log("finished to convert to chart"),chartColorI=0;try{chartJSChart.destroy()}catch(e){}chartJSChart=new Chart($("#chart-canvas"),{type:t,data:{labels:p,datasets:m},options:{title:{display:!0,position:"top",text:a.replaceAll("_"," "),fontSize:16},legend:{display:!0,position:"bottom",labels:{boxWidth:5,usePointStyle:!0}},chartArea:{backgroundColor:"#DDD"},scales:{yAxes:[{stacked:o,scaleLabel:{display:c,labelString:i}}],xAxes:[{stacked:o,scaleLabel:{display:d,labelString:n},maxBarThickness:100}]}}}),$("#chart-download-dropdown").empty(),$("#chart-modal-footer").append(`<div class="dropdown">\n\t\t\t\t\t\t\t\t\t\t  <div class=" dropdown-toggle"  id="chartDownloadDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t\t    Download\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t  <div id = 'chart-download-dropdown' class="dropdown-menu px-2" aria-labelledby="chartDownloadDropdown">\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "downloadChartJS(chartJSChart,'${a}.png')">PNG</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "exportToCsv('${a}.csv', dataTable)">CSV</a>\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="dropdown">\n\t\t\t\t\t\t\t\t\t\t  <div class=" dropdown-toggle"  id="chartTypeDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t\t    Chart Type\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t  <div id = 'chart-type-dropdown' class="dropdown-menu px-2" aria-labelledby="chartTypeDropdown">\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('line',false,${l});">Line</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('line',true,${l});">Stacked Line</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('bar',false,${l});">Bar</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('bar',true,${l});">Stacked Bar</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('table')">Table</a>\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t`);var g=htmlTable(dataTable);$("#chart-table").append(g),toggleChartTable(localStorage.tableOrChart),$("#chart-modal").modal()}function toggleChartTable(e){"table"===e?($("#chart-modal-graph-container").hide(),$("#chart-table").show(),localStorage.tableOrChart="table"):"chart"===e?($("#chart-modal-graph-container").show(),$("#chart-table").hide(),localStorage.tableOrChart="chart"):($("#chart-modal-graph-container").show(),$("#chart-table").show(),localStorage.tableOrChart="both")}function change(e,a,t){void 0!==a&&null!=a||(a=!1),void 0!==t&&null!=t||(t=!1);var o=chartJSChart.config;chartJSChart.destroy(),o.type=e;var l,r=o.options.scales;(r.xAxes[0].stacked=a,r.yAxes[0].stacked=a,o.options.scales=r,a)?(l=(l=o.data.datasets).map((function(e){return e.fill=!0,e.backgroundColor=e.borderColor,e.steppedLine=t,e})),o.data.datasets=l):(l=(l=o.data.datasets).map((function(e){return e.fill=!1,e.steppedLine=!1,e})),o.data.datasets=l);chartJSChart=new Chart($("#chart-canvas"),o)}void 0!==localStorage.tableOrChart&&null!==localStorage.tableOrChart||(localStorage.tableOrChart="chart"),addModal("main-container","chart-modal");var testTable=JSON.parse('[["id","longitude","latitude","time","Raw NDVI","LANDTRENDR Fitted NDVI","Land Cover Class","Land Use Class","Loss Probability","Gain Probability"],["Landsat_Fmask_allL7_SR_medoid_1984_1986_190_250_1_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1985",-109.74183328494144,42.94571387213776,486432000000,0.6041558441558442,0.61475,0.699999988079071,0.30000001192092896,0,0],["Landsat_Fmask_allL7_SR_medoid_1985_1987_190_250_2_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1986",-109.74183328494144,42.94571387213776,517968000000,0.6490280777537797,0.6148,0.699999988079071,0.30000001192092896,0,0],["Landsat_Fmask_allL7_SR_medoid_1986_1988_190_250_3_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1987",-109.74183328494144,42.94571387213776,549504000000,0.6315240083507307,0.61485,0.699999988079071,0.30000001192092896,0,0],["Landsat_Fmask_allL7_SR_medoid_1987_1989_190_250_4_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1988",-109.74183328494144,42.94571387213776,581126400000,0.6315240083507307,0.6149,0.699999988079071,0.30000001192092896,0,0],["Landsat_Fmask_allL7_SR_medoid_1988_1990_190_250_5_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1989",-109.74183328494144,42.94571387213776,612662400000,0.6353887399463807,0.61495,0.699999988079071,0.30000001192092896,0,0],["Landsat_Fmask_allL7_SR_medoid_1989_1991_190_250_6_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1990",-109.74183328494144,42.94571387213776,644198400000,0.6176795580110498,0.615,0.699999988079071,0.30000001192092896,0,0],["Landsat_Fmask_allL7_SR_medoid_1990_1992_190_250_7_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1991",-109.74183328494144,42.94571387213776,675734400000,0.5684689236988377,0.61505,0.699999988079071,0.30000001192092896,0,0],["Landsat_Fmask_allL7_SR_medoid_1991_1993_190_250_8_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1992",-109.74183328494144,42.94571387213776,707356800000,0.5684689236988377,0.6151,0.699999988079071,0.30000001192092896,0.019999999552965164,0],["Landsat_Fmask_allL7_SR_medoid_1992_1994_190_250_9_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1993",-109.74183328494144,42.94571387213776,738892800000,0.6082029141932002,0.61515,0.699999988079071,0.30000001192092896,0.019999999552965164,0],["Landsat_Fmask_allL7_SR_medoid_1993_1995_190_250_10_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1994",-109.74183328494144,42.94571387213776,770428800000,0.5819209039548022,0.6152000000000001,0.699999988079071,0.30000001192092896,0.05000000074505806,0],["Landsat_Fmask_allL7_SR_medoid_1994_1996_190_250_11_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1995",-109.74183328494144,42.94571387213776,801964800000,0.6067796610169491,0.6152500000000001,0.699999988079071,0.30000001192092896,0.05000000074505806,0],["Landsat_Fmask_allL7_SR_medoid_1995_1997_190_250_12_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1996",-109.74183328494144,42.94571387213776,833587200000,0.6067796610169491,0.6153000000000001,0.699999988079071,0.30000001192092896,0.019999999552965164,0],["Landsat_Fmask_allL7_SR_medoid_1996_1998_190_250_13_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1997",-109.74183328494144,42.94571387213776,865123200000,0.6450617283950617,0.6153500000000001,0.699999988079071,0.30000001192092896,0.03999999910593033,0.009999999776482582],["Landsat_Fmask_allL7_SR_medoid_1997_1999_190_250_14_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1998",-109.74183328494144,42.94571387213776,896659200000,0.6450617283950617,0.6154000000000001,0.699999988079071,0.30000001192092896,0.019999999552965164,0],["Landsat_Fmask_allL7_SR_medoid_1998_2000_190_250_15_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-1999",-109.74183328494144,42.94571387213776,928195200000,0.6054347826086957,0.61545,0.699999988079071,0.30000001192092896,0.07999999821186066,0],["Landsat_Fmask_allL7_SR_medoid_1999_2001_190_250_16_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2000",-109.74183328494144,42.94571387213776,959817600000,0.6196961760083813,0.6155,0.699999988079071,0.30000001192092896,0.10999999940395355,0],["Landsat_Fmask_allL7_SR_medoid_2000_2002_190_250_17_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2001",-109.74183328494144,42.94571387213776,991353600000,0.625,0.61555,0.699999988079071,0.30000001192092896,0.20999999344348907,0],["Landsat_Fmask_allL7_SR_medoid_2001_2003_190_250_18_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2002",-109.74183328494144,42.94571387213776,1022889600000,0.625,0.6156,0.699999988079071,0.30000001192092896,0.3700000047683716,0],["Landsat_Fmask_allL7_SR_medoid_2002_2004_190_250_19_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2003",-109.74183328494144,42.94571387213776,1054425600000,0.5976331360946746,0.61565,0.699999988079071,0.30000001192092896,0.30000001192092896,0],["Landsat_Fmask_allL7_SR_medoid_2003_2005_190_250_20_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2004",-109.74183328494144,42.94571387213776,1086048000000,0.6184004181913225,0.6157,0.699999988079071,0.30000001192092896,0.23999999463558197,0],["Landsat_Fmask_allL7_SR_medoid_2004_2006_190_250_21_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2005",-109.74183328494144,42.94571387213776,1117584000000,0.6023643202579259,0.6050375,0.699999988079071,0.30000001192092896,0.3799999952316284,0],["Landsat_Fmask_allL7_SR_medoid_2005_2007_190_250_22_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2006",-109.74183328494144,42.94571387213776,1149120000000,0.5668202764976958,0.594375,0.699999988079071,0.30000001192092896,0.3100000023841858,0],["Landsat_Fmask_allL7_SR_medoid_2006_2008_190_250_23_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2007",-109.74183328494144,42.94571387213776,1180656000000,0.5428024868483978,0.5837125000000001,0.699999988079071,0.30000001192092896,0.7099999785423279,0],["Landsat_Fmask_allL7_SR_medoid_2007_2009_190_250_24_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2008",-109.74183328494144,42.94571387213776,1212278400000,0.6413103831204887,0.5730500000000001,0.699999988079071,0.30000001192092896,0.5099999904632568,0],["Landsat_Fmask_allL7_SR_medoid_2008_2010_190_250_25_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2009",-109.74183328494144,42.94571387213776,1243814400000,0.5547407019381875,0.5623875,0.699999988079071,0.30000001192092896,0.8799999952316284,0],["Landsat_Fmask_allL7_SR_medoid_2009_2011_190_250_26_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2010",-109.74183328494144,42.94571387213776,1275350400000,0.5532495903877663,0.551725,0.699999988079071,0.30000001192092896,0.550000011920929,0],["Landsat_Fmask_allL7_SR_medoid_2010_2012_190_250_27_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2011",-109.74183328494144,42.94571387213776,1306886400000,0.5532495903877663,0.5410625,0.699999988079071,0.30000001192092896,0.5199999809265137,0],["Landsat_Fmask_allL7_SR_medoid_2011_2013_190_250_28_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2012",-109.74183328494144,42.94571387213776,1338508800000,0.5121196493037647,0.5304,0.699999988079071,0.30000001192092896,0.7799999713897705,0.019999999552965164],["Landsat_Fmask_allL7_SR_medoid_2012_2014_190_250_29_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2013",-109.74183328494144,42.94571387213776,1370044800000,0.5759870200108166,0.5492714285714286,0.699999988079071,0.30000001192092896,0.10999999940395355,0.15000000596046448],["Landsat_Fmask_allL7_SR_medoid_2013_2015_190_250_30_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2014",-109.74183328494144,42.94571387213776,1401580800000,0.5555555555555556,0.5681428571428572,0.699999988079071,0.30000001192092896,0.17000000178813934,0.09000000357627869],["Landsat_Fmask_allL7_SR_medoid_2014_2016_190_250_31_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2015",-109.74183328494144,42.94571387213776,1433116800000,0.6195835678109173,0.5870142857142857,0.699999988079071,0.30000001192092896,0.07999999821186066,0.029999999329447746],["Landsat_Fmask_allL7_SR_medoid_2015_2017_190_250_32_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2016",-109.74183328494144,42.94571387213776,1464739200000,0.6360619469026548,0.6058857142857144,0.699999988079071,0.30000001192092896,0.14000000059604645,0.14000000059604645],["Landsat_Fmask_allL7_SR_medoid_2016_2018_190_250_33_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2017",-109.74183328494144,42.94571387213776,1496275200000,0.6152263374485596,0.6247571428571429,0.699999988079071,0.30000001192092896,0.05000000074505806,0.11999999731779099],["Landsat_Fmask_allL7_SR_medoid_2017_2019_190_250_34_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2018",-109.74183328494144,42.94571387213776,1527811200000,0.656484727090636,0.6436285714285715,0.699999988079071,0.30000001192092896,0.17000000178813934,0.1899999976158142],["Landsat_Fmask_allL7_SR_medoid_2018_2020_190_250_35_BT-LC-LU-DND-RNR-DNDSlow-DNDFast-2019",-109.74183328494144,42.94571387213776,1559347200000,0.6271186440677967,0.6625,0.699999988079071,0.30000001192092896,0.1599999964237213,0.3199999928474426]]');function dataTableNumbersToNames(e){chartTableDict=null!==pixelChartCollections[whichPixelChartCollection].chartTableDict&&void 0!==pixelChartCollections[whichPixelChartCollection].chartTableDict?pixelChartCollections[whichPixelChartCollection].chartTableDict:null;var a=e[0];a[0]=a[0].toProperCase();var t=[a];return e.slice(1).map((function(e){var o=[];jQuery.each(e,(function(e,t){var l,r=a[e];if(null!==chartTableDict&&null!==chartTableDict[r]&&void 0!==chartTableDict[r]&&void 0!==t){var n=Object.keys(chartTableDict[r]).filter((function(e){return Math.abs(e-t)<1e-4}));if(null==(l=chartTableDict[r][n])){try{t=t.formatNumber()}catch(e){}l=t}}else{try{t=t.toFixed(6)}catch(e){}l=t}null===l&&(l=""),o.push(l)})),t.push(o)})),t}function htmlTable(e){var a='<div class = "flexcroll chart-table text-black"><table class="table  table-hover">';return a+="<thead><tr>",dataTable[0].map((function(e){a+='<th  class = "chart-table-first-row bg-black">'+e+"</th>"})),a+="</tr></thead>",e.slice(1).map((function(e){a+="<tr>";e.map((function(e){a+="<td>"+e+"</td>"})),a+="</tr>"})),a+="</tr><tbody></table></div>"}var d=[["time","NDVI","NDVI_LT_fitted","Land Cover Class","Land Use Class","Loss Probability","Gain Probability"],["1985",.6456953642384106,null,.6000000238418579,.30000001192092896,.019999999552965164,0],["1986",.6456953642384106,.6573789473684211,.6000000238418579,.30000001192092896,0,0],["1987",.6456953642384106,.6598578947368421,.6000000238418579,.30000001192092896,0,0],["1988",.6934156378600823,.6623368421052632,.6000000238418579,.30000001192092896,0,0],["1989",.6934156378600823,.6648157894736842,.6000000238418579,.30000001192092896,0,0],["1990",.6934156378600823,.6672947368421053,.6000000238418579,.30000001192092896,0,0],["1991",null,.6697736842105264,null,null,null,null],["1992",null,.6722526315789473,null,null,null,null],["1993",null,.6747315789473685,null,null,null,null],["1994",.6439862542955326,.6772105263157895,.6000000238418579,.30000001192092896,0,0],["1995",.6439862542955326,.6796894736842105,.6000000238418579,.30000001192092896,0,0],["1996",.6439862542955326,.6821684210526316,.6000000238418579,.30000001192092896,0,0],["1997",null,.6846473684210527,null,null,null,null],["1998",.7261107729762629,.6871263157894737,.6000000238418579,.30000001192092896,.1599999964237213,0],["1999",.7261107729762629,.6896052631578948,.6000000238418579,.30000001192092896,.07999999821186066,0],["2000",.6856763925729443,.6920842105263157,.6000000238418579,.30000001192092896,.09000000357627869,0],["2001",.6856763925729443,.6945631578947369,.6000000238418579,.30000001192092896,.07000000029802322,0],["2002",.7016229712858926,.6970421052631579,.6000000238418579,.30000001192092896,.05000000074505806,0],["2003",.6268958543983821,.6995210526315789,.6000000238418579,.30000001192092896,0,0],["2004",.766839378238342,.7020000000000001,.6000000238418579,.30000001192092896,0,0],["2005",.1652502360717658,.1652,.10000000149011612,.5,.75,0],["2006",.37468030690537085,.21481538461538469,.10000000149011612,.6000000238418579,.07999999821186066,.07999999821186066],["2007",.37468030690537085,.26443076923076925,.4000000059604645,.6000000238418579,.09000000357627869,.05999999865889549],["2008",.44536882972823066,.3140461538461539,.10000000149011612,.5,.12999999523162842,.12999999523162842],["2009",.3751962323390895,.3636615384615385,.4000000059604645,.6000000238418579,.019999999552965164,.07999999821186066],["2010",.3751962323390895,.41327692307692304,.4000000059604645,.6000000238418579,0,.10999999940395355],["2011",.4737417943107221,.4628923076923077,.4000000059604645,.6000000238418579,.05999999865889549,.07999999821186066],["2012",.5301810865191147,.5125076923076924,.4000000059604645,.6000000238418579,.12999999523162842,.10000000149011612],["2013",.5709251101321586,.562123076923077,.4000000059604645,.6000000238418579,.05000000074505806,.8399999737739563],["2014",.569609507640068,.6117384615384616,.4000000059604645,.30000001192092896,0,.6499999761581421],["2015",.6380090497737556,.6613538461538462,.4000000059604645,.6000000238418579,.019999999552965164,.8700000047683716],["2016",.7084615384615386,.7109692307692308,.4000000059604645,.30000001192092896,0,.75],["2017",.7672530446549392,.7605846153846154,.4000000059604645,.30000001192092896,0,.6499999761581421]],d=[["time","landcover","burnSeverity","cdl","percent_tree_cover","impervious","IDS Mort Type","IDS Mort DCA","IDS Defol Type","IDS Defol DCA","IDS Mort Type Year","IDS Mort DCA Year","IDS Defol Type Year","IDS Defol DCA Year"],[1984,,,,,,,,,,,,,],[1985,,,,,,,,,,,,,],[1986,,,,,,,,,,,,,],[1987,,,,,,,,,,,,,],[1988,,,,,,,,,,,,,],[1989,,,,,,,,,,,,,],[1990,,,,,,,,,,,,,],[1991,,,,,,,,,,,,,],[1992,43,,,,,,,,,,,,],[1993,,,,,,,,,,,,,],[1994,,,,,,,,,,,,,],[1995,,,,,,,,,,,,,],[1996,,,,,,,,,,,,,],[1997,,,,,,,,,,,,,],[1998,,,,,,,,,,,,,],[1999,,,,,,,,,,,,,],[2e3,,,,,,,,,,,,,],[2001,43,,,,0,,,,,,,,],[2002,,,,,,,,,,,,,],[2003,,,,,,,,,,,,,],[2004,43,,,,,,,,,,,,],[2005,,,,,,2,11,,,2005,2005,,],[2005,,,,,,2,11,,,2005,2005,,],[2006,43,,,,0,,,,,,,,],[2007,,,,,,2,80,,,2007,2007,,],[2007,,,,,,2,80,,,2007,2007,,],[2008,43,,143,,,,,,,,,,],[2009,,,143,,,,,,,,,,],[2010,,,143,,,,,,,,,,],[2011,43,,142,65,0,,,,,,,,],[2012,,,143,,,,,,,,,,],[2013,43,,143,,,,,,,,,,],[2014,,,143,,,,,,,,,,],[2015,,,141,,,,,,,,,,],[2016,43,,143,,0,,,,,,,,],[2017,,,143,,,,,,,,,,],[2018,,,143,,,,,,,,,,]];function addClickMarker(e){e.evaluate((function(e){var a=e.coordinates[0];marker.setMap(null),marker=new google.maps.Rectangle({bounds:{north:a[0][1],south:a[2][1],east:a[1][0],west:a[0][0]},strokeColor:"#FF0",fillOpacity:0}),marker.setMap(map)}))}function getEveryOther(e){return e.filter((a=>e.indexOf(a)%2==0))}function makeLegend(e){$("#chart-modal-graph-container").append("<div id = 'chart-legend' style = 'font-size:0.7em;' class = 'text-dark'></div>"),Object.keys(e).map((function(a){var t=a;try{var o=JSON.parse(e[a])}catch(t){o=e[a]}var l=t.replaceAll(" ","-");l=l.replaceAll(":","")+"-legend",$("#chart-legend").append(`<div  class = 'px-2' id='${l}'>\n\t\t\t\t\t\t\t\t\t\t<div class = 'p-0'>${t}</div>\n\t\t\t\t\t\t\t\t\t\t<table  style = 'display:inline-block;vertical-align:top' class = 'table-bordered' id = '${l}-table'></table>\n\t\t\t\t\t\t\t\t\t</div>`),$("#"+l+"-table").append(`<tr id = '${l}-table-names'></tr>`),$("#"+l+"-table").append(`<tr id = '${l}-table-values'></tr>`),Object.keys(o).map((function(e){$("#"+l+"-table-names").append(`<td>${e}</td>`)})),Object.keys(o).map((function(e){$("#"+l+"-table-values").append(`<td>${o[e]}</td>`)}))}))}function startPixelChartCollection(){map.setOptions({draggableCursor:"help"}),mapHammer=new Hammer(document.getElementById("map")),mapHammer.on("doubletap",(function(e){chartCollection=pixelChartCollections[whichPixelChartCollection].collection,areaGeoJson=null,$("#summary-spinner").slideDown(),map.setOptions({draggableCursor:"progress"});var a=e.center.x,t=e.center.y;center=point2LatLng(a,t);var o=ee.Geometry.Point([center.lng(),center.lat()]),l=o.buffer(plotRadius).bounds();addClickMarker(l);var r=ee.ImageCollection(chartCollection.filterBounds(o));uriName=pixelChartCollections[whichPixelChartCollection].label.replaceAll(" ","_")+"_lng_"+center.lng().toFixed(4).toString()+"_lat_"+center.lat().toFixed(4).toString(),chartTitle=pixelChartCollections[whichPixelChartCollection].label+" (lng: "+center.lng().toFixed(4).toString()+" lat: "+center.lat().toFixed(4).toString()+")",csvName=uriName+".csv",r.getRegion(l,null,"EPSG:5070",[30,0,-2361915,0,-30,3177735]).evaluate((function(e,a){if($("#summary-spinner").slideUp(),null!=a&&showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Error! Try again',a),null!=e&&e.length>1){var t=r.size().getInfo()+1;e.length>t&&(console.log("reducing number of inputs"),e=e.slice(0,t)),function(e){if(chartIncludeDate)var a=3;else a=4;print("Extracted values:"),print(e);var t=e[0].slice(a);e=e.slice(1).map((function(e){return e.slice(a)})).sort(sortFunction),chartIncludeDate&&(e=e.map((function(e){var a=e[0];if(!1===pixelChartCollections[whichPixelChartCollection].simplifyDate)var t=new Date(a).toGMTString();else t=!0===pixelChartCollections[whichPixelChartCollection].semiSimpleDate?`${new Date(a).getFullYear()}-${new Date(a).getMonth()+1}-${new Date(a).getDate()}`:(new Date(a).getYear()+1900).toString();return e[0]=t,e}))),e.unshift(t),$("#summary-spinner").slideUp(),map.setOptions({draggableCursor:"help"}),ga("send","event",mode,"pixelChart",whichPixelChartCollection),addChartJS(e,chartTitle,"line",!1,!1,pixelChartCollections[whichPixelChartCollection].chartColors,pixelChartCollections[whichPixelChartCollection].xAxisLabel,pixelChartCollections[whichPixelChartCollection].yAxisLabel,pixelChartCollections[whichPixelChartCollection].fieldsHidden),null!==pixelChartCollections[whichPixelChartCollection].legends&&void 0!==pixelChartCollections[whichPixelChartCollection].legends&&(makeLegend(pixelChartCollections[whichPixelChartCollection].legends),toggleChartTable(localStorage.tableOrChart))}(e)}else showMessage("Charting Error","Unknown Error<br>Try again")}))}))}function stopCharting(){try{mapHammer.destroy()}catch(e){}try{map.setOptions({draggableCursor:"hand"}),$("#summary-spinner").slideUp(),infowindow.setMap(null),marker.setMap(null)}catch(e){}}function exportJSON(e,a){a=JSON.stringify(a);var t=new Blob([a],{type:"application/json"}),o=URL.createObjectURL(t),l=document.createElement("a");if(void 0!==l.download){o=URL.createObjectURL(t);l.setAttribute("href",o),l.setAttribute("download",e),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),ga("send","event",mode,getActiveTools()[0]+"-chartDownload","geoJSON")}}function exportToCsv(e,a){for(var t=function(e){for(var a="",t=0;t<e.length;t++){var o=null===e[t]||void 0===e[t]?"":e[t].toString();e[t]instanceof Date&&(o=e[t].toLocaleString());var l=o.replace(/"/g,'""');l.search(/("|,|\n)/g)>=0&&(l='"'+l+'"'),t>0&&(a+=","),a+=l}return a+"\n"},o="",l=0;l<a.length;l++)o+=t(a[l]);var r=new Blob([o],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,e);else{var n=document.createElement("a");if(void 0!==n.download){var i=URL.createObjectURL(r);n.setAttribute("href",i),n.setAttribute("download",e),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),ga("send","event",mode,getActiveTools()[0]+"-chartDownload","csv")}}}function stopAllTools(){stopArea(),stopDistance(),stopQuery(),stopCharting(),stopAreaCharting(),stopCharting(),clearQueryGeoJSON(),turnOffUploadedLayers(),turnOffSelectLayers(),turnOffSelectGeoJSON(),Object.keys(toolFunctions).map((function(e){Object.keys(toolFunctions[e]).map((function(a){toolFunctions[e][a].state=!1}))})),updateToolStatusBar()}var toolFunctions={measuring:{area:{on:'stopAllTools();startArea();showTip("AREA MEASURING",staticTemplates.areaTip);',off:"stopAllTools();",state:!1,title:"Measuring Tools-Area Measuring"},distance:{on:'stopAllTools();startDistance();showTip("DISTANCE MEASURING",staticTemplates.distanceTip);',off:"stopAllTools()",state:!1,title:"Measuring Tools-Distance Measuring"}},pixel:{query:{on:'stopAllTools();startQuery();showTip("QUERY VISIBLE MAP LAYERS",staticTemplates.queryTip);',off:"stopAllTools()",state:!1,title:"Pixel Tools-Query Visible Map Layers"},chart:{on:'stopAllTools();startPixelChartCollection();showTip("QUERY "+mode+" TIME SERIES",staticTemplates.pixelChartTip);',off:"stopAllTools()",state:!1,title:"Pixel Tools-Query "+mode+" Time Series"}},area:{userDefined:{on:'stopAllTools();areaChartingTabSelect("#user-defined");showTip("SUMMARIZE BY USER-DEFINED AREA",staticTemplates.userDefinedAreaChartTip);',off:"stopAllTools()",state:!1,title:"Area Tools-User Defined Area Tool"},shpDefined:{on:'stopAllTools();areaChartingTabSelect("#shp-defined");showTip("SUMMARIZE BY UPLOADED AREA",staticTemplates.uploadAreaChartTip);',off:"stopAllTools()",state:!1,title:"Area Tools-Upload an Area"},selectDropdown:{on:'stopAllTools();areaChartingTabSelect("#pre-defined");showTip("SUMMARIZE BY PRE-DEFINED AREA",staticTemplates.selectAreaDropdownChartTip);',off:"stopAllTools()",state:!1,title:"Area Tools-Select an Area from Dropdown"},selectInteractive:{on:'stopAllTools();turnOffVectorLayers();turnOnSelectedLayers();turnOnSelectGeoJSON();areaChartingTabSelect("#user-selected");showTip("SUMMARIZE BY PRE-DEFINED AREA",staticTemplates.selectAreaInteractiveChartTip);',off:"stopAllTools();turnOffSelectLayers();",state:!1,title:"Area Tools-Select an Area on map"}}};function getActiveTools(){var e=[];return Object.keys(toolFunctions).map((function(a){Object.keys(toolFunctions[a]).map((function(t){var o=toolFunctions[a][t].state,l=toolFunctions[a][t].title;o&&e.push(l)}))})),e}function updateToolStatusBar(){var e=!1;$("#current-tool-selection").empty(),$("#current-tool-selection").append("Currently active tools: "),Object.keys(toolFunctions).map((function(a){Object.keys(toolFunctions[a]).map((function(t){var o=toolFunctions[a][t].state,l=toolFunctions[a][t].title;o&&($("#current-tool-selection").append(`${l}`),e=!0)}))})),e?ga("send","event","tool-active",mode,$("#current-tool-selection").html().split(": ")[1]):$("#current-tool-selection").append("No active tools")}function toggleTool(tool){tool.state?eval(tool.off):(eval(tool.on),tool.state=!0),updateToolStatusBar()}function combineChange(e,a,t,o,l,r,n,i){null==i&&(i=!1),a=ee.Number(a).int16();ee.Image(e.first());if("stack"!==r)var s=(e=e.filter(ee.Filter.eq("year",a))).filter(ee.Filter.eq("model","RNR")).mosaic(),d=e.filter(ee.Filter.eq("model","DND_Slow")).mosaic(),c=e.filter(ee.Filter.eq("model","DND_Fast")).mosaic(),p=ee.Image.cat([d,c,s]);else p=e.filter(ee.Filter.calendarRange(a,a,"year")).filter(ee.Filter.neq("model","STABLE")).mosaic().select(["DND_Slow","DND_Fast","RNR"]);var u=(p=p.multiply(n)).mask().reduce(ee.Reducer.min()),m=p.reduce(ee.Reducer.max()),g=p.eq(m).and(p.gte(ee.Image([o,l,t]))).selfMask(),h=ee.Image([a,a,a]).updateMask(g).int16(),y=ee.Image([1,2,3]).updateMask(g).reduce(ee.Reducer.max()).rename(["maxClass"]);return ee.Image.cat([p,g,h,y,u]).rename(["Slow_Loss_Prob","Fast_Loss_Prob","Gain_Prob","Slow_Loss_Mask","Fast_Loss_Mask","Gain_Mask","Slow_Loss_Year","Fast_Loss_Year","Gain_Year","maxClass","processingMask"]).set("system:time_start",ee.Date.fromYMD(a,6,1).millis())}function combineLandCover(e,a,t,o,l,r){var n=ee.Image(e.first()),i=o.map((function(e){return e+"_Prob"})),s=o.map((function(e){return e+"_Mask"}));if(a=ee.Number(a).int16(),"stack"!==l)e=e.filter(ee.Filter.eq("year",a)),e=ee.ImageCollection(o.map((function(a){return fillEmptyCollections(e.filter(ee.Filter.eq("model",a)),n).mosaic()}))).toBands().rename(i);else e=e.filter(ee.Filter.calendarRange(a,a,"year")).mosaic().select(o,i);var d=(e=e.multiply(r)).reduce(ee.Reducer.max()),c=e.eq(d).rename(s),p=ee.Image(t).updateMask(c).reduce(ee.Reducer.max()).rename(["maxClass"]);return e.addBands(c).addBands(p).set("system:time_start",ee.Date.fromYMD(a,6,1).millis())}function getLCMSVariables(){window.declineYearPalette="ffffe5,fff7bc,fee391,fec44f,fe9929,ec7014,cc4c02",window.recoveryYearPalette="AFDEA8,80C476,308023,145B09",window.declineProbPalette="F5DEB3,D00",window.recoveryProbPalette="F5DEB3,006400",window.declineDurPalette="BD1600,E2F400,0C2780",window.recoveryDurPalette=declineDurPalette,window.gainYearPaletteA="c5ee93,00a398",window.changePaletteFull=["#3d4551","#f39268","#d54309","#00a398","#222222"],window.changePalette=["f39268","d54309","00a398"],window.whichIndices=["NBR"],window.bt_study_area=ee.FeatureCollection("projects/USFS/LCMS-NFS/R4/BT/GTNP_admin_bndy_5km_buffer_GTNP_Merge"),window.fnf_study_area=ee.FeatureCollection("projects/USFS/LCMS-NFS/R1/FNF/FNF_GNP_Merge_Admin_BND_1k"),window.mls_study_area=ee.FeatureCollection("projects/USFS/LCMS-NFS/R4/MLS/MLS_LCMS_ProjectArea_5km"),window.ck_study_area=ee.FeatureCollection("projects/USFS/LCMS-NFS/R10/CK/CK_LCMS_ProjectArea").map((function(e){return e.convexHull(1e3)})),window.usfs_regions=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/FS_Region_Boundaries"),window.b=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/FS_Boundaries"),window.nps=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/NPS_Boundaries"),window.otherLands=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/OtherNationalDesignatedArea"),window.gtnp=ee.Feature(nps.filter(ee.Filter.eq("PARKNAME","Grand Teton")).first()),window.gnp=ee.Feature(nps.filter(ee.Filter.eq("PARKNAME","Glacier")).first()),window.kfnp=ee.Feature(nps.filter(ee.Filter.eq("PARKNAME","Kenai Fjords")).first()),window.btnf=ee.Feature(b.filter(ee.Filter.eq("FORESTNAME","Bridger-Teton National Forest")).first()),window.fnf=ee.Feature(b.filter(ee.Filter.eq("FORESTNAME","Flathead National Forest")).first()),window.mlsnf=ee.Feature(b.filter(ee.Filter.eq("FORESTNAME","Manti-La Sal National Forest")).first()),window.cnf=ee.Feature(b.filter(ee.Filter.eq("FORESTNAME","Chugach National Forest")).first()),window.R4_unofficial=ee.FeatureCollection("projects/USFS/LCMS-NFS/R4/R4_LCMS_ProjectArea_5km"),window.R4_official=usfs_regions.filter(ee.Filter.eq("REGION","04")),window.huc8=ee.FeatureCollection("USGS/WBD/2017/HUC08"),window.kenai_nwr=ee.FeatureCollection("projects/USFS/LCMS-NFS/AK-Ancillary-Data/Kenai_NWR").filterBounds(ck_study_area)}function computeThematicChange(e,a,t,o,l,r,n){var i="7d2702",s=e.filter(ee.Filter.calendarRange(r,r+3,"year")).mode(),d=e.filter(ee.Filter.calendarRange(n-3,n,"year")).mode(),c=s.neq(d),p=[];a.map((function(e){a.map((function(a){e!==a&&p.push(parseInt(e.toString()+a.toString()))}))})),console.log(p);var u=d;return u=u.where(c,a.max()+1),changeLegendColors=copyArray(t),changeLegendColors.push(i),u=u.updateMask(u.eq(a.max()+1)),changeLegendDict=copyObj(o),changeLegendDict["Conversion/Change"]=i,{change:u,viz:{title:`Most common class from ${r} to ${n} with change added.`,layerType:"geeImage",min:a.min(),max:a.max()+1,palette:changeLegendColors,addToClassLegend:!0,classLegendDict:changeLegendDict,queryDict:l}}}function formatAreaChartCollection(e,a,o,l){return null==l&&(l=!0),out=ee.ImageCollection(e.map((function(e){return t=ee.ImageCollection(a.map((function(a){return function(e,a){return e.eq(parseInt(a))}(e,a)}))).toBands(),t.rename(o).copyProperties(e,["system:time_start"]).copyProperties(e)}))),l&&(out=ee.ImageCollection(out.map((function(e){return e.unmask(0,!1)})))),ee.ImageCollection(out)}function multBands(e,a,t){var o=e.multiply(ee.Image(a).multiply(t));return o=o.copyProperties(e,["system:time_start"]).copyProperties(e)}function additionBands(e,a){var t=e.add(ee.Image(a));return t=t.copyProperties(e,["system:time_start"]).copyProperties(e)}function simpleAddIndices(e,a){return null==a&&(a=1),e=(e=(e=(e=e.addBands(e.normalizedDifference(["nir","red"]).select([0],["NDVI"]).multiply(a))).addBands(e.normalizedDifference(["nir","swir2"]).select([0],["NBR"]).multiply(a))).addBands(e.normalizedDifference(["nir","swir1"]).select([0],["NDMI"]).multiply(a))).addBands(e.normalizedDifference(["green","swir1"]).select([0],["NDSI"]).multiply(a))}function simpleGetTasseledCap(e){var a=ee.List(["blue","green","red","nir","swir1","swir2"]),t=ee.Array([[.2043,.4158,.5524,.5741,.3124,.2303],[-.1603,-.2819,-.4934,.794,-2e-4,-.1446],[.0315,.2021,.3102,.1594,-.6806,-.6109]]),o=e.select(a).toArray().toArray(1),l=ee.Image(t).matrixMultiply(o).arrayProject([0]).arrayFlatten([["brightness","greenness","wetness"]]).float();return e.addBands(l)}function batchFillCollection(e,a){var t=e.toList(1e4,0).map((function(e){return ee.Date(ee.Image(e).get("system:time_start")).get("year")})).distinct().getInfo(),o=a.filter((function(e){return-1==t.indexOf(e)})),l=ee.Image(e.first()).mask(ee.Image(0)),r=o.map((function(e){return l.set("system:time_start",ee.Date.fromYMD(e,1,1).millis())}));return e.merge(r).sort("system:time_start")}function setSameDate(e){var a=ee.Date(e.get("system:time_start")).get("year");return e.set("system:time_start",ee.Date.fromYMD(a,6,1).millis())}function joinCollections(e,a,t){null==t&&(t=!0);var o=ee.Join.inner(),l=ee.Filter.equals("system:time_start",null,"system:time_start"),r=ee.ImageCollection(o.apply(e,a,l));return r=ee.ImageCollection(r.map((function(e){return ee.Image.cat(e.get("primary"),e.get("secondary"))}))),t&&(r=r.map((function(e){return e.mask(e.mask().and(e.reduce(ee.Reducer.min()).neq(0)))}))),r}function setNoData(e,a){var t=e.mask();return e=(e=e.mask(ee.Image(1))).where(t.not(),a)}function addYearBand(e){var a=ee.Date(e.get("system:time_start")).get("year"),t=ee.Image.constant(a).rename(["year"]).float();return t=t.updateMask(e.select([0]).mask()),e.addBands(t).float()}function fillEmptyCollections(e,a){var t=ee.ImageCollection([a.mask(ee.Image(0))]),o=e.toList(1).length();return ee.ImageCollection(ee.Algorithms.If(o.gt(0),e,t))}updateToolStatusBar();var idsStartYear=1997,idsEndYear=2021,idsMinYear=1997,idsMaxYear=2021;function getIDSCollection(){idsStartYear=startYear>idsMinYear&&startYear<=idsMaxYear?startYear:idsMinYear,idsEndYear=endYear<idsMaxYear&&endYear>=idsMinYear?endYear:idsMaxYear;var e=ee.data.getList({id:"projects/lcms-292214/assets/CONUS-Ancillary-Data/IDS"}).map((function(e){return e.id}));e=e.map((function(e){return ee.FeatureCollection(e)})),e=(e=ee.FeatureCollection(e).flatten()).filter(ee.Filter.and(ee.Filter.gte("SURVEY_YEA",idsStartYear),ee.Filter.lte("SURVEY_YEA",idsEndYear))).set("bounds",clientBoundsDict.CONUS);var a=ee.List.sequence(idsStartYear,idsEndYear).map((function(a){var t=e.filter(ee.Filter.eq("SURVEY_YEA",a)),o=t.reduceToImage(["DCA_CODE"],ee.Reducer.first()).divide(1e3),l=t.reduceToImage(["DAMAGE_TYP"],ee.Reducer.first());return o.addBands(l).int16().set("system:time_start",ee.Date.fromYMD(a,6,1).millis()).rename(["Damage_Agent","Damage_Type"])}));return{imageCollection:a=ee.ImageCollection.fromImages(a),featureCollection:e}}function getAspectObj(){var e=ee.Image("USGS/SRTMGL1_003"),a=ee.Terrain.aspect(e).int16(),t=ee.List.sequence(0,360,90).slice(0,-1),o=[],l=[],r=(ee.Dictionary({}),["Northeast (0"+String.fromCharCode(176)+"-89"+String.fromCharCode(176)+")","Southeast (90"+String.fromCharCode(176)+"-179"+String.fromCharCode(176)+")","Southwest (180"+String.fromCharCode(176)+"-269"+String.fromCharCode(176)+")","Northwest (270"+String.fromCharCode(176)+"-359"+String.fromCharCode(176)+")"]),n=ee.List([]),i=ee.Dictionary({});t.getInfo().map((function(e){var a=e=ee.Number(e),t=e.add(90).subtract(1),r=t.add(a).divide(2).round(),s=ee.Number(r).int16().format(),d=ee.List.sequence(a,t),c=ee.List.repeat(r,90);n=n.cat([s]),o.push(d),l.push(c),i=i.set(s,randomColor())})),o=ee.List(o).flatten(),l=ee.List(l).flatten();var s=ee.Dictionary.fromLists(n,r);return{image:a.remap(o,l),lookupDict:s,colorDict:i}}function getNLCDObj(){var e=[2001,2004,2006,2008,2011,2013,2016,2019],a=["466b9f","d1def8","dec5c5","d99282","eb0000","ab0000","b3ac9f","68ab5f","1c5f2c","b5c58f","af963c","ccb879","dfdfc2","d1d182","a3cc51","82ba9e","dcd939","ab6c28","b8d9eb","6c9fb8"],t=[11,12,21,22,23,24,31,41,42,43,51,52,71,72,73,74,81,82,90,95],o=["Open Water","Perennial Ice/Snow","Developed, Open Space","Developed, Low Intensity","Developed, Medium Intensity","Developed High Intensity","Barren Land (Rock/Sand/Clay)","Deciduous Forest","Evergreen Forest","Mixed Forest","Dwarf Scrub","Shrub/Scrub","Grassland/Herbaceous","Sedge/Herbaceous","Lichens","Moss","Pasture/Hay","Cultivated Crops","Woody Wetlands","Emergent Herbaceous Wetlands"],l=ee.List.sequence(0,95).getInfo(),r={},n={},i={},s=0;l.map((function(e){-1!==t.indexOf(e)?(n[e]=o[s],r[e]=a[s],i[o[s]]=a[s],s++):r[e]="000"}));var d={};Object.keys(i).reverse().map((function(e){d[e]=i[e]}));var c=ee.ImageCollection("USGS/NLCD_RELEASES/2019_REL/NLCD").select(["landcover"],["NLCD Landcover"]).sort("system:time_start"),p=e.map((function(e){var a=c.filter(ee.Filter.calendarRange(e,e,"year")).mosaic();return a=a.set("system:time_start",ee.Date.fromYMD(e,6,1).millis())}));p=ee.ImageCollection(p);var u={"NLCD Landcover":n};return{collection:p=p.set("bounds",clientBoundsDict.All).set("chartTableDict",u),years:e,palette:a,vizDict:r,queryDict:n,legendDict:i,legendDictReverse:d,min:0,max:95}}function getMTBSAndNLCD(e,a,t){null==t&&(t=!1),null==mtbsSummaryMethod&&(mtbsSummaryMethod="Highest-Severity");var o=endYear;endYear>2020&&(o=2020);var l=ee.List.sequence(1984,o),r=ee.ImageCollection("projects/gtac-mtbs/assets/burn_severity_mosaics/MTBS");r=l.map((function(e){return r.filter(ee.Filter.calendarRange(e,e,"year")).mosaic().set("system:time_start",ee.Date.fromYMD(e,6,1).millis())}));r=(r=(r=(r=ee.ImageCollection.fromImages(r)).filter(ee.Filter.calendarRange(startYear,o,"year"))).map((function(e){return e.select([0],["burnSeverity"]).byte()}))).map((function(e){var a=e.remap([1,2,3,4,5,6],[1,3,4,5,2,1]).rename(["burnSeverityRemap"]),t=e.remap([1,2,3,4,5,6],[0,1,1,1,0,0]).rename(["burnedNotBurned"]);t=t.selfMask();var o=ee.Image(ee.Date(e.get("system:time_start")).get("year")).updateMask(a.mask()).rename("burnYear");return e.addBands(a).addBands(t).addBands(t.multiply(-1).rename(["burnYearNegative"])).addBands(o).int16()}));var n=(r=ee.ImageCollection(r)).qualityMosaic({"Highest-Severity":"burnSeverityRemap","Most-Recent":"burnYear",Oldest:"burnYearNegative"}[mtbsSummaryMethod]),i=r.select([2]).count(),s={"Unburned to Low":"006400",Low:"7fffd4",Moderate:"ffff00",High:"ff0000","Increased Greenness":"7fff00","Non-Processing Area Mask":"ffffff"};mtbsQueryClassDict={};var d=1;if(Object.keys(s).map((function(e){mtbsQueryClassDict[d]=e,d++})),!0===chartMTBS){var c=formatAreaChartCollection(r.select([0]),Object.keys(mtbsQueryClassDict),Object.values(mtbsQueryClassDict),!0);areaChartCollections.mtbs={collection:c,colors:Object.values(s),label:"MTBS Burn Severity by Year",stacked:!0,steppedLine:!1,chartType:"bar",xAxisProperty:"year",tooltip:"Chart the MTBS burn severity by year"},areaChartCollections.mtbs_burn_mosaic={collection:ee.ImageCollection([r.select([2]).mosaic().unmask(0).rename(["Burned"]).set("Burned","All Mapped Burned Area (Total of Low, Moderate, and High Severity) "+startYear.toString()+"-"+endYear.toString())]),colors:["#CC5500"],label:"MTBS Burned Area Total "+startYear.toString()+"-"+endYear.toString(),stacked:!0,steppedLine:!1,chartType:"bar",xAxisProperty:"Burned",tooltip:"Chart the union of all burned areas (areas with low, moderate, or high severity) "+startYear.toString()+"-"+endYear.toString()},areaChartCollections.mtbs_burn_severity_mosaic={collection:ee.ImageCollection([c.max().unmask(0).set("Burned","Burn Severity Total "+startYear.toString()+"-"+endYear.toString())]),colors:Object.values(s),label:"MTBS Burn Severity Total "+startYear.toString()+"-"+endYear.toString(),stacked:!0,steppedLine:!1,chartType:"bar",xAxisProperty:"Burned",tooltip:"Chart the union of burn severity "+startYear.toString()+"-"+endYear.toString()+". The maximum severity is used when fires overlap. "}}var p=r.select([0]).max();if(chartMTBSByNLCD){var u=getNLCDObj();Map2.addTimeLapse(u.collection,{min:u.min,max:u.max,palette:Object.values(u.vizDict),addToClassLegend:!0,classLegendDict:u.legendDictReverse,queryDict:u.queryDict,years:u.years},"NLCD Land Cover Time Lapse",!1,null,null,"NLCD landcover classes ","reference-layer-list"),u.years.map((function(e){var a=u.collection.filter(ee.Filter.calendarRange(e,e,"year")).mosaic(),t=Object.keys(u.queryDict).map((function(e){var t=u.queryDict[e];return p.updateMask(a.eq(ee.Number.parse(e))).set("nlcd_landcover_class",t)})),o=formatAreaChartCollection(t=ee.ImageCollection(t),Object.keys(mtbsQueryClassDict),Object.values(mtbsQueryClassDict),!0);areaChartCollections["mtbsNLCD"+e.toString()]={collection:o,colors:Object.values(s),label:"MTBS Burn Severity by NLCD Class "+e.toString(),stacked:!0,steppedLine:!1,chartType:"bar",xAxisProperty:"nlcd_landcover_class",xAxisLabel:"NLCD "+e.toString()+" Class",tooltip:"Chart MTBS burn severity by each NLCD "+e.toString()+" landcover class"}}))}if(chartMTBSByAspect){var m=getAspectObj(),g=m.image,h=m.lookupDict.getInfo(),y=Object.keys(h).map((function(e){var a=h[e];return p.updateMask(g.eq(ee.Number.parse(e))).set("Aspect_Bin",a)})),f=formatAreaChartCollection(y=ee.ImageCollection(y),Object.keys(mtbsQueryClassDict),Object.values(mtbsQueryClassDict),!0);areaChartCollections.mtbsAspect={collection:f,colors:Object.values(s),label:"MTBS Burn Severity by Aspect",stacked:!0,steppedLine:!1,chartType:"bar",xAxisProperty:"Aspect_Bin",xAxisLabel:"Aspect Bin",tooltip:"Chart MTBS burn severity by aspect quadrants."}}var v={layerType:"geeImage",queryDict:mtbsQueryClassDict,min:1,max:6,palette:"006400,7fffd4,ffff00,ff0000,7fff00,ffffff",addToClassLegend:!0,classLegendDict:s};Map2.addLayer(n.select([0]).set("bounds",clientBoundsDict.All),v,"MTBS Burn Severity",t,null,null,"MTBS "+mtbsSummaryMethod+" burn severity mosaic from "+startYear.toString()+"-"+o.toString(),a),Map2.addLayer(n.select([4]).set("bounds",clientBoundsDict.All),{min:startYear,max:endYear,palette:declineYearPalette,layerType:"geeImage"},"MTBS Burn Year",!1,null,null,"MTBS "+mtbsSummaryMethod+" burn year from "+startYear.toString()+"-"+o.toString(),a),Map2.addLayer(i.set("bounds",clientBoundsDict.All),{layerType:"geeImage",min:1,max:5,palette:declineDurPalette.split(",").reverse().join(","),legendLabelLeft:"Count =",legendLabelRight:"Count >="},"MTBS Burn Count",!1,null,null,"MTBS number of burns mapped for a given area from "+startYear.toString()+"-"+o.toString()+" with a burn serverity class of low, moderate, or high",a);var b={"Burn Severity":mtbsQueryClassDict};return{NLCD:u,MTBS:{collection:r.set("bounds",clientBoundsDict.All).select([0],["Burn Severity"]).set("chartTableDict",b)},MTBSSeverityViz:v}}function getMTBSandIDS(e,a){null==a&&(a="reference-layer-list");var t=getIDSCollection(),o=ee.ImageCollection("USGS/NLCD_RELEASES/2016_REL");[2016].map((function(e){var t=o.filter(ee.Filter.calendarRange(e,e,"year")).select(["percent_tree_cover"]).mosaic();Map2.addLayer(t.updateMask(t.gte(1)).set("bounds",clientBoundsDict.CONUS),{min:1,max:90,palette:palettes.crameri.bamako[50].reverse()},"NLCD Tree Canopy Cover "+e.toString(),!1,null,null,"NLCD "+e.toString()+" Tree Canopy Cover",a)}));var l=t.featureCollection.reduceToImage(["SURVEY_YEA"],ee.Reducer.max()).set("bounds",clientBoundsDict.CONUS),r=t.featureCollection.reduceToImage(["SURVEY_YEA"],ee.Reducer.count()).selfMask().set("bounds",clientBoundsDict.CONUS);return Map2.addLayer(r,{min:1,max:Math.ceil((idsEndYear-idsStartYear)/2)+1,palette:declineYearPalette},"IDS Survey Count",!1,null,null,"Number of times an area was included in the IDS survey ("+idsStartYear.toString()+"-"+idsEndYear.toString()+")",a),Map2.addLayer(l,{min:startYear,max:endYear,palette:declineYearPalette},"IDS Most Recent Year Surveyed",!1,null,null,"Most recent year an area was included in the IDS survey ("+idsStartYear.toString()+"-"+idsEndYear.toString()+")",a),Map2.addLayer(t.featureCollection.set("bounds",clientBoundsDict.CONUS),{strokeColor:"0FF",layerType:"geeVectorImage"},"IDS Polygons",!1,null,null,"Polygons from the IDS survey ("+idsStartYear.toString()+"-"+idsEndYear.toString()+")",a),[getMTBSAndNLCD(e,a).MTBS.collection,t.imageCollection,t.featureCollection]}function getNAIP(e){null==e&&(e="reference-layer-list");var a=ee.ImageCollection("USDA/NAIP/DOQQ").select([0,1,2],["R","G","B"]);[[2003,2007],[2008,2008],[2009,2011],[2012,2014],[2015,2017],[2018,2020]].map((function(t){var o=a.filter(ee.Filter.calendarRange(t[0],t[1],"year")).mosaic().byte().set("bounds",clientBoundsDict.CONUS);Map2.addLayer(o,{addToLegend:!1,min:25,max:225,layerType:"geeImage"},"NAIP "+t[0].toString()+"-"+t[1].toString(),!1,null,null,"The National Agriculture Imagery Program (NAIP) acquired aerial imagery from the "+t[0].toString()+" to the "+t[1].toString()+" agricultural growing season in the continental U.S.",e)}))}function getHansen(e){null==e&&(e="reference-layer-list");var a=ee.Image("UMD/hansen/global_forest_change_2020_v1_8").reproject("EPSG:4326",null,30),t={type:"Polygon",coordinates:[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]},o=a.select(["lossyear"]).selfMask().add(2e3).int16(),l=2001,r=2020;startYear>l&&(l=startYear),endYear<r&&(r=endYear);var n=a.select(["gain"]);o=o.updateMask(o.gte(startYear).and(o.lte(endYear))),Map2.addLayer(o.set("bounds",t),{min:startYear,max:endYear,palette:declineYearPalette},"Hansen Loss Year",!1,null,null,"Hansen Global Forest Change year of loss",e),Map2.addLayer(n.updateMask(n).set("bounds",t),{min:1,max:1,palette:"0A0",addToClassLegend:!0,classLegendDict:{"Forest Gain":"0A0"}},"Hansen Gain",!1,null,null,"Hansen Global Forest Change gain",e)}function getNLCD(){var e=ee.ImageCollection("USGS/NLCD_RELEASES/2016_REL").select([0]),a=ee.Image("USGS/NLCD_RELEASES/2016_REL/2011"),t=(a.get("landcover_class_names"),a.get("landcover_class_palette")),o=a.get("landcover_class_values").getInfo().map((function(e){return e.toString()})),l=ee.Dictionary.fromLists(o,t).getInfo();print(l);var r=e.toList(1e3).map((function(e){return e=ee.Image(e),ee.Date(e.get("system:time_start")).get("year")})).getInfo(),n=[];r.map((function(e){-1==n.indexOf(e)&&n.push(e)}));var i=n.map((function(a){return e.filter(ee.Filter.calendarRange(a,a,"year")).mosaic().set("system:time_start",ee.Date.fromYMD(a,6,1).millis())}));i=ee.ImageCollection(i),Map2.addLayer(i.mode(),{addToClassLegend:!0,classLegendDict:l},"NLCD")}function thresholdChange(e,a,t,o){null==o&&(o=1);var l=ee.Image(e.first()).bandNames();return l=l.map((function(e){return ee.String(e).cat("_change_year")})),e.map((function(e){var r=ee.Date(e.get("system:time_start")).get("year"),n=e.multiply(o).gte(a).and(e.multiply(o).lte(t));return n=e.where(e.mask(),r).updateMask(n).rename(l).int16(),e.updateMask(n.mask()).addBands(n)}))}function LT_VT_multBands(e,a){var t=e.select(".*_fitted").multiply(a),o=e.select(".*_slope").multiply(a),l=e.select(".*_diff").multiply(a),r=e.select(".*_mag").multiply(a),n=e.select(".*_dur").addBands(t).addBands(o).addBands(l).addBands(r);return n=n.copyProperties(e,["system:time_start"]).copyProperties(e),ee.Image(n)}function convertStack_To_DurFitMagSlope(e,a){var t=(e=ee.ImageCollection(e)).first().bandNames();t.getInfo().indexOf("rmse")>=0&&(t=t.remove("rmse"),e=e.select(t));var o,l=e.first().get("maxSegments"),r=e.first().get("startYear"),n=e.first().get("endYear");return ee.Dictionary(e.aggregate_histogram("band")).keys().getInfo().map((function(t){var i=fitStackToCollection(e.filter(ee.Filter.eq("band",t)).first(),l,r,n),s=ee.Image(i.first()).bandNames(),d=s.map((function(e){return ee.String(t).cat("_"+a+"_").cat(e)}));i=i.select(s,d),o=void 0===o?i:joinCollections(o,i,!1)})),o}function fitStackToCollection(e,a,t,o){var l=ee.FeatureCollection(ee.List.sequence(1,a).map((function(a){a=ee.Number(a);var l=ee.String(".*_").cat(a.byte().format()),r=ee.String(".*_").cat(a.add(1).byte().format()),n=e.select([l]),i=e.select([r]),s=n.select(["yrs_.*"]).rename(["year_left"]),d=i.select(["yrs_.*"]).rename(["year_right"]),c=n.select(["fit_.*"]).rename(["fitted"]),p=i.select(["fit_.*"]).rename(["fitted"]),u=d.subtract(s).rename(["dur"]),m=p.subtract(c).rename(["mag"]),g=m.divide(u).rename(["slope"]);return ee.FeatureCollection(ee.List.sequence(t,o).map((function(e){e=ee.Number(e);var a=ee.Image(e);a=ee.Algorithms.If(e.eq(t),a.updateMask(s.lte(e).and(d.gte(e))),a.updateMask(s.lt(e).and(d.gte(e)))),a=ee.Image(a).rename(["yr"]).int16();var o=u.updateMask(a),l=m.updateMask(a),r=g.updateMask(a),n=p.subtract(r.multiply(d.subtract(e))).updateMask(a),i=n.subtract(c).updateMask(a).rename(["diff"]),h=o.addBands(n).addBands(l).addBands(r).addBands(i);return h=h.set("system:time_start",ee.Date.fromYMD(e,6,1).millis())})))})));return l=ee.ImageCollection(l.flatten()),ee.ImageCollection.fromImages(ee.List.sequence(t,o).map((function(e){return l.filter(ee.Filter.calendarRange(e,e,"year")).mosaic().set("system:time_start",ee.Date.fromYMD(e,6,1).millis())})))}function ltStackToFitted(e,a,t){var o=(e=e.updateMask(e.neq(0))).select(["yrs_vert_.*"]),l=e.select(["fit_vert_.*"]).multiply(1e-4),r=o.bandNames().length(),n=ee.List.sequence(0,r.subtract(1)),i=n.slice(0,-1),s=n.slice(1,null),d=o.select(i),c=o.select(s),p=l.select(i),u=l.select(s),m=u.subtract(p),g=c.subtract(d),h=m.divide(g),y=ee.List.sequence(a+1,t).map((function(e){e=ee.Number(e);var a=d.lte(e),t=c.gte(e),o=d.updateMask(a).reduce(ee.Reducer.max()),l=c.updateMask(t).reduce(ee.Reducer.min()),r=l.subtract(o),n=m.updateMask(c.eq(l)).reduce(ee.Reducer.firstNonNull()),i=h.updateMask(c.eq(l)).reduce(ee.Reducer.firstNonNull()),s=u.updateMask(c.eq(l)).reduce(ee.Reducer.firstNonNull()),p=ee.Image(e).subtract(o),g=l.subtract(e),y=p.multiply(i),f=g.multiply(i),v=s.subtract(f);return r.rename(["dur"]).addBands(v.rename("fit")).addBands(n.rename(["mag"])).addBands(i.rename(["slope"])).addBands(y.rename(["diff"])).set("system:time_start",ee.Date.fromYMD(e,6,1).millis())}));return y=ee.ImageCollection.fromImages(y)}function setupDownloads(e){console.log("setting up downloads");var a=lcmsDownloadDict[e];if(void 0!==a){var t=a.downloads,o=a.description;t.map((function(e){var a=e.substr(e.lastIndexOf("/")+1);addDownload(e,a)})),$("#product-descriptions").attr("href",o),$("#product-descriptions").attr("title","Click here for a detailed description of products available for download for chosen area")}else addDownload("","No downloads available for chosen study area"),$("#product-descriptions").attr("href",null),$("#product-descriptions").attr("title","No product description available for chosen study area")}function setupDropdownTreeDownloads(e){var a={change:["annual","summary"],land_cover:["annual"],land_use:["annual"],qa_bits:["annual"]},t=lcmsDownloadDict[e];if(void 0!==t){var o=t.downloads;["CONUS","SEAK","PRUSVI"].map((function(e){Object.keys(a).map((function(t){a[t].map((function(a){try{var l=o[e][t][a],r=`${e}-${t}-${a}-downloads`,n=r+"-d";$("#"+r).empty(),$("#"+r).append(`\n              <label  title = 'Choose from list below to download LCMS products. Hold ctrl key to select multiples or shift to select blocks. There can be a small delay before a download will begin, especially over slower networks.' for="${n}">Select products to download:</label>\n                              <select id = "${n}" size="8" style="height: 100%;" class=" bg-download-select" multiple ></select>\n                              <br>\n                              <button title = 'Click on this button to start downloads. If you have a popup blocker, you will need the manually click on the download links provided' class = 'btn' onclick = 'downloadSelectedAreas("${n}")'>Download</button>\n                              <hr>`),l.map((function(e){var a=e.substr(e.lastIndexOf("v20")+8);$("#"+n).append(`<option  value = "${e}">${a}</option>`)}))}catch(e){console.log(e)}}))}))}))}}function simpleCCDCPrediction(e,a,t,o){var l=ee.Number(2).multiply(Math.PI),r=e.select([a]),n=e.select([".*_INTP"]),i=e.select([".*_SLP"]).multiply(r),s=ee.Image(t).multiply(l).multiply(r),d=s.cos(),c=s.sin(),p=t.map((function(e){return ee.String(".*").cat(ee.Number(e).format())})),u=e.select([".*_SIN.*"]);u=u.select(p);var m=e.select([".*_COS.*"]);m=m.select(p);var g=o.map((function(e){return ee.String(e).cat("_predicted")})),h=ee.ImageCollection(o.map((function(e){return e=ee.String(e),ee.Image([n.select(e.cat("_.*")),i.select(e.cat("_.*")),u.select(e.cat("_.*")).multiply(c),m.select(e.cat("_.*")).multiply(d)]).reduce(ee.Reducer.sum())}))).toBands().rename(g);return e.addBands(h)}function simpleCCDCPredictionWrapper(e,a,t){var o=ee.Image(e.first()).select([".*_INTP"]).bandNames().map((function(e){return ee.String(e).split("_").get(0)}));return o=ee.Dictionary(o.reduce(ee.Reducer.frequencyHistogram())).keys().getInfo(),e.map((function(e){return simpleCCDCPrediction(e,a,t,o)}))}function simpleGetTimeImageCollection(e,a,t){var o=ee.ImageCollection(ee.List.sequence(e,a,t).map((function(e){e=ee.Number(e);var a=ee.Image(e).float().rename(["year"]),t=e.int16(),o=e.subtract(t),l=ee.Date.fromYMD(t,1,1).advance(o,"year").millis();return a.set("system:time_start",l)})));return o}function getCCDCSegCoeffs(e,a,t){var o=a.select([".*_coefs"]),l=o.bandNames(),r=(l.length(),ee.List(["INTP","SLP","COS1","SIN1","COS2","SIN2","COS3","SIN3"]));o=o.toArray(2);var n=a.select(["tStart"]),i=a.select(["tEnd"]),s=a.select(["tBreak"]);n=ee.Image(ee.Algorithms.If(t,n.arraySlice(0,0,1).arrayCat(s.arraySlice(0,0,-1),0),n)),i=ee.Image(ee.Algorithms.If(t,s.arraySlice(0,0,-1).arrayCat(i.arraySlice(0,-1,null),0),i));var d=n.lt(e).and(i.gte(e)).arrayRepeat(1,1).arrayRepeat(2,1);return o=(o=o.arrayMask(d).arrayProject([2,1]).arrayTranspose(1,0).arrayFlatten([l,r])).updateMask(o.reduce(ee.Reducer.max()).neq(0)),e.addBands(o)}function predictCCDC(e,a,t,o){var l=ee.Image(a.first()).select([0]).bandNames().get(0);return simpleCCDCPredictionWrapper(a=a.map((function(a){return getCCDCSegCoeffs(a,e,t)})),l,o)}function ccdcChangeDetection(e,a){var t=e.select([".*_magnitude"]),o=e.select(["tBreak"]),l=e.select(["changeProb"]).gte(1);t=t.select(a+".*");var r=o.arraySort(t),n=t.arraySort(),i=l.arraySort(t),s=o.arraySort(),d=t.arraySort(o),c=l.arraySort(o),p=r.arraySlice(0,0,1).arrayFlatten([["loss_year"]]),u=n.arraySlice(0,0,1).arrayFlatten([["loss_mag"]]),m=i.arraySlice(0,0,1).arrayFlatten([["loss_mask"]]);p=p.updateMask(u.lt(0).and(m)),u=u.updateMask(u.lt(0).and(m));var g=r.arraySlice(0,-1,null).arrayFlatten([["gain_year"]]),h=n.arraySlice(0,-1,null).arrayFlatten([["gain_mag"]]),y=i.arraySlice(0,-1,null).arrayFlatten([["gain_mask"]]);g=g.updateMask(h.gt(0).and(y)),h=h.updateMask(h.gt(0).and(y));var f=s.arraySlice(0,0,1).arrayFlatten([["loss_year"]]),v=d.arraySlice(0,0,1).arrayFlatten([["loss_mag"]]),b=c.arraySlice(0,0,1).arrayFlatten([["loss_mask"]]);f=f.updateMask(v.lt(0).and(b)),v=v.updateMask(v.lt(0).and(b));var w=s.arraySlice(0,-1,null).arrayFlatten([["gain_year"]]),S=d.arraySlice(0,-1,null).arrayFlatten([["gain_mag"]]),C=c.arraySlice(0,-1,null).arrayFlatten([["gain_mask"]]);return{mostRecent:{loss:{year:f,mag:v},gain:{year:w=w.updateMask(S.gt(0).and(C)),mag:S=S.updateMask(S.gt(0).and(C))}},highestMag:{loss:{year:p,mag:u},gain:{year:g,mag:h}}}}function getSelectLayers(e){var a=ee.FeatureCollection("projects/gtac-mtbs/assets/perimeters/mtbs_perims_DD");a=a.map((function(e){var a=ee.Date(e.get("Ig_Date"));return e.set({Year:a.get("year")})})),a=(a=a.filter(ee.Filter.gte("Year",startYear))).filter(ee.Filter.lte("Year",endYear));ee.FeatureCollection("USGS/WBD/2017/HUC04"),ee.FeatureCollection("USGS/WBD/2017/HUC08");var t=ee.FeatureCollection("USGS/WBD/2017/HUC12"),o=(ee.FeatureCollection("WCMC/WDPA/current/polygons").filter(ee.Filter.eq("DESIG","Wilderness")),ee.FeatureCollection("TIGER/2018/Counties")),l=(ee.FeatureCollection("users/jdreynolds33/Zones_New"),ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/bia_bounds_2017")),r=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/Baileys_Ecoregions_Subsections");r=r.select(["MAP_UNIT_N"],["NAME"],!0);var n=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/Baileys_Ecoregions");n=n.select(["SECTION"],["NAME"]);ee.FeatureCollection("EPA/Ecoregions/2013/L4");var i=ee.FeatureCollection("projects/USFS/LCMS-NFS/CONUS-Ancillary-Data/FS_District_Boundaries");i=i.select(["DISTRICTNA"],["name"]);var s=ee.FeatureCollection("projects/lcms-292214/assets/CONUS-Ancillary-Data/TIGER_Urban_Areas_2018");ee.FeatureCollection("projects/lcms-292214/assets/CONUS-Ancillary-Data/TIGER_MSA_2019");null!=e&&!1!==e||(Map2.addSelectLayer(l,{strokeColor:"0F0",layerType:"geeVectorImage"},"BIA Boundaries",!1,null,null,"BIA boundaries. Turn on layer and click on any area wanted to include in chart"),Map2.addSelectLayer(t,{strokeColor:"00F",layerType:"geeVectorImage"},"HUC 12",!1,null,null,"HUC 12 watershed boundaries. Turn on layer and click on any HUC 12 wanted to include in chart"),Map2.addSelectLayer(n,{strokeColor:"8F8",layerType:"geeVectorImage"},"Baileys Ecoregions Sections",!1,null,null,"Baileys ecoregion sections. Turn on layer and click on any ecoregion wanted to include in chart"),Map2.addSelectLayer(r,{strokeColor:"8F0",layerType:"geeVectorImage"},"Baileys Ecoregions Subsections",!1,null,null,"Baileys ecoregions subsections. Turn on layer and click on any ecoregion wanted to include in chart"),Map2.addSelectLayer(ee.FeatureCollection("EPA/Ecoregions/2013/L3"),{strokeColor:"8F8",layerType:"geeVectorImage"},"Level 3 EPA Ecoregions",!1,null,null,"Omernik and Griffith 2014 Level 3 EPA Ecoregions. Turn on layer and click on any ecoregion wanted to include in chart"),Map2.addSelectLayer(ee.FeatureCollection("EPA/Ecoregions/2013/L4"),{strokeColor:"8FD",layerType:"geeVectorImage"},"Level 4 EPA Ecoregions",!1,null,null,"Omernik and Griffith 2014 Level 4 EPA Ecoregions. Turn on layer and click on any ecoregion wanted to include in chart"),Map2.addSelectLayer(otherLands,{strokeColor:"DD0",layerType:"geeVectorImage"},"Other Designated Lands",!1,null,null,"A boundary within which National Forest System land parcels have managment or use limits placed on them by legal authority. Examples are: National Recreation Area, National Monument, and National Game Refuge. Turn on layer and click on any Park wanted to include in chart"),Map2.addSelectLayer(ee.FeatureCollection("TIGER/2018/States"),{strokeColor:"AD0",layerType:"geeVectorImage"},"US States and Territories",!1,null,null,"2018 TIGER state and territory boundaries for the United States. Turn on layer and click on any state/territory wanted to include in chart")),Map2.addSelectLayer(o,{strokeColor:"08F",layerType:"geeVectorImage"},"US Counties",!1,null,null,"US Counties from 2018 TIGER data. Turn on layer and click on any county wanted to include in chart"),Map2.addSelectLayer(s,{strokeColor:"88F",layerType:"geeVectorImage"},"US Census Urban Areas",!1,null,null,"TIGER, 2018, U.S. Urban Areas (https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_ua10_500k.zip). Turn on layer and click on any county wanted to include in chart"),Map2.addSelectLayer(nps,{strokeColor:"F0F",layerType:"geeVectorImage"},"National Parks",!1,null,null,"National Park boundaries. Turn on layer and click on any Park wanted to include in chart"),Map2.addSelectLayer(b,{strokeColor:"00F",layerType:"geeVectorImage"},"National Forests",!1,null,null,"National Forest boundaries. Turn on layer and click on any Forest wanted to include in chart"),Map2.addSelectLayer(i,{strokeColor:"80F",layerType:"geeVectorImage"},"National Forest Districts",!1,null,null,"National Forest District boundaries. Turn on layer and click on any Forest wanted to include in chart"),Map2.addSelectLayer(a,{strokeColor:"808",layerType:"geeVectorImage"},"MTBS Fires",!1,null,null,"Delineated perimeters of each MTBS mapped fire from "+startYear.toString()+"-"+endYear.toString()+". Turn on layer and click on any fire wanted to include in chart")}